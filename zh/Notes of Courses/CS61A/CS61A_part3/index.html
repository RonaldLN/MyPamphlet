
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ronaldln.github.io/MyPamphlet/zh/Notes%20of%20Courses/CS61A/CS61A_part3/">
      
      
        <link rel="prev" href="../CS61A_part2/">
      
      
        <link rel="next" href="../../CS61B/CS61B/">
      
      
      <link rel="icon" href="../../../../icons/favicon.jpg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>CS61A Part 3 - My Pamphlet</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../../css/timeago.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web/style.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap">
    
      <link rel="stylesheet" href="../../../../stylesheets/my_scheme.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-H7SV12D750"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-H7SV12D750",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-H7SV12D750",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7a9cfe470ed52fa0c0940a58fede385c";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="sunset-glow" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cs61a-part-3" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../" title="My Pamphlet" class="md-header__button md-logo" aria-label="My Pamphlet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Pamphlet
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CS61A Part 3
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="sunset-glow" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="sunset-glow-dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../Notes%20of%20Courses/CS61A/CS61A_part3/" hreflang="en" class="md-select__link">
              English labels (英文标签)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/RonaldLN/MyPamphlet" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RonaldLN/MyPamphlet
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../" title="My Pamphlet" class="md-nav__button md-logo" aria-label="My Pamphlet" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>

    </a>
    My Pamphlet
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RonaldLN/MyPamphlet" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RonaldLN/MyPamphlet
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欢迎翻阅我的手册
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notes of Courses
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notes of Courses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS61A
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            CS61A
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../CS61A_part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS61A Part 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../CS61A_part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS61A Part 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    CS61A Part 3
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CS61A Part 3
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lecture-31-declarative-programming" class="md-nav__link">
    Lecture 31 Declarative Programming
  </a>
  
    <nav class="md-nav" aria-label="Lecture 31 Declarative Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-32-tables" class="md-nav__link">
    Lecture 32 Tables
  </a>
  
    <nav class="md-nav" aria-label="Lecture 32 Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-32-qa" class="md-nav__link">
    Lecture 32 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 32 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-12" class="md-nav__link">
    Lab 12
  </a>
  
    <nav class="md-nav" aria-label="Lab 12">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-33-aggregation" class="md-nav__link">
    Lecture 33 Aggregation
  </a>
  
    <nav class="md-nav" aria-label="Lecture 33 Aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-33-qa" class="md-nav__link">
    Lecture 33 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 33 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-34-database" class="md-nav__link">
    Lecture 34 Database
  </a>
  
    <nav class="md-nav" aria-label="Lecture 34 Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-34-qa" class="md-nav__link">
    Lecture 34 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 34 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_5" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hw-09" class="md-nav__link">
    HW 09
  </a>
  
    <nav class="md-nav" aria-label="HW 09">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-35-tail-calls" class="md-nav__link">
    Lecture 35 Tail Calls
  </a>
  
    <nav class="md-nav" aria-label="Lecture 35 Tail Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_6" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-13" class="md-nav__link">
    Lab 13
  </a>
  
    <nav class="md-nav" aria-label="Lab 13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_10" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-36-macros" class="md-nav__link">
    Lecture 36 Macros
  </a>
  
    <nav class="md-nav" aria-label="Lecture 36 Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_11" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_7" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-14" class="md-nav__link">
    Lab 14
  </a>
  
    <nav class="md-nav" aria-label="Lab 14">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_12" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_12" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_8" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-36-qa" class="md-nav__link">
    Lecture 36 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 36 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_13" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_13" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-37-final-examples" class="md-nav__link">
    Lecture 37 Final Examples
  </a>
  
    <nav class="md-nav" aria-label="Lecture 37 Final Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_14" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_14" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_9" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-37-qa" class="md-nav__link">
    Lecture 37 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 37 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_15" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_15" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-38-conclusion" class="md-nav__link">
    Lecture 38 Conclusion
  </a>
  
    <nav class="md-nav" aria-label="Lecture 38 Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_16" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_16" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_10" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CS61B
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CS61B
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../CS61B/CS61B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS61B
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git相关
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Git相关
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../git%E7%9B%B8%E5%85%B3/fastgithub/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FastGithub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../git%E7%9B%B8%E5%85%B3/github%20copilot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Github Copilot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../git%E7%9B%B8%E5%85%B3/github%26gitee/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Github & Gitee
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Markdown相关
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Markdown相关
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../markdown%E7%9B%B8%E5%85%B3/hexo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hexo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../markdown%E7%9B%B8%E5%85%B3/mermaid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mermaid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../markdown%E7%9B%B8%E5%85%B3/mkdocs%28material%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mkdocs (Material)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python相关
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python相关
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/matplotlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matplotlib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/mediapipe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MediaPipe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/numpy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NumPy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/openpyxl%28%E7%94%A8%E4%BA%8Eexcel%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenPyXL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/python%E8%AF%AD%E8%A8%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python 语言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/scipy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SciPy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../python%E7%9B%B8%E5%85%B3/sympy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SymPy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Yolo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Yolo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../yolo/yolov5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YOLOv5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../yolo/yolov7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YOLOv7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../yolo/yolov8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YOLOv8
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    系统&环境
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            系统&环境
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/anaconda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anaconda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/cuda%20cudnn%E5%AE%89%E8%A3%85/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUDA cuDNN 安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/jupyter%20notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jupyter Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/nodejs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node.js
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/pip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/powershell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/ros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%B3%BB%E7%BB%9F%26%E7%8E%AF%E5%A2%83/vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lecture-31-declarative-programming" class="md-nav__link">
    Lecture 31 Declarative Programming
  </a>
  
    <nav class="md-nav" aria-label="Lecture 31 Declarative Programming">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-32-tables" class="md-nav__link">
    Lecture 32 Tables
  </a>
  
    <nav class="md-nav" aria-label="Lecture 32 Tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-32-qa" class="md-nav__link">
    Lecture 32 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 32 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-12" class="md-nav__link">
    Lab 12
  </a>
  
    <nav class="md-nav" aria-label="Lab 12">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-33-aggregation" class="md-nav__link">
    Lecture 33 Aggregation
  </a>
  
    <nav class="md-nav" aria-label="Lecture 33 Aggregation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-33-qa" class="md-nav__link">
    Lecture 33 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 33 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-34-database" class="md-nav__link">
    Lecture 34 Database
  </a>
  
    <nav class="md-nav" aria-label="Lecture 34 Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-34-qa" class="md-nav__link">
    Lecture 34 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 34 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_5" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hw-09" class="md-nav__link">
    HW 09
  </a>
  
    <nav class="md-nav" aria-label="HW 09">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_8" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-35-tail-calls" class="md-nav__link">
    Lecture 35 Tail Calls
  </a>
  
    <nav class="md-nav" aria-label="Lecture 35 Tail Calls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_9" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_6" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    6
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-13" class="md-nav__link">
    Lab 13
  </a>
  
    <nav class="md-nav" aria-label="Lab 13">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_10" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-36-macros" class="md-nav__link">
    Lecture 36 Macros
  </a>
  
    <nav class="md-nav" aria-label="Lecture 36 Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_11" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_7" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lab-14" class="md-nav__link">
    Lab 14
  </a>
  
    <nav class="md-nav" aria-label="Lab 14">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_12" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_12" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_8" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    6
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-36-qa" class="md-nav__link">
    Lecture 36 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 36 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_13" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_13" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-37-final-examples" class="md-nav__link">
    Lecture 37 Final Examples
  </a>
  
    <nav class="md-nav" aria-label="Lecture 37 Final Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_14" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_14" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_9" class="md-nav__link">
    3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-37-qa" class="md-nav__link">
    Lecture 37 Q&amp;A
  </a>
  
    <nav class="md-nav" aria-label="Lecture 37 Q&A">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_15" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_15" class="md-nav__link">
    2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lecture-38-conclusion" class="md-nav__link">
    Lecture 38 Conclusion
  </a>
  
    <nav class="md-nav" aria-label="Lecture 38 Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_16" class="md-nav__link">
    1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_16" class="md-nav__link">
    2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_10" class="md-nav__link">
    3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    5
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="cs61a-part-3">CS61A Part 3<a class="headerlink" href="#cs61a-part-3" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> 约 16893 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 1674 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> 预计阅读时间 77 分钟</p>
</div>
<details class="info">
<summary>目录</summary>
<ul>
<li><a href="#lecture-31-declarative-programming">Lecture 31 Declarative Programming</a></li>
<li><a href="#lecture-32-tables">Lecture 32 Tables</a></li>
<li><a href="#lecture-32-qa">Lecture 32 Q&amp;A</a></li>
<li><a href="#lab-12">Lab 12</a></li>
<li><a href="#lecture-33-aggregation">Lecture 33 Aggregation</a></li>
<li><a href="#lecture-33-qa">Lecture 33 Q&amp;A</a></li>
<li><a href="#lecture-34-database">Lecture 34 Database</a></li>
<li><a href="#lecture-34-qa">Lecture 34 Q&amp;A</a></li>
<li><a href="#hw-09">HW 09</a></li>
<li><a href="#lecture-35-tail-calls">Lecture 35 Tail Calls</a></li>
<li><a href="#lab-13">Lab 13</a></li>
<li><a href="#lecture-36-macros">Lecture 36 Macros</a></li>
<li><a href="#lab-14">Lab 14</a></li>
<li><a href="#lecture-36-qa">Lecture 36 Q&amp;A</a></li>
<li><a href="#lecture-37-final-examples">Lecture 37 Final Examples</a></li>
<li><a href="#lecture-37-qa">Lecture 37 Q&amp;A</a></li>
<li><a href="#lecture-38-conclusion">Lecture 38 Conclusion</a></li>
</ul>
</details>
<h2 id="lecture-31-declarative-programming">Lecture 31 Declarative Programming<a class="headerlink" href="#lecture-31-declarative-programming" title="Permanent link">&para;</a></h2>
<h3 id="1">1<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_169.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_169" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_169.png" /></a></p>
<p>John解释什么是 <em>声明式语言 declarative language</em> ，以及和 <em>命令式语言 imperative language</em> 的区别，</p>
<p>主要在于，<strong><em>命令式语言</em>只会固定地执行写好的程序，而<em>声明式语言</em>会根据需要处理的情况来自己选择合适的处理方法</strong></p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>SQL is a declarative programming language. What's that? Well, in a declarative language, SQL is the most common example, but there are many others such as Prolog. A program is a description of the desired result that you want your computer to generate. The interpreter's job is to figure out how to generate that result for you. That's different from an imperative language, such as Python or Scheme. In an imperative language, when you write a program in that language, it's a description of some computational process or processes that you want to be carried out. The job of an interpreter in an imperative language is to carry out the execution and evaluation rules in order to have a correctly interpreted program, and you've done this in your project.</p>
<p>So, there's more flexibility in a declarative language interpreter. We'll see what I mean by that in time, but here's a place to start: in an imperative language, if you write a quadratic time algorithm by specifying that computational process, it's probably gonna run in quadratic time. But in a declarative language, you just say what you want, and if there are multiple ways to compute that, one of which runs in quadratic time and one of which runs in linear time, well, it's up to the interpreter to choose among those options in order to compute what you want as efficiently as possible.</p>
<p>So, a lot of the interesting research in declarative languages is in making decisions about how to compute the desired result, given that there are many ways to compute it correctly, but some of them are faster than others.</p>
<hr />
<p>John:</p>
<p>SQL是一种声明式编程语言。那是什么？嗯，在声明式语言中，SQL是最常见的例子，但还有许多其他语言，比如Prolog。程序是对你想让计算机生成的期望结果的描述。解释器的任务是弄清楚如何为你生成该结果。这与命令式语言不同，比如Python或Scheme。在命令式语言中，当你在该语言中编写程序时，它是对你想执行的一些计算过程或过程的描述。命令式语言中解释器的任务是执行执行和评估规则，以确保正确解释程序，而你在项目中已经做到了这一点。</p>
<p>因此，在声明式语言解释器中有更多的灵活性。我们会在后面详细讨论这一点，但这里是一个起点：在命令式语言中，如果你通过指定计算过程来编写一个二次时间复杂度的算法，它可能会运行在二次时间复杂度。但在声明式语言中，你只需说明你想要的结果，如果有多种计算该结果的方式，其中一种是二次时间复杂度，另一种是线性时间复杂度，那么由解释器来在这些选项中选择，以尽可能高效地计算出你想要的结果。</p>
<p>因此，在声明式语言中，关于如何计算期望结果的有趣研究很多，鉴于有许多正确计算结果的方式，但其中一些比其他方式更快。</p>
</div>
<h3 id="2">2<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_170.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_170" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_170.png" /></a></p>
<p>SQL语言的一些基本语句，John说(除了 <code>select</code> <code>create table</code> )其他的语句对于理解SQL的核心不太重要</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...They're important if you're actually going to use one of these systems in a large industrial application, but they're not too important for understanding the heart of how SQL works. Most of the important action is in the SELECT statement.</p>
<hr />
<p>John:</p>
<p>...它们在实际应用于大型工业应用程序时非常重要，但对于理解 SQL 工作的核心并不太重要。大部分重要的操作都在 SELECT 语句中。</p>
</div>
<h3 id="3">3<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_171.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_171" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_171.png" /></a></p>
<p><code>select</code> 语句的基本用法</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">select</span><span class="w"> </span><span class="p">[</span><span class="n">expression</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">expression</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">;</span>
</span></code></pre></div>
<p>分号 <code>;</code> 表示结束， <code>as [name]</code> 部分是可选的。</p>
<p>一个 <code>select</code> 语句只会生成一个一行的数据表，可以使用 <code>union</code> 将多个表合并，<strong>合并要求两个表的列数是一样的</strong>，使用第一个表的列名作为新表的列名(所以可以看到展示的代码中，之后 <code>select</code> 语句(即之后的表)都可以不用添加列名不用写 <code>as [name]</code> )</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...If you <code>select</code> literals, which are expressions like the number <code>2</code> or the string <code>"Berkeley"</code> , that will create a one-row table. But if you want to create a multi-row table, you can union together two <code>select</code> statements. The union of two <code>select</code> statements is another table, but it contains the rows of both. You can only union together tables that have the same number of columns and the same type of information in each column. But the two <code>select</code> statements that you union together don't need to have the same names for the columns; it will just use the names of the first <code>select</code> statement in order to name the columns in the final result.</p>
<hr />
<p>John:</p>
<p>...如果你选择（ <code>select</code> ）字面量，这些表达式可以是像数字 <code>2</code> 或字符串 <code>"Berkeley"</code> 这样的表达式，那将创建一个一行的表。但如果你想创建一个多行的表，你可以将两个 <code>select</code> 语句联合在一起。两个 <code>select</code> 语句的联合是另一个表，但它包含了两者的行。你只能联合那些具有相同列数和每列相同类型信息的表。但你联合在一起的两个 <code>select</code> 语句的列名不需要相同；它将只使用第一个 <code>select</code> 语句的列名来命名最终结果中的列。</p>
</div>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_172.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_172" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_172.png" /></a></p>
<p><code>select</code> 语句只会展示数据表，但并不会将数据表储存，所以如果需要储存数据表，可以使用 <code>create table</code> 语句(如上图)</p>
<h3 id="4">4<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p><strong>用 <code>select</code> 语句来 <em>投影 project</em> 现有数据表</strong></p>
<blockquote>
<p>project官方的翻译是<em>投影</em>，但我觉得这里理解为 处理 也可以</p>
</blockquote>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_173.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_173" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_173.png" /></a></p>
<p>可以用 <code>from</code> 来选择一个已有的表，可以用 <code>where</code> 来筛选符合条件的行(感觉有点像python列表推到式中的 <code>if</code> )，可以用 <code>order by</code> 来给新表设置排序规则</p>
<hr />
<p>在John的demo演示中，使用 <code>*</code> 来选择所有列</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">parents</span><span class="p">;</span>
</span></code></pre></div>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_174.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_174" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_174.png" /></a></p>
<h3 id="5">5<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_175.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_175" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_175.png" /></a></p>
<p><code>select</code> 语句中也可以进行数学的处理(如上图)</p>
<h3 id="6">6<a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_176.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_176" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_176.png" /></a></p>
<p>在 sql 终端中，可以使用 <code>-init xxx.sql</code> 来加载 <code>.sql</code> 文件</p>
<hr />
<p>John提到 <code>select * from ints</code> 后，新表与原表顺序不一致的现象</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>Notice something quite interesting. These rows don't appear in the order that I wrote them out in the first place. When you union together a bunch of <code>select</code> statements, you get no guarantees about the order of the result. That's up to the declarative programming engine, which tries to compute the result efficiently.</p>
<p>Now, one thing that <code>union</code> does is it discards repeats, and the way that it discards repeats in some cases is to sort all the rows to look for whether there's repetition. And that's exactly what happened here. So, you can see that it's written all of these in an alphabetical order according to the word, which is not what I asked for in the first place, but that's what I got.</p>
<p>And this is one of the properties of declarative programming languages. There's no particular procedure that's defined in advance that tells me how to compute the result of unioning together a bunch of <code>select</code> statements. Instead, it's up to the system to create the correct result in whatever way it chooses, and that might involve building the table in a different order than you might expect.</p>
<hr />
<p>John:</p>
<p>请注意一些相当有趣的事情。这些行并不按照我最初写出它们的顺序出现。当你联合一堆 <code>select</code> 语句时，你无法保证结果的顺序。这由声明性编程引擎决定，它试图有效地计算结果。</p>
<p>现在， <code>union</code> 的一项功能是丢弃重复项，而在某些情况下丢弃重复项的方法是对所有行进行排序，以查看是否有重复。这正是这里发生的情况。所以你可以看到，它按照单词的字母顺序写出了所有这些，这不是我最初要求的，但这就是我得到的结果。</p>
<p>这是声明性编程语言的一个特性。没有预先定义的特定过程告诉我如何计算联合一堆 <code>select</code> 语句的结果。相反，这取决于系统以任何它选择的方式创建正确的结果，这可能涉及以与你期望的不同的顺序构建表。</p>
</div>
<h3 id="7">7<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_177.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_177" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_177.png" /></a></p>
<p>问题B，最后John用了一种我没想到的方法😂，</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">select</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ints</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">where</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">two</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">four</span><span class="o">/</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eight</span><span class="o">/</span><span class="mi">8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div>
<p>即判断是否只有一个为正，</p>
<p>我想到的是，将1 2 4 8加起来(算自己的值)然后取模为零(但不知道sql中有没有取模运算，有的话应该就可行)</p>
<h2 id="lecture-32-tables">Lecture 32 Tables<a class="headerlink" href="#lecture-32-tables" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_178.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_178" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_178.png" /></a></p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_179.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_179" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_179.png" /></a></p>
<p><em>联接 join</em> 两个表的方法，使用 逗号 <code>,</code> 来<em>联接</em>，结果是得到一个每个表的每一行与其他表的每一行组合的新的表(从上图John的demo演示中可以看到)</p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_180.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_180" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_180.png" /></a></p>
<p>如果遇到不同的表有相同名字的列，或者需要使用同一个表(如上图)，就需要使用 <em>别名 alias</em> ( <code>from [table] as [alias]</code> )，然后使用 点表达式 <code>.</code> 来使用不同表/别名中的相同名字的列</p>
<hr />
<p>John展示了<em>联接</em>‘多个表的应用，</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_181.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_181" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_181.png" /></a></p>
<p>筛选出祖父和孙子毛发类型一样的数据</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">select</span><span class="w"> </span><span class="n">grandog</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">grandparents</span><span class="p">,</span><span class="w"> </span><span class="n">dogs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">c</span><span class="p">,</span><span class="w"> </span><span class="n">dogs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">d</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">grandog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">and</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="n">granpup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">and</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">fur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">fur</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="2_1">2<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_183.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_183" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_183.png" /></a></p>
<p>sql中的一些数学运算相关的表达式，</p>
<p>其中不等号有两种 <code>&lt;&gt;</code> 和 <code>!=</code> ，而等号是 <code>=</code> (和python中的 <code>==</code> 不一样)</p>
<h3 id="3_1">3<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_182.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_182" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_182.png" /></a></p>
<p>John展示的sql中字符串string的一些用法，</p>
<ul>
<li>
<p>字符串的 <em>连接 concatenation</em>，使用 <code>||</code> 可以将两个字符串<em>连接</em>，</p>
</li>
<li>
<p>子字符串 <code>substr</code> ，第一个位置是字符串，第二个位置是起始字符的位置(从1开始)，第三个位置是子串长度</p>
<blockquote>
<p>所以上图中， <code>substr(s, 4, 2)</code> 的结果是 <code>lo</code></p>
</blockquote>
</li>
<li>
<p>字符串中字符的位置 <code>instr</code> ，第一个位置是字符串，第二个位置是要找的字符(可能子字符串也可以)，然后返回第一个对应的位置</p>
</li>
</ul>
<h2 id="lecture-32-qa">Lecture 32 Q&amp;A<a class="headerlink" href="#lecture-32-qa" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<p>有人提问到 <em>动态作用域 dynamic scope</em> ，John解释了这个概念一些相关信息</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...Dynamic scope, which is different from lexical scope, is what you're used to. Lexical scope basically says that all of the variables within a function can be identified just by looking at the code. This is true in Python; if you have an inner function like the <code>adder</code> function within <code>make_adder</code>, you can see all the names within the <code>adder</code> function in the code. They might be part of the <code>adder</code> function; they might be part of the <code>make_adder</code> function, the enclosing scope, but they're all kind of there. That's what's called lexical scope. It's the most common way in which programming languages work.</p>
<p>In other offerings of this course, we talk about an alternative called dynamic scope, which is hardly ever used. It's kind of interesting intellectually, and there are a few cases where it gets used, but mostly it doesn't exist in modern programming languages. So, for that reason, it's fine to just not know about it. But if you want to know about it, the story is basically that when you call a function, that function's environment inherits all of the names that already existed from wherever it was called. That means when you look at the body of the function, it might have names in it that you just can't see anywhere in the code because they're actually defined where that function is called, maybe in a different file or something like that.</p>
<p>Dynamic scope allows you to set up your environment and then make a function call, which is pretty different from lexical scope where you have to pass in everything that's relevant. But for that reason, it can simplify some things where, instead of passing in several different arguments, you just kind of have them already, and you don't have to pass any of them in. So, that's kind of the story with dynamic scope. It's just the same as lexical scope, except for the parent of a frame is always the frame from which that function was called, as opposed to where that function was defined.</p>
<hr />
<p>John:</p>
<p>...动态作用域（dynamic scope）与词法作用域（lexical scope）不同，而你可能已经习惯了词法作用域。词法作用域基本上表示一个函数内的所有变量都可以通过查看代码来确定。在Python中是这样的；如果你有一个内部函数，比如在 <code>make_adder</code> 内的 <code>adder</code> 函数，你可以在代码中看到 <code>adder</code> 函数中的所有名称。它们可能是 <code>adder</code> 函数的一部分；它们可能是 <code>make_adder</code> 函数的一部分，即封闭作用域，但它们都在那里。这就是所谓的词法作用域，这是大多数编程语言工作的最常见方式。</p>
<p>在本课程的其他部分，我们谈到了一种叫做动态作用域的替代方案，但它几乎从不被使用。从智力上讲，它有点有趣，而且有一些情况下会用到，但在现代编程语言中它基本不存在。因此，出于这个原因，你可以不了解它。但如果你想了解，故事基本上是，当你调用一个函数时，该函数的环境继承了从它被调用的任何地方已经存在的所有名称。这意味着当你查看函数的主体时，它可能包含在代码中你无法看到的名称，因为它们实际上是在调用该函数的地方定义的，可能在不同的文件中等。</p>
<p>动态作用域允许你设置你的环境然后进行函数调用，这与词法作用域相当不同，在词法作用域中，你必须传入所有相关的内容。但因为这个原因，它可以简化一些事情，而不是传递多个不同的参数，你可以直接使用它们，而无需传递它们。因此，这就是动态作用域的故事，它与词法作用域基本相同，只是一个框架的父级始终是调用该函数的框架，而不是定义该函数的地方。</p>
</div>
<p>关于<em>动态作用域</em>，我觉得关键的地方在于，<strong><mark>函数内部的参数是基于被调用时的环境的</mark></strong></p>
<h3 id="2_2">2<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<p>John举例解释道scheme中表达式<em>求值</em>的顺序</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">print</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">print</span><span class="w"> </span><span class="mi">6</span><span class="p">))</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nv">--------------------------------------</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nv">-------------</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">     </span><span class="nb">-</span><span class="w"> </span><span class="nv">-------</span><span class="w"> </span><span class="nb">-</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span><span class="w">     </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">                  </span><span class="nv">---------</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">                   </span><span class="nv">-----</span><span class="w"> </span><span class="nb">-</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">cube</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="nv">---------------------------</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="p">(</span><span class="nf">cube</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="nv">--------------</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w"> </span><span class="nv">----</span><span class="w"> </span><span class="nv">-------</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">       </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">                 </span><span class="nv">---------</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">                  </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span><span class="w"> </span><span class="nb">-</span>
</span></code></pre></div>
<p>可以看到是先进行表达式的<em>求值</em>，然后再去对表达式内部的字进行<em>求值</em></p>
<h2 id="lab-12">Lab 12<a class="headerlink" href="#lab-12" title="Permanent link">&para;</a></h2>
<h3 id="1_3">1<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<p>这个lab中需要运行命令</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>python<span class="w"> </span>sqlite_shell.py<span class="w"> </span>--init<span class="w"> </span>lab12.sql
</span></code></pre></div>
<p>来加载 <code>lab12.sql</code> 文件以及启动sql的终端，但是在2020年秋季课程网页(不知什么原因)给出的 <code>lab12.zip</code> 中， <code>sqlite_shell.py</code> 是个空文件，</p>
<p>然后我就去查看了lab网页中的 <code>Troubleshooting</code> ，这里提到了另一种替代方法</p>
<blockquote>
<p>If running <code>python3 sqlite_shell.py</code> didn't work, you can download a precompiled sqlite directly by following the following instructions and then use <code>sqlite3</code> and <code>./sqlite3</code> instead of <code>python3 sqlite_shell.py</code> based on which is specified for your platform.</p>
</blockquote>
<p>在SQLite官网下载已经编译好的可执行文件，于是我按照网页上的指示下载好了 <code>sqlite-tools-win-x64-3450100.zip</code> ，然后能在终端正常打开 <code>sqlite.exe</code> ，但是我在使用命令</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>./sqlite3<span class="w"> </span>&lt;<span class="w"> </span>lab12.sql
</span></code></pre></div>
<p>和</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./sqlite3<span class="w"> </span>--init<span class="w"> </span>lab12.sql
</span></code></pre></div>
<p>加载 <code>lab12.sql</code> 时，都显示相同的报错</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>--<span class="w"> </span>Loading<span class="w"> </span>resources<span class="w"> </span>from<span class="w"> </span>lab12.sql
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Parse<span class="w"> </span>error<span class="w"> </span>near<span class="w"> </span>line<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>no<span class="w"> </span>such<span class="w"> </span>column:<span class="w"> </span><span class="m">11</span>/13/2020<span class="w"> </span><span class="m">14</span>:28:25
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">   </span><span class="s2">&quot;Image 3&quot;</span>,<span class="w"> </span><span class="m">129</span><span class="w">                   </span>UNION<span class="w">    </span>SELECT<span class="w"> </span><span class="s2">&quot;11/13/2020 14:28:25&quot;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">                                      </span>error<span class="w"> </span>here<span class="w"> </span>---^
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Parse<span class="w"> </span>error<span class="w"> </span>near<span class="w"> </span>line<span class="w"> </span><span class="m">401</span>:<span class="w"> </span>no<span class="w"> </span>such<span class="w"> </span>column:<span class="w"> </span><span class="m">11</span>/13/2020<span class="w"> </span><span class="m">14</span>:28:25
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span>True<span class="s2">&quot; , &quot;</span>False<span class="s2">&quot;, &quot;</span>False<span class="s2">&quot;, &quot;</span>False<span class="s2">&quot; UNION    SELECT &quot;</span><span class="m">11</span>/13/2020<span class="w"> </span><span class="m">14</span>:28:25<span class="s2">&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="s2">                                      error here ---^</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="s2">...</span>
</span></code></pre></div>
<p>不知道是什么原因。</p>
<p>之后我分别去查看了23、21、19年秋季的对应的SQL的lab(lab12或lab13)，这几个学期的sql lab压缩包内的 <code>sqlite_shell.py</code> 文件都不是空文件，并且似乎三个学期的 <code>sqlite_shell.py</code> 文件哈希值都一样(说明是同一个文件)，于是我就将23秋季的 <code>sqlite_shell.py</code> 解压替换了原有的文件，最后可以运行最初的命令。</p>
<details class="info">
<summary>sqlite_shell.py</summary>
<div class="language-python highlight"><span class="filename">sqlite_shell.py</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1"># Licensed under the MIT license</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1"># A simple SQLite shell that uses the built-in Python adapter.</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="k">try</span><span class="p">:</span> <span class="ne">FileNotFoundError</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span> <span class="ne">FileNotFoundError</span> <span class="o">=</span> <span class="ne">OSError</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="k">if</span> <span class="nb">str</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span> <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytes</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="k">if</span> <span class="nb">str</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span> <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="k">try</span><span class="p">:</span> <span class="kn">import</span><span class="w"> </span><span class="nn">msvcrt</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="n">msvcrt</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="n">CP_UTF8</span> <span class="o">=</span> <span class="mi">65001</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="n">pythonapi</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="k">if</span> <span class="n">msvcrt</span><span class="p">:</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">ctypes</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    <span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">UINT</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulong</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">)</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="n">GetConsoleCP</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">UINT</span><span class="p">)((</span><span class="s1">&#39;GetConsoleCP&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>    <span class="n">SetConsoleCP</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">UINT</span><span class="p">)((</span><span class="s1">&#39;SetConsoleCP&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="n">GetConsoleOutputCP</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">UINT</span><span class="p">)((</span><span class="s1">&#39;GetConsoleOutputCP&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    <span class="n">SetConsoleOutputCP</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">UINT</span><span class="p">)((</span><span class="s1">&#39;SetConsoleOutputCP&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    <span class="n">GetConsoleMode</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span> <span class="n">use_last_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)((</span><span class="s1">&#39;GetConsoleMode&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>    <span class="n">GetNumberOfConsoleInputEvents</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span> <span class="n">use_last_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)((</span><span class="s1">&#39;GetNumberOfConsoleInputEvents&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>    <span class="n">ReadConsoleW</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">use_last_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)((</span><span class="s1">&#39;ReadConsoleW&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>    <span class="n">WriteConsoleW</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WINFUNCTYPE</span><span class="p">(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">HANDLE</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">DWORD</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">DWORD</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">use_last_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)((</span><span class="s1">&#39;WriteConsoleW&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">kernel32</span><span class="p">))</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>    <span class="k">class</span><span class="w"> </span><span class="nc">Py_buffer</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;buf&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;len&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;itemsize&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;readonly&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ndim&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;strides&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;suboffsets&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span><span class="p">))]</span> <span class="o">+</span> <span class="p">([(</span><span class="s1">&#39;smalltable&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ssize_t</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[(</span><span class="s1">&#39;internal&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)]</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="k">try</span><span class="p">:</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ctypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">pythonapi</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="k">if</span> <span class="n">pythonapi</span><span class="p">:</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getbuffer</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">writable</span><span class="p">):</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">Py_buffer</span><span class="p">()</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>        <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyObject_GetBuffer</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">writable</span><span class="p">))</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="k">try</span><span class="p">:</span> <span class="n">buf</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="n">arr</span><span class="o">.</span><span class="n">len</span><span class="p">)</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">buf</span><span class="p">)</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>        <span class="k">finally</span><span class="p">:</span> <span class="n">pythonapi</span><span class="o">.</span><span class="n">PyBuffer_Release</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>        <span class="k">return</span> <span class="n">buf</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="n">ENCODING</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>    <span class="k">class</span><span class="w"> </span><span class="nc">NotASurrogateError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">surrogateescape_handler</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>        <span class="c1"># Source: https://github.com/PythonCharmers/python-future/blob/aef57391c0cd58bf840dff5e2bc2c8c0f5b0a1b4/src/future/utils/surrogateescape.py</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>        <span class="n">mystring</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">object</span><span class="p">[</span><span class="n">exc</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>                <span class="n">decoded</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">mystring</span><span class="p">:</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>                        <span class="n">code</span> <span class="o">=</span> <span class="n">ch</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>                        <span class="n">code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>                    <span class="k">if</span> <span class="mh">0x80</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xFF</span><span class="p">:</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>                        <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0xDC00</span> <span class="o">+</span> <span class="n">code</span><span class="p">))</span>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>                    <span class="k">elif</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0x7F</span><span class="p">:</span>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>                        <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>                        <span class="k">raise</span> <span class="n">NotASurrogateError</span><span class="p">()</span>
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>                <span class="n">decoded</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">):</span>
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>                <span class="n">decoded</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>                <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">mystring</span><span class="p">:</span>
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>                    <span class="n">code</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="mh">0xD800</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xDCFF</span><span class="p">:</span>
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>                        <span class="k">raise</span> <span class="n">NotASurrogateError</span><span class="p">()</span>
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>                    <span class="k">if</span> <span class="mh">0xDC00</span> <span class="o">&lt;=</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xDC7F</span><span class="p">:</span>
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>                        <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="n">code</span> <span class="o">-</span> <span class="mh">0xDC00</span><span class="p">))</span>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>                    <span class="k">elif</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="mh">0xDCFF</span><span class="p">:</span>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>                        <span class="n">decoded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="n">code</span> <span class="o">-</span> <span class="mh">0xDC00</span><span class="p">))</span>
</span><span id="__span-9-80"><a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-81"><a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>                        <span class="k">raise</span> <span class="n">NotASurrogateError</span><span class="p">()</span>
</span><span id="__span-9-82"><a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>                <span class="n">decoded</span> <span class="o">=</span> <span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</span><span id="__span-9-83"><a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-84"><a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>                <span class="k">raise</span> <span class="n">exc</span>
</span><span id="__span-9-85"><a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>        <span class="k">except</span> <span class="n">NotASurrogateError</span><span class="p">:</span>
</span><span id="__span-9-86"><a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>            <span class="k">raise</span> <span class="n">exc</span>
</span><span id="__span-9-87"><a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
</span><span id="__span-9-88"><a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>    <span class="n">codecs</span><span class="o">.</span><span class="n">register_error</span><span class="p">(</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">,</span> <span class="n">surrogateescape_handler</span><span class="p">)</span>
</span><span id="__span-9-89"><a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>
</span><span id="__span-9-90"><a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a><span class="k">def</span><span class="w"> </span><span class="nf">exception_encode</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">codec</span><span class="p">):</span>
</span><span id="__span-9-91"><a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="__span-9-92"><a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>        <span class="n">reduced</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">__reduce__</span><span class="p">()</span>
</span><span id="__span-9-93"><a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>        <span class="n">ex</span> <span class="o">=</span> <span class="n">reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">arg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">arg</span><span class="p">,</span> <span class="n">reduced</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</span><span id="__span-9-94"><a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>    <span class="k">return</span> <span class="n">ex</span>
</span><span id="__span-9-95"><a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>
</span><span id="__span-9-96"><a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a><span class="k">def</span><span class="w"> </span><span class="nf">sql_commands</span><span class="p">(</span><span class="n">read_line</span><span class="p">):</span>
</span><span id="__span-9-97"><a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>    <span class="n">delims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">]</span>
</span><span id="__span-9-98"><a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-99"><a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>    <span class="n">in_string</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-100"><a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-101"><a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>    <span class="n">prev_line</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-102"><a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>    <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-103"><a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>    <span class="n">concat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-104"><a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-9-105"><a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>        <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-106"><a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># process preprocessor directives</span>
</span><span id="__span-9-107"><a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-9-108"><a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>                <span class="n">not_in_the_middle_of_any_input</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">in_string</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">chunk_</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">concat</span><span class="p">))</span>
</span><span id="__span-9-109"><a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">read_line</span><span class="p">(</span><span class="n">counter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">not_in_the_middle_of_any_input</span><span class="p">,</span> <span class="n">prev_line</span><span class="p">)</span>
</span><span id="__span-9-110"><a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>                <span class="n">empty_string</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">line</span>
</span><span id="__span-9-111"><a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>                <span class="n">prev_line</span> <span class="o">=</span> <span class="n">line</span>
</span><span id="__span-9-112"><a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
</span><span id="__span-9-113"><a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>                    <span class="k">break</span>
</span><span id="__span-9-114"><a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>                <span class="k">if</span> <span class="n">not_in_the_middle_of_any_input</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="__span-9-115"><a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>                    <span class="k">yield</span> <span class="n">line</span>
</span><span id="__span-9-116"><a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>                    <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-117"><a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-118"><a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>                    <span class="k">break</span>
</span><span id="__span-9-119"><a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
</span><span id="__span-9-120"><a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>                <span class="k">break</span>
</span><span id="__span-9-121"><a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-122"><a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
</span><span id="__span-9-123"><a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>            <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">delim</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span> <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">d</span><span class="p">),</span> <span class="n">in_string</span> <span class="ow">or</span> <span class="n">delims</span> <span class="k">if</span> <span class="n">in_string</span> <span class="o">!=</span> <span class="s1">&#39;--&#39;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)))</span>
</span><span id="__span-9-124"><a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="__span-9-125"><a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_string</span><span class="p">:</span>
</span><span id="__span-9-126"><a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a>                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
</span><span id="__span-9-127"><a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>                    <span class="n">j</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
</span><span id="__span-9-128"><a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a>                    <span class="k">if</span> <span class="n">delim</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
</span><span id="__span-9-129"><a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>                        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="__span-9-130"><a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a>                        <span class="n">concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">j</span> <span class="p">:</span> <span class="n">j</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">delim</span><span class="p">)])</span>    <span class="c1"># ensure delimeter is the same type as the string (it may not be due to implicit conversion)</span>
</span><span id="__span-9-131"><a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>                        <span class="c1"># Eat up any further spaces until a newline</span>
</span><span id="__span-9-132"><a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a>                        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
</span><span id="__span-9-133"><a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a>                            <span class="n">delim</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-134"><a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">delim</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span> <span class="k">break</span>
</span><span id="__span-9-135"><a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>                            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-9-136"><a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a>                            <span class="k">if</span> <span class="n">delim</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span> <span class="k">break</span>
</span><span id="__span-9-137"><a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="__span-9-138"><a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>                        <span class="k">yield</span> <span class="n">empty_string</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>
</span><span id="__span-9-139"><a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>                        <span class="k">del</span> <span class="n">concat</span><span class="p">[:]</span>
</span><span id="__span-9-140"><a id="__codelineno-9-140" name="__codelineno-9-140" href="#__codelineno-9-140"></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-141"><a id="__codelineno-9-141" name="__codelineno-9-141" href="#__codelineno-9-141"></a>                        <span class="n">in_string</span> <span class="o">=</span> <span class="n">delim</span>
</span><span id="__span-9-142"><a id="__codelineno-9-142" name="__codelineno-9-142" href="#__codelineno-9-142"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-143"><a id="__codelineno-9-143" name="__codelineno-9-143" href="#__codelineno-9-143"></a>                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
</span><span id="__span-9-144"><a id="__codelineno-9-144" name="__codelineno-9-144" href="#__codelineno-9-144"></a>                    <span class="n">ch</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-145"><a id="__codelineno-9-145" name="__codelineno-9-145" href="#__codelineno-9-145"></a>                    <span class="k">assert</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">in_string</span> <span class="ow">or</span> <span class="n">in_string</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span>
</span><span id="__span-9-146"><a id="__codelineno-9-146" name="__codelineno-9-146" href="#__codelineno-9-146"></a>                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-9-147"><a id="__codelineno-9-147" name="__codelineno-9-147" href="#__codelineno-9-147"></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="__span-9-148"><a id="__codelineno-9-148" name="__codelineno-9-148" href="#__codelineno-9-148"></a>                    <span class="n">concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
</span><span id="__span-9-149"><a id="__codelineno-9-149" name="__codelineno-9-149" href="#__codelineno-9-149"></a>                    <span class="n">in_string</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-150"><a id="__codelineno-9-150" name="__codelineno-9-150" href="#__codelineno-9-150"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-151"><a id="__codelineno-9-151" name="__codelineno-9-151" href="#__codelineno-9-151"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]);</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="__span-9-152"><a id="__codelineno-9-152" name="__codelineno-9-152" href="#__codelineno-9-152"></a>            <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-153"><a id="__codelineno-9-153" name="__codelineno-9-153" href="#__codelineno-9-153"></a>
</span><span id="__span-9-154"><a id="__codelineno-9-154" name="__codelineno-9-154" href="#__codelineno-9-154"></a><span class="k">class</span><span class="w"> </span><span class="nc">WindowsConsoleIOMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-9-155"><a id="__codelineno-9-155" name="__codelineno-9-155" href="#__codelineno-9-155"></a>    <span class="c1"># Ctrl+C handling with ReadFile() is messed up on Windows starting on Windows 8... here&#39;s some background reading:</span>
</span><span id="__span-9-156"><a id="__codelineno-9-156" name="__codelineno-9-156" href="#__codelineno-9-156"></a>    <span class="c1">#   https://stackoverflow.com/a/43260436</span>
</span><span id="__span-9-157"><a id="__codelineno-9-157" name="__codelineno-9-157" href="#__codelineno-9-157"></a>    <span class="c1">#   https://github.com/microsoft/terminal/issues/334</span>
</span><span id="__span-9-158"><a id="__codelineno-9-158" name="__codelineno-9-158" href="#__codelineno-9-158"></a>    <span class="c1"># We use ReadConsole when we can, so it doesn&#39;t affect us, but it&#39;s good info to know regardless.</span>
</span><span id="__span-9-159"><a id="__codelineno-9-159" name="__codelineno-9-159" href="#__codelineno-9-159"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
</span><span id="__span-9-160"><a id="__codelineno-9-160" name="__codelineno-9-160" href="#__codelineno-9-160"></a>        <span class="k">assert</span> <span class="n">isatty</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="s2">&quot;file descriptor must refer to a console (note that on Windows, NUL satisfies isatty(), but is not a console)&quot;</span>
</span><span id="__span-9-161"><a id="__codelineno-9-161" name="__codelineno-9-161" href="#__codelineno-9-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fd</span> <span class="o">=</span> <span class="n">fd</span>
</span><span id="__span-9-162"><a id="__codelineno-9-162" name="__codelineno-9-162" href="#__codelineno-9-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">get_osfhandle</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
</span><span id="__span-9-163"><a id="__codelineno-9-163" name="__codelineno-9-163" href="#__codelineno-9-163"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd</span>
</span><span id="__span-9-164"><a id="__codelineno-9-164" name="__codelineno-9-164" href="#__codelineno-9-164"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">isatty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">isatty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="p">)</span>
</span><span id="__span-9-165"><a id="__codelineno-9-165" name="__codelineno-9-165" href="#__codelineno-9-165"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-9-166"><a id="__codelineno-9-166" name="__codelineno-9-166" href="#__codelineno-9-166"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">GetNumberOfConsoleInputEvents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">DWORD</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="__span-9-167"><a id="__codelineno-9-167" name="__codelineno-9-167" href="#__codelineno-9-167"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">n</span> <span class="o">=</span> <span class="n">DWORD</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="k">return</span> <span class="n">WriteConsoleW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">(),</span> <span class="n">n</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="__span-9-168"><a id="__codelineno-9-168" name="__codelineno-9-168" href="#__codelineno-9-168"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readwcharsinto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-9-169"><a id="__codelineno-9-169" name="__codelineno-9-169" href="#__codelineno-9-169"></a>        <span class="n">nr</span> <span class="o">=</span> <span class="n">DWORD</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-9-170"><a id="__codelineno-9-170" name="__codelineno-9-170" href="#__codelineno-9-170"></a>        <span class="n">old_error</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">get_last_error</span><span class="p">()</span>
</span><span id="__span-9-171"><a id="__codelineno-9-171" name="__codelineno-9-171" href="#__codelineno-9-171"></a>        <span class="n">ctypes</span><span class="o">.</span><span class="n">set_last_error</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-9-172"><a id="__codelineno-9-172" name="__codelineno-9-172" href="#__codelineno-9-172"></a>        <span class="n">success</span> <span class="o">=</span> <span class="n">ReadConsoleW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">nr</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nr</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">())</span>
</span><span id="__span-9-173"><a id="__codelineno-9-173" name="__codelineno-9-173" href="#__codelineno-9-173"></a>        <span class="n">error</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">get_last_error</span><span class="p">()</span>
</span><span id="__span-9-174"><a id="__codelineno-9-174" name="__codelineno-9-174" href="#__codelineno-9-174"></a>        <span class="n">ctypes</span><span class="o">.</span><span class="n">set_last_error</span><span class="p">(</span><span class="n">old_error</span><span class="p">)</span>
</span><span id="__span-9-175"><a id="__codelineno-9-175" name="__codelineno-9-175" href="#__codelineno-9-175"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span> <span class="k">raise</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="__span-9-176"><a id="__codelineno-9-176" name="__codelineno-9-176" href="#__codelineno-9-176"></a>        <span class="n">ERROR_OPERATION_ABORTED</span> <span class="o">=</span> <span class="mi">995</span>
</span><span id="__span-9-177"><a id="__codelineno-9-177" name="__codelineno-9-177" href="#__codelineno-9-177"></a>        <span class="k">if</span> <span class="n">nr</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">error</span> <span class="o">==</span> <span class="n">ERROR_OPERATION_ABORTED</span><span class="p">:</span>
</span><span id="__span-9-178"><a id="__codelineno-9-178" name="__codelineno-9-178" href="#__codelineno-9-178"></a>            <span class="c1"># Apparently this can trigger pending KeyboardInterrupts?</span>
</span><span id="__span-9-179"><a id="__codelineno-9-179" name="__codelineno-9-179" href="#__codelineno-9-179"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span><span class="p">))</span>
</span><span id="__span-9-180"><a id="__codelineno-9-180" name="__codelineno-9-180" href="#__codelineno-9-180"></a>            <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">()</span>  <span class="c1"># If Python doesn&#39;t raise it, we can</span>
</span><span id="__span-9-181"><a id="__codelineno-9-181" name="__codelineno-9-181" href="#__codelineno-9-181"></a>        <span class="k">return</span> <span class="n">nr</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-9-182"><a id="__codelineno-9-182" name="__codelineno-9-182" href="#__codelineno-9-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writewchars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-9-183"><a id="__codelineno-9-183" name="__codelineno-9-183" href="#__codelineno-9-183"></a>        <span class="n">nw</span> <span class="o">=</span> <span class="n">DWORD</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-9-184"><a id="__codelineno-9-184" name="__codelineno-9-184" href="#__codelineno-9-184"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">WriteConsoleW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">nw</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">nw</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">()):</span>
</span><span id="__span-9-185"><a id="__codelineno-9-185" name="__codelineno-9-185" href="#__codelineno-9-185"></a>            <span class="k">raise</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinError</span><span class="p">()</span>
</span><span id="__span-9-186"><a id="__codelineno-9-186" name="__codelineno-9-186" href="#__codelineno-9-186"></a>        <span class="k">return</span> <span class="n">nw</span><span class="o">.</span><span class="n">value</span>
</span><span id="__span-9-187"><a id="__codelineno-9-187" name="__codelineno-9-187" href="#__codelineno-9-187"></a>
</span><span id="__span-9-188"><a id="__codelineno-9-188" name="__codelineno-9-188" href="#__codelineno-9-188"></a><span class="k">class</span><span class="w"> </span><span class="nc">WindowsConsoleRawIO</span><span class="p">(</span><span class="n">WindowsConsoleIOMixin</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">):</span>
</span><span id="__span-9-189"><a id="__codelineno-9-189" name="__codelineno-9-189" href="#__codelineno-9-189"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readinto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="__span-9-190"><a id="__codelineno-9-190" name="__codelineno-9-190" href="#__codelineno-9-190"></a>        <span class="n">wordsize</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar</span><span class="p">)</span>
</span><span id="__span-9-191"><a id="__codelineno-9-191" name="__codelineno-9-191" href="#__codelineno-9-191"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readwcharsinto</span><span class="p">(</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="n">wordsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">wordsize</span>
</span><span id="__span-9-192"><a id="__codelineno-9-192" name="__codelineno-9-192" href="#__codelineno-9-192"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="__span-9-193"><a id="__codelineno-9-193" name="__codelineno-9-193" href="#__codelineno-9-193"></a>        <span class="n">wordsize</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_wchar</span><span class="p">)</span>
</span><span id="__span-9-194"><a id="__codelineno-9-194" name="__codelineno-9-194" href="#__codelineno-9-194"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writewchars</span><span class="p">(</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="n">wordsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">wordsize</span>
</span><span id="__span-9-195"><a id="__codelineno-9-195" name="__codelineno-9-195" href="#__codelineno-9-195"></a>
</span><span id="__span-9-196"><a id="__codelineno-9-196" name="__codelineno-9-196" href="#__codelineno-9-196"></a><span class="k">class</span><span class="w"> </span><span class="nc">WindowsConsoleTextIO</span><span class="p">(</span><span class="n">WindowsConsoleIOMixin</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">):</span>
</span><span id="__span-9-197"><a id="__codelineno-9-197" name="__codelineno-9-197" href="#__codelineno-9-197"></a>    <span class="n">buf</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-198"><a id="__codelineno-9-198" name="__codelineno-9-198" href="#__codelineno-9-198"></a>    <span class="n">buffered</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">()</span>
</span><span id="__span-9-199"><a id="__codelineno-9-199" name="__codelineno-9-199" href="#__codelineno-9-199"></a>    <span class="n">translate</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-9-200"><a id="__codelineno-9-200" name="__codelineno-9-200" href="#__codelineno-9-200"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">getbuf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ncodeunits</span><span class="p">):</span>
</span><span id="__span-9-201"><a id="__codelineno-9-201" name="__codelineno-9-201" href="#__codelineno-9-201"></a>        <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span>
</span><span id="__span-9-202"><a id="__codelineno-9-202" name="__codelineno-9-202" href="#__codelineno-9-202"></a>        <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ncodeunits</span><span class="p">:</span>
</span><span id="__span-9-203"><a id="__codelineno-9-203" name="__codelineno-9-203" href="#__codelineno-9-203"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">ncodeunits</span><span class="p">)</span>
</span><span id="__span-9-204"><a id="__codelineno-9-204" name="__codelineno-9-204" href="#__codelineno-9-204"></a>        <span class="k">return</span> <span class="n">buf</span>
</span><span id="__span-9-205"><a id="__codelineno-9-205" name="__codelineno-9-205" href="#__codelineno-9-205"></a>    <span class="nd">@staticmethod</span>  <span class="c1"># Don&#39;t let classes override this... they can override the caller instead</span>
</span><span id="__span-9-206"><a id="__codelineno-9-206" name="__codelineno-9-206" href="#__codelineno-9-206"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">do_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nchars</span><span class="p">,</span> <span class="n">translate_newlines</span><span class="p">):</span>
</span><span id="__span-9-207"><a id="__codelineno-9-207" name="__codelineno-9-207" href="#__codelineno-9-207"></a>        <span class="n">prenewline</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-208"><a id="__codelineno-9-208" name="__codelineno-9-208" href="#__codelineno-9-208"></a>        <span class="n">newline</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-9-209"><a id="__codelineno-9-209" name="__codelineno-9-209" href="#__codelineno-9-209"></a>        <span class="n">empty</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-210"><a id="__codelineno-9-210" name="__codelineno-9-210" href="#__codelineno-9-210"></a>        <span class="k">if</span> <span class="n">nchars</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">nchars</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">nchars</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-9-211"><a id="__codelineno-9-211" name="__codelineno-9-211" href="#__codelineno-9-211"></a>        <span class="n">ncodeunits</span> <span class="o">=</span> <span class="n">nchars</span> <span class="k">if</span> <span class="n">nchars</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span>  <span class="c1"># Unit mismatch, but doesn&#39;t matter; we&#39;ll loop</span>
</span><span id="__span-9-212"><a id="__codelineno-9-212" name="__codelineno-9-212" href="#__codelineno-9-212"></a>        <span class="n">buf</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-213"><a id="__codelineno-9-213" name="__codelineno-9-213" href="#__codelineno-9-213"></a>        <span class="n">istart</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-9-214"><a id="__codelineno-9-214" name="__codelineno-9-214" href="#__codelineno-9-214"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-9-215"><a id="__codelineno-9-215" name="__codelineno-9-215" href="#__codelineno-9-215"></a>            <span class="n">iend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">newline</span><span class="p">,</span> <span class="n">istart</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">istart</span> <span class="o">+</span> <span class="n">nchars</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="p">))</span> <span class="k">if</span> <span class="n">nchars</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nchars</span>
</span><span id="__span-9-216"><a id="__codelineno-9-216" name="__codelineno-9-216" href="#__codelineno-9-216"></a>            <span class="k">if</span> <span class="n">iend</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">iend</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">newline</span><span class="p">)</span> <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-9-217"><a id="__codelineno-9-217" name="__codelineno-9-217" href="#__codelineno-9-217"></a>            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">iend</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="p">):</span>
</span><span id="__span-9-218"><a id="__codelineno-9-218" name="__codelineno-9-218" href="#__codelineno-9-218"></a>                <span class="k">break</span>
</span><span id="__span-9-219"><a id="__codelineno-9-219" name="__codelineno-9-219" href="#__codelineno-9-219"></a>            <span class="k">if</span> <span class="n">buf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">buf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getbuf</span><span class="p">(</span><span class="n">ncodeunits</span><span class="p">)</span>
</span><span id="__span-9-220"><a id="__codelineno-9-220" name="__codelineno-9-220" href="#__codelineno-9-220"></a>            <span class="n">istart</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="p">)</span>
</span><span id="__span-9-221"><a id="__codelineno-9-221" name="__codelineno-9-221" href="#__codelineno-9-221"></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">readwcharsinto</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">ncodeunits</span><span class="p">)]</span>
</span><span id="__span-9-222"><a id="__codelineno-9-222" name="__codelineno-9-222" href="#__codelineno-9-222"></a>            <span class="k">if</span> <span class="n">translate_newlines</span><span class="p">:</span> <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">prenewline</span><span class="p">,</span> <span class="n">empty</span><span class="p">)</span>
</span><span id="__span-9-223"><a id="__codelineno-9-223" name="__codelineno-9-223" href="#__codelineno-9-223"></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1A</span><span class="s1">&#39;</span><span class="p">):</span>  <span class="c1"># EOF on Windows (Ctrl+Z) at the beginning of a line results in the entire rest of the buffer being discarded</span>
</span><span id="__span-9-224"><a id="__codelineno-9-224" name="__codelineno-9-224" href="#__codelineno-9-224"></a>                <span class="n">iend</span> <span class="o">=</span> <span class="n">istart</span>
</span><span id="__span-9-225"><a id="__codelineno-9-225" name="__codelineno-9-225" href="#__codelineno-9-225"></a>                <span class="k">break</span>
</span><span id="__span-9-226"><a id="__codelineno-9-226" name="__codelineno-9-226" href="#__codelineno-9-226"></a>            <span class="c1"># Python 2 and Python 3 behaviors differ on Windows... Python 2&#39;s sys.stdin.readline() just deletes the next character if it sees EOF in the middle of a string! I won&#39;t emulate that here.</span>
</span><span id="__span-9-227"><a id="__codelineno-9-227" name="__codelineno-9-227" href="#__codelineno-9-227"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">buffered</span> <span class="o">+=</span> <span class="n">chunk</span>  <span class="c1"># We&#39;re relying on Python&#39;s concatenation optimization here... we don&#39;t do it ourselves, since we want self.buffered to be valid every iteration in case there is an exception raised</span>
</span><span id="__span-9-228"><a id="__codelineno-9-228" name="__codelineno-9-228" href="#__codelineno-9-228"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="p">[:</span><span class="n">iend</span><span class="p">]</span>
</span><span id="__span-9-229"><a id="__codelineno-9-229" name="__codelineno-9-229" href="#__codelineno-9-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffered</span><span class="p">[</span><span class="n">iend</span><span class="p">:]</span>
</span><span id="__span-9-230"><a id="__codelineno-9-230" name="__codelineno-9-230" href="#__codelineno-9-230"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-231"><a id="__codelineno-9-231" name="__codelineno-9-231" href="#__codelineno-9-231"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nchars</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span> <span class="k">return</span> <span class="n">WindowsConsoleTextIO</span><span class="o">.</span><span class="n">do_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nchars</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">)</span>
</span><span id="__span-9-232"><a id="__codelineno-9-232" name="__codelineno-9-232" href="#__codelineno-9-232"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nchars</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span> <span class="k">return</span> <span class="n">WindowsConsoleTextIO</span><span class="o">.</span><span class="n">do_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nchars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">)</span>
</span><span id="__span-9-233"><a id="__codelineno-9-233" name="__codelineno-9-233" href="#__codelineno-9-233"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">text</span><span class="p">);</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writewchars</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-9-234"><a id="__codelineno-9-234" name="__codelineno-9-234" href="#__codelineno-9-234"></a>
</span><span id="__span-9-235"><a id="__codelineno-9-235" name="__codelineno-9-235" href="#__codelineno-9-235"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap_windows_console_io</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">is_output</span><span class="p">):</span>
</span><span id="__span-9-236"><a id="__codelineno-9-236" name="__codelineno-9-236" href="#__codelineno-9-236"></a>    <span class="n">fd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-237"><a id="__codelineno-9-237" name="__codelineno-9-237" href="#__codelineno-9-237"></a>    <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">msvcrt</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_output</span> <span class="ow">or</span> <span class="n">pythonapi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isatty</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
</span><span id="__span-9-238"><a id="__codelineno-9-238" name="__codelineno-9-238" href="#__codelineno-9-238"></a>        <span class="k">try</span><span class="p">:</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span><span id="__span-9-239"><a id="__codelineno-9-239" name="__codelineno-9-239" href="#__codelineno-9-239"></a>        <span class="k">except</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="__span-9-240"><a id="__codelineno-9-240" name="__codelineno-9-240" href="#__codelineno-9-240"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">stream</span>
</span><span id="__span-9-241"><a id="__codelineno-9-241" name="__codelineno-9-241" href="#__codelineno-9-241"></a>    <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-242"><a id="__codelineno-9-242" name="__codelineno-9-242" href="#__codelineno-9-242"></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">GetConsoleOutputCP</span> <span class="k">if</span> <span class="n">is_output</span> <span class="k">else</span> <span class="n">GetConsoleCP</span>
</span><span id="__span-9-243"><a id="__codelineno-9-243" name="__codelineno-9-243" href="#__codelineno-9-243"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">or</span> <span class="n">f</span><span class="p">()</span> <span class="o">!=</span> <span class="n">CP_UTF8</span><span class="p">:</span>
</span><span id="__span-9-244"><a id="__codelineno-9-244" name="__codelineno-9-244" href="#__codelineno-9-244"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-245"><a id="__codelineno-9-245" name="__codelineno-9-245" href="#__codelineno-9-245"></a>                <span class="k">if</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">is_output</span><span class="p">:</span>
</span><span id="__span-9-246"><a id="__codelineno-9-246" name="__codelineno-9-246" href="#__codelineno-9-246"></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">WindowsConsoleTextIO</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
</span><span id="__span-9-247"><a id="__codelineno-9-247" name="__codelineno-9-247" href="#__codelineno-9-247"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-248"><a id="__codelineno-9-248" name="__codelineno-9-248" href="#__codelineno-9-248"></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">((</span><span class="n">io</span><span class="o">.</span><span class="n">BufferedWriter</span> <span class="k">if</span> <span class="n">is_output</span> <span class="k">else</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">)(</span><span class="n">WindowsConsoleRawIO</span><span class="p">(</span><span class="n">fd</span><span class="p">)),</span> <span class="s1">&#39;utf-16-le&#39;</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">line_buffering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-249"><a id="__codelineno-9-249" name="__codelineno-9-249" href="#__codelineno-9-249"></a>            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="__span-9-250"><a id="__codelineno-9-250" name="__codelineno-9-250" href="#__codelineno-9-250"></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-251"><a id="__codelineno-9-251" name="__codelineno-9-251" href="#__codelineno-9-251"></a>
</span><span id="__span-9-252"><a id="__codelineno-9-252" name="__codelineno-9-252" href="#__codelineno-9-252"></a><span class="k">class</span><span class="w"> </span><span class="nc">NonOwningTextIOWrapper</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">):</span>
</span><span id="__span-9-253"><a id="__codelineno-9-253" name="__codelineno-9-253" href="#__codelineno-9-253"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_textiowrapper</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-9-254"><a id="__codelineno-9-254" name="__codelineno-9-254" href="#__codelineno-9-254"></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base_textiowrapper</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">)</span>
</span><span id="__span-9-255"><a id="__codelineno-9-255" name="__codelineno-9-255" href="#__codelineno-9-255"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base_textiowrapper</span>  <span class="c1"># must keep a reference to this alive so it doesn&#39;t get closed</span>
</span><span id="__span-9-256"><a id="__codelineno-9-256" name="__codelineno-9-256" href="#__codelineno-9-256"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">NonOwningTextIOWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">base_textiowrapper</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-257"><a id="__codelineno-9-257" name="__codelineno-9-257" href="#__codelineno-9-257"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-9-258"><a id="__codelineno-9-258" name="__codelineno-9-258" href="#__codelineno-9-258"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">NonOwningTextIOWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="__span-9-259"><a id="__codelineno-9-259" name="__codelineno-9-259" href="#__codelineno-9-259"></a>
</span><span id="__span-9-260"><a id="__codelineno-9-260" name="__codelineno-9-260" href="#__codelineno-9-260"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap_unicode_stdio</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">is_writer</span><span class="p">,</span> <span class="n">encoding</span><span class="p">):</span>  <span class="c1"># The underlying stream must NOT be used directly until the stream returned by this function is disposed of</span>
</span><span id="__span-9-261"><a id="__codelineno-9-261" name="__codelineno-9-261" href="#__codelineno-9-261"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">):</span>
</span><span id="__span-9-262"><a id="__codelineno-9-262" name="__codelineno-9-262" href="#__codelineno-9-262"></a>        <span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># Make sure nothing is left in the buffer before we re-wrap it</span>
</span><span id="__span-9-263"><a id="__codelineno-9-263" name="__codelineno-9-263" href="#__codelineno-9-263"></a>        <span class="n">none</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
</span><span id="__span-9-264"><a id="__codelineno-9-264" name="__codelineno-9-264" href="#__codelineno-9-264"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-9-265"><a id="__codelineno-9-265" name="__codelineno-9-265" href="#__codelineno-9-265"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;errors&#39;</span><span class="p">,</span> <span class="s1">&#39;newline&#39;</span><span class="p">,</span> <span class="s1">&#39;line_buffering&#39;</span><span class="p">,</span> <span class="s1">&#39;write_through&#39;</span><span class="p">]:</span>
</span><span id="__span-9-266"><a id="__codelineno-9-266" name="__codelineno-9-266" href="#__codelineno-9-266"></a>            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;newlines&#39;</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;newline&#39;</span> <span class="k">else</span> <span class="n">key</span><span class="p">,</span> <span class="n">none</span><span class="p">)</span>
</span><span id="__span-9-267"><a id="__codelineno-9-267" name="__codelineno-9-267" href="#__codelineno-9-267"></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">none</span><span class="p">:</span>
</span><span id="__span-9-268"><a id="__codelineno-9-268" name="__codelineno-9-268" href="#__codelineno-9-268"></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-9-269"><a id="__codelineno-9-269" name="__codelineno-9-269" href="#__codelineno-9-269"></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>
</span><span id="__span-9-270"><a id="__codelineno-9-270" name="__codelineno-9-270" href="#__codelineno-9-270"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">NonOwningTextIOWrapper</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-271"><a id="__codelineno-9-271" name="__codelineno-9-271" href="#__codelineno-9-271"></a>    <span class="k">elif</span> <span class="s1">&#39;PYTHONIOENCODING&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="nb">str</span> <span class="o">==</span> <span class="nb">bytes</span> <span class="ow">and</span> <span class="n">stream</span> <span class="ow">in</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
</span><span id="__span-9-272"><a id="__codelineno-9-272" name="__codelineno-9-272" href="#__codelineno-9-272"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span> <span class="k">if</span> <span class="n">is_writer</span> <span class="k">else</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">)(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">stream</span><span class="p">)</span>
</span><span id="__span-9-273"><a id="__codelineno-9-273" name="__codelineno-9-273" href="#__codelineno-9-273"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-274"><a id="__codelineno-9-274" name="__codelineno-9-274" href="#__codelineno-9-274"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">stream</span>
</span><span id="__span-9-275"><a id="__codelineno-9-275" name="__codelineno-9-275" href="#__codelineno-9-275"></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-276"><a id="__codelineno-9-276" name="__codelineno-9-276" href="#__codelineno-9-276"></a>
</span><span id="__span-9-277"><a id="__codelineno-9-277" name="__codelineno-9-277" href="#__codelineno-9-277"></a><span class="k">class</span><span class="w"> </span><span class="nc">StringEscapeParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-9-278"><a id="__codelineno-9-278" name="__codelineno-9-278" href="#__codelineno-9-278"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-9-279"><a id="__codelineno-9-279" name="__codelineno-9-279" href="#__codelineno-9-279"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-9-280"><a id="__codelineno-9-280" name="__codelineno-9-280" href="#__codelineno-9-280"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">((?:[^</span><span class="se">\&quot;\\</span><span class="s2">n]+|</span><span class="se">\\\\</span><span class="s2">.)*)(?:</span><span class="se">\&quot;</span><span class="s2">|$)|</span><span class="se">\&#39;</span><span class="s2">([^</span><span class="se">\&#39;\\</span><span class="s2">n]*)(?:</span><span class="se">\&#39;</span><span class="s2">|$)|(</span><span class="se">\\</span><span class="s2">S+)&quot;</span><span class="p">)</span>
</span><span id="__span-9-281"><a id="__codelineno-9-281" name="__codelineno-9-281" href="#__codelineno-9-281"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">escape_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">(.)&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</span><span id="__span-9-282"><a id="__codelineno-9-282" name="__codelineno-9-282" href="#__codelineno-9-282"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-9-283"><a id="__codelineno-9-283" name="__codelineno-9-283" href="#__codelineno-9-283"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">escape_replacement</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="__span-9-284"><a id="__codelineno-9-284" name="__codelineno-9-284" href="#__codelineno-9-284"></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-9-285"><a id="__codelineno-9-285" name="__codelineno-9-285" href="#__codelineno-9-285"></a>        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span>
</span><span id="__span-9-286"><a id="__codelineno-9-286" name="__codelineno-9-286" href="#__codelineno-9-286"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-9-287"><a id="__codelineno-9-287" name="__codelineno-9-287" href="#__codelineno-9-287"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-9-288"><a id="__codelineno-9-288" name="__codelineno-9-288" href="#__codelineno-9-288"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>
</span><span id="__span-9-289"><a id="__codelineno-9-289" name="__codelineno-9-289" href="#__codelineno-9-289"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="__span-9-290"><a id="__codelineno-9-290" name="__codelineno-9-290" href="#__codelineno-9-290"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\v</span><span class="s2">&quot;</span>
</span><span id="__span-9-291"><a id="__codelineno-9-291" name="__codelineno-9-291" href="#__codelineno-9-291"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\f</span><span class="s2">&quot;</span>
</span><span id="__span-9-292"><a id="__codelineno-9-292" name="__codelineno-9-292" href="#__codelineno-9-292"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span>
</span><span id="__span-9-293"><a id="__codelineno-9-293" name="__codelineno-9-293" href="#__codelineno-9-293"></a>        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\b</span><span class="s2">&quot;</span>
</span><span id="__span-9-294"><a id="__codelineno-9-294" name="__codelineno-9-294" href="#__codelineno-9-294"></a>        <span class="k">return</span> <span class="n">text</span>
</span><span id="__span-9-295"><a id="__codelineno-9-295" name="__codelineno-9-295" href="#__codelineno-9-295"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="__span-9-296"><a id="__codelineno-9-296" name="__codelineno-9-296" href="#__codelineno-9-296"></a>        <span class="n">escape_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_pattern</span>
</span><span id="__span-9-297"><a id="__codelineno-9-297" name="__codelineno-9-297" href="#__codelineno-9-297"></a>        <span class="n">escape_replacement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">escape_replacement</span>
</span><span id="__span-9-298"><a id="__codelineno-9-298" name="__codelineno-9-298" href="#__codelineno-9-298"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-299"><a id="__codelineno-9-299" name="__codelineno-9-299" href="#__codelineno-9-299"></a>        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="__span-9-300"><a id="__codelineno-9-300" name="__codelineno-9-300" href="#__codelineno-9-300"></a>            <span class="p">[</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="__span-9-301"><a id="__codelineno-9-301" name="__codelineno-9-301" href="#__codelineno-9-301"></a>            <span class="k">if</span> <span class="n">m1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">escape_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">escape_replacement</span><span class="p">,</span> <span class="n">m1</span><span class="p">))</span>
</span><span id="__span-9-302"><a id="__codelineno-9-302" name="__codelineno-9-302" href="#__codelineno-9-302"></a>            <span class="k">if</span> <span class="n">m2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
</span><span id="__span-9-303"><a id="__codelineno-9-303" name="__codelineno-9-303" href="#__codelineno-9-303"></a>            <span class="k">if</span> <span class="n">m3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">escape_pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">escape_replacement</span><span class="p">,</span> <span class="n">m3</span><span class="p">))</span>
</span><span id="__span-9-304"><a id="__codelineno-9-304" name="__codelineno-9-304" href="#__codelineno-9-304"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-305"><a id="__codelineno-9-305" name="__codelineno-9-305" href="#__codelineno-9-305"></a>
</span><span id="__span-9-306"><a id="__codelineno-9-306" name="__codelineno-9-306" href="#__codelineno-9-306"></a><span class="k">class</span><span class="w"> </span><span class="nc">Database</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-9-307"><a id="__codelineno-9-307" name="__codelineno-9-307" href="#__codelineno-9-307"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-9-308"><a id="__codelineno-9-308" name="__codelineno-9-308" href="#__codelineno-9-308"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-309"><a id="__codelineno-9-309" name="__codelineno-9-309" href="#__codelineno-9-309"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span id="__span-9-310"><a id="__codelineno-9-310" name="__codelineno-9-310" href="#__codelineno-9-310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1"># assign name only AFTER cursor is created</span>
</span><span id="__span-9-311"><a id="__codelineno-9-311" name="__codelineno-9-311" href="#__codelineno-9-311"></a>
</span><span id="__span-9-312"><a id="__codelineno-9-312" name="__codelineno-9-312" href="#__codelineno-9-312"></a><span class="k">def</span><span class="w"> </span><span class="nf">isatty</span><span class="p">(</span><span class="n">file_or_fd</span><span class="p">):</span>
</span><span id="__span-9-313"><a id="__codelineno-9-313" name="__codelineno-9-313" href="#__codelineno-9-313"></a>    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-9-314"><a id="__codelineno-9-314" name="__codelineno-9-314" href="#__codelineno-9-314"></a>    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">file_or_fd</span><span class="p">,</span> <span class="s1">&#39;isatty&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_or_fd</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># this check is just an optimization</span>
</span><span id="__span-9-315"><a id="__codelineno-9-315" name="__codelineno-9-315" href="#__codelineno-9-315"></a>    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-316"><a id="__codelineno-9-316" name="__codelineno-9-316" href="#__codelineno-9-316"></a>        <span class="k">try</span><span class="p">:</span> <span class="n">tty</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>
</span><span id="__span-9-317"><a id="__codelineno-9-317" name="__codelineno-9-317" href="#__codelineno-9-317"></a>        <span class="k">except</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">:</span> <span class="n">tty</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-318"><a id="__codelineno-9-318" name="__codelineno-9-318" href="#__codelineno-9-318"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">tty</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tty</span>
</span><span id="__span-9-319"><a id="__codelineno-9-319" name="__codelineno-9-319" href="#__codelineno-9-319"></a>    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">file_or_fd</span><span class="p">,</span> <span class="s1">&#39;fileno&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_or_fd</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># this check is just an optimization</span>
</span><span id="__span-9-320"><a id="__codelineno-9-320" name="__codelineno-9-320" href="#__codelineno-9-320"></a>    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-321"><a id="__codelineno-9-321" name="__codelineno-9-321" href="#__codelineno-9-321"></a>        <span class="k">try</span><span class="p">:</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>
</span><span id="__span-9-322"><a id="__codelineno-9-322" name="__codelineno-9-322" href="#__codelineno-9-322"></a>        <span class="k">except</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">:</span> <span class="n">fd</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-323"><a id="__codelineno-9-323" name="__codelineno-9-323" href="#__codelineno-9-323"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">isatty</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">msvcrt</span> <span class="ow">or</span> <span class="n">GetConsoleMode</span><span class="p">(</span><span class="n">msvcrt</span><span class="o">.</span><span class="n">get_osfhandle</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">byref</span><span class="p">(</span><span class="n">DWORD</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-9-324"><a id="__codelineno-9-324" name="__codelineno-9-324" href="#__codelineno-9-324"></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-325"><a id="__codelineno-9-325" name="__codelineno-9-325" href="#__codelineno-9-325"></a>
</span><span id="__span-9-326"><a id="__codelineno-9-326" name="__codelineno-9-326" href="#__codelineno-9-326"></a><span class="k">def</span><span class="w"> </span><span class="nf">can_call_input_for_stdio</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
</span><span id="__span-9-327"><a id="__codelineno-9-327" name="__codelineno-9-327" href="#__codelineno-9-327"></a>    <span class="k">return</span> <span class="n">stream</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span id="__span-9-328"><a id="__codelineno-9-328" name="__codelineno-9-328" href="#__codelineno-9-328"></a>
</span><span id="__span-9-329"><a id="__codelineno-9-329" name="__codelineno-9-329" href="#__codelineno-9-329"></a><span class="k">class</span><span class="w"> </span><span class="nc">StdIOProxy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-9-330"><a id="__codelineno-9-330" name="__codelineno-9-330" href="#__codelineno-9-330"></a>    <span class="c1"># Maybe useful later: codecs.StreamRecoder(bytesIO, codec.decode, codec.encode, codec.streamwriter, codec.streamreader, errors=&#39;surrogateescape&#39;)</span>
</span><span id="__span-9-331"><a id="__codelineno-9-331" name="__codelineno-9-331" href="#__codelineno-9-331"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">):</span>
</span><span id="__span-9-332"><a id="__codelineno-9-332" name="__codelineno-9-332" href="#__codelineno-9-332"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec</span>
</span><span id="__span-9-333"><a id="__codelineno-9-333" name="__codelineno-9-333" href="#__codelineno-9-333"></a>        <span class="n">streams</span> <span class="o">=</span> <span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
</span><span id="__span-9-334"><a id="__codelineno-9-334" name="__codelineno-9-334" href="#__codelineno-9-334"></a>        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">:</span>
</span><span id="__span-9-335"><a id="__codelineno-9-335" name="__codelineno-9-335" href="#__codelineno-9-335"></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">),</span> <span class="s2">&quot;unable to determine stream type&quot;</span>
</span><span id="__span-9-336"><a id="__codelineno-9-336" name="__codelineno-9-336" href="#__codelineno-9-336"></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">),</span> <span class="s2">&quot;RAW I/O APIs are different and not supported&quot;</span>
</span><span id="__span-9-337"><a id="__codelineno-9-337" name="__codelineno-9-337" href="#__codelineno-9-337"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="__span-9-338"><a id="__codelineno-9-338" name="__codelineno-9-338" href="#__codelineno-9-338"></a>            <span class="p">(</span>
</span><span id="__span-9-339"><a id="__codelineno-9-339" name="__codelineno-9-339" href="#__codelineno-9-339"></a>                <span class="n">stream</span><span class="p">,</span>
</span><span id="__span-9-340"><a id="__codelineno-9-340" name="__codelineno-9-340" href="#__codelineno-9-340"></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedIOBase</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="__span-9-341"><a id="__codelineno-9-341" name="__codelineno-9-341" href="#__codelineno-9-341"></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOBase</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedIOBase</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">))</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="__span-9-342"><a id="__codelineno-9-342" name="__codelineno-9-342" href="#__codelineno-9-342"></a>                <span class="n">allow_set_code_page</span>
</span><span id="__span-9-343"><a id="__codelineno-9-343" name="__codelineno-9-343" href="#__codelineno-9-343"></a>            <span class="p">),</span>
</span><span id="__span-9-344"><a id="__codelineno-9-344" name="__codelineno-9-344" href="#__codelineno-9-344"></a>            <span class="n">streams</span><span class="p">))</span>
</span><span id="__span-9-345"><a id="__codelineno-9-345" name="__codelineno-9-345" href="#__codelineno-9-345"></a>    <span class="nd">@property</span>
</span><span id="__span-9-346"><a id="__codelineno-9-346" name="__codelineno-9-346" href="#__codelineno-9-346"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stdin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-347"><a id="__codelineno-9-347" name="__codelineno-9-347" href="#__codelineno-9-347"></a>    <span class="nd">@property</span>
</span><span id="__span-9-348"><a id="__codelineno-9-348" name="__codelineno-9-348" href="#__codelineno-9-348"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-349"><a id="__codelineno-9-349" name="__codelineno-9-349" href="#__codelineno-9-349"></a>    <span class="nd">@property</span>
</span><span id="__span-9-350"><a id="__codelineno-9-350" name="__codelineno-9-350" href="#__codelineno-9-350"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-351"><a id="__codelineno-9-351" name="__codelineno-9-351" href="#__codelineno-9-351"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_coerce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
</span><span id="__span-9-352"><a id="__codelineno-9-352" name="__codelineno-9-352" href="#__codelineno-9-352"></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-353"><a id="__codelineno-9-353" name="__codelineno-9-353" href="#__codelineno-9-353"></a>        <span class="n">can_binary</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-354"><a id="__codelineno-9-354" name="__codelineno-9-354" href="#__codelineno-9-354"></a>        <span class="n">can_text</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-9-355"><a id="__codelineno-9-355" name="__codelineno-9-355" href="#__codelineno-9-355"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
</span><span id="__span-9-356"><a id="__codelineno-9-356" name="__codelineno-9-356" href="#__codelineno-9-356"></a>            <span class="n">arg</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="__span-9-357"><a id="__codelineno-9-357" name="__codelineno-9-357" href="#__codelineno-9-357"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">buffer</span><span class="p">):</span>
</span><span id="__span-9-358"><a id="__codelineno-9-358" name="__codelineno-9-358" href="#__codelineno-9-358"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">can_binary</span><span class="p">:</span>
</span><span id="__span-9-359"><a id="__codelineno-9-359" name="__codelineno-9-359" href="#__codelineno-9-359"></a>                <span class="n">arg</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-360"><a id="__codelineno-9-360" name="__codelineno-9-360" href="#__codelineno-9-360"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
</span><span id="__span-9-361"><a id="__codelineno-9-361" name="__codelineno-9-361" href="#__codelineno-9-361"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">can_text</span><span class="p">:</span>
</span><span id="__span-9-362"><a id="__codelineno-9-362" name="__codelineno-9-362" href="#__codelineno-9-362"></a>                <span class="n">arg</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="s1">&#39;strict&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-363"><a id="__codelineno-9-363" name="__codelineno-9-363" href="#__codelineno-9-363"></a>        <span class="k">return</span> <span class="n">arg</span>
</span><span id="__span-9-364"><a id="__codelineno-9-364" name="__codelineno-9-364" href="#__codelineno-9-364"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-9-365"><a id="__codelineno-9-365" name="__codelineno-9-365" href="#__codelineno-9-365"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_do_readline</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="__span-9-366"><a id="__codelineno-9-366" name="__codelineno-9-366" href="#__codelineno-9-366"></a>        <span class="n">new_code_page</span> <span class="o">=</span> <span class="n">CP_UTF8</span>
</span><span id="__span-9-367"><a id="__codelineno-9-367" name="__codelineno-9-367" href="#__codelineno-9-367"></a>        <span class="n">old_code_page</span> <span class="o">=</span> <span class="n">GetConsoleCP</span><span class="p">()</span> <span class="k">if</span> <span class="n">msvcrt</span> <span class="ow">and</span> <span class="n">GetConsoleCP</span> <span class="ow">and</span> <span class="n">isatty</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-9-368"><a id="__codelineno-9-368" name="__codelineno-9-368" href="#__codelineno-9-368"></a>        <span class="k">if</span> <span class="n">old_code_page</span> <span class="o">==</span> <span class="n">new_code_page</span><span class="p">:</span> <span class="n">old_code_page</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Don&#39;t change code page if it&#39;s already correct...</span>
</span><span id="__span-9-369"><a id="__codelineno-9-369" name="__codelineno-9-369" href="#__codelineno-9-369"></a>        <span class="k">if</span> <span class="n">old_code_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-370"><a id="__codelineno-9-370" name="__codelineno-9-370" href="#__codelineno-9-370"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">SetConsoleCP</span><span class="p">(</span><span class="n">new_code_page</span><span class="p">):</span>
</span><span id="__span-9-371"><a id="__codelineno-9-371" name="__codelineno-9-371" href="#__codelineno-9-371"></a>                <span class="n">old_code_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-372"><a id="__codelineno-9-372" name="__codelineno-9-372" href="#__codelineno-9-372"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-373"><a id="__codelineno-9-373" name="__codelineno-9-373" href="#__codelineno-9-373"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-9-374"><a id="__codelineno-9-374" name="__codelineno-9-374" href="#__codelineno-9-374"></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-9-375"><a id="__codelineno-9-375" name="__codelineno-9-375" href="#__codelineno-9-375"></a>            <span class="k">if</span> <span class="n">old_code_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-376"><a id="__codelineno-9-376" name="__codelineno-9-376" href="#__codelineno-9-376"></a>                <span class="n">SetConsoleCP</span><span class="p">(</span><span class="n">old_code_page</span><span class="p">)</span>
</span><span id="__span-9-377"><a id="__codelineno-9-377" name="__codelineno-9-377" href="#__codelineno-9-377"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-378"><a id="__codelineno-9-378" name="__codelineno-9-378" href="#__codelineno-9-378"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-9-379"><a id="__codelineno-9-379" name="__codelineno-9-379" href="#__codelineno-9-379"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_do_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="__span-9-380"><a id="__codelineno-9-380" name="__codelineno-9-380" href="#__codelineno-9-380"></a>        <span class="n">new_code_page</span> <span class="o">=</span> <span class="n">CP_UTF8</span>
</span><span id="__span-9-381"><a id="__codelineno-9-381" name="__codelineno-9-381" href="#__codelineno-9-381"></a>        <span class="n">old_code_page</span> <span class="o">=</span> <span class="n">GetConsoleOutputCP</span><span class="p">()</span> <span class="k">if</span> <span class="n">msvcrt</span> <span class="ow">and</span> <span class="n">GetConsoleOutputCP</span> <span class="ow">and</span> <span class="n">isatty</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-9-382"><a id="__codelineno-9-382" name="__codelineno-9-382" href="#__codelineno-9-382"></a>        <span class="k">if</span> <span class="n">old_code_page</span> <span class="o">==</span> <span class="n">new_code_page</span><span class="p">:</span> <span class="n">old_code_page</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Don&#39;t change code page if it&#39;s already correct...</span>
</span><span id="__span-9-383"><a id="__codelineno-9-383" name="__codelineno-9-383" href="#__codelineno-9-383"></a>        <span class="k">if</span> <span class="n">old_code_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-384"><a id="__codelineno-9-384" name="__codelineno-9-384" href="#__codelineno-9-384"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">SetConsoleOutputCP</span><span class="p">(</span><span class="n">new_code_page</span><span class="p">):</span>
</span><span id="__span-9-385"><a id="__codelineno-9-385" name="__codelineno-9-385" href="#__codelineno-9-385"></a>                <span class="n">old_code_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-386"><a id="__codelineno-9-386" name="__codelineno-9-386" href="#__codelineno-9-386"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-387"><a id="__codelineno-9-387" name="__codelineno-9-387" href="#__codelineno-9-387"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-9-388"><a id="__codelineno-9-388" name="__codelineno-9-388" href="#__codelineno-9-388"></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-9-389"><a id="__codelineno-9-389" name="__codelineno-9-389" href="#__codelineno-9-389"></a>            <span class="k">if</span> <span class="n">old_code_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-390"><a id="__codelineno-9-390" name="__codelineno-9-390" href="#__codelineno-9-390"></a>                <span class="n">SetConsoleCP</span><span class="p">(</span><span class="n">old_code_page</span><span class="p">)</span>
</span><span id="__span-9-391"><a id="__codelineno-9-391" name="__codelineno-9-391" href="#__codelineno-9-391"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-392"><a id="__codelineno-9-392" name="__codelineno-9-392" href="#__codelineno-9-392"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_readln</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">prompt</span><span class="p">):</span>
</span><span id="__span-9-393"><a id="__codelineno-9-393" name="__codelineno-9-393" href="#__codelineno-9-393"></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-394"><a id="__codelineno-9-394" name="__codelineno-9-394" href="#__codelineno-9-394"></a>        <span class="n">can_binary</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-395"><a id="__codelineno-9-395" name="__codelineno-9-395" href="#__codelineno-9-395"></a>        <span class="n">allow_set_code_page</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-9-396"><a id="__codelineno-9-396" name="__codelineno-9-396" href="#__codelineno-9-396"></a>        <span class="k">if</span> <span class="n">can_call_input_for_stdio</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">can_binary</span><span class="p">:</span>  <span class="c1"># input() can&#39;t work with binary data</span>
</span><span id="__span-9-397"><a id="__codelineno-9-397" name="__codelineno-9-397" href="#__codelineno-9-397"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-9-398"><a id="__codelineno-9-398" name="__codelineno-9-398" href="#__codelineno-9-398"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-399"><a id="__codelineno-9-399" name="__codelineno-9-399" href="#__codelineno-9-399"></a>                <span class="n">result</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">prompt</span><span class="p">),)</span> <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">()))</span>
</span><span id="__span-9-400"><a id="__codelineno-9-400" name="__codelineno-9-400" href="#__codelineno-9-400"></a>                <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-401"><a id="__codelineno-9-401" name="__codelineno-9-401" href="#__codelineno-9-401"></a>            <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="__span-9-402"><a id="__codelineno-9-402" name="__codelineno-9-402" href="#__codelineno-9-402"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-403"><a id="__codelineno-9-403" name="__codelineno-9-403" href="#__codelineno-9-403"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">prompt</span><span class="p">,)</span> <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">()))</span>
</span><span id="__span-9-404"><a id="__codelineno-9-404" name="__codelineno-9-404" href="#__codelineno-9-404"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">()</span>
</span><span id="__span-9-405"><a id="__codelineno-9-405" name="__codelineno-9-405" href="#__codelineno-9-405"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">StdIOProxy</span><span class="o">.</span><span class="n">_do_readline</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">)</span>
</span><span id="__span-9-406"><a id="__codelineno-9-406" name="__codelineno-9-406" href="#__codelineno-9-406"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-407"><a id="__codelineno-9-407" name="__codelineno-9-407" href="#__codelineno-9-407"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_writeln</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-9-408"><a id="__codelineno-9-408" name="__codelineno-9-408" href="#__codelineno-9-408"></a>        <span class="n">stream</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-409"><a id="__codelineno-9-409" name="__codelineno-9-409" href="#__codelineno-9-409"></a>        <span class="n">allow_set_code_page</span> <span class="o">=</span> <span class="n">streaminfo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-9-410"><a id="__codelineno-9-410" name="__codelineno-9-410" href="#__codelineno-9-410"></a>        <span class="n">flush</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;flush&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-411"><a id="__codelineno-9-411" name="__codelineno-9-411" href="#__codelineno-9-411"></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-9-412"><a id="__codelineno-9-412" name="__codelineno-9-412" href="#__codelineno-9-412"></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;sep&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="__span-9-413"><a id="__codelineno-9-413" name="__codelineno-9-413" href="#__codelineno-9-413"></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
</span><span id="__span-9-414"><a id="__codelineno-9-414" name="__codelineno-9-414" href="#__codelineno-9-414"></a>        <span class="n">sep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sep&#39;</span><span class="p">)</span>
</span><span id="__span-9-415"><a id="__codelineno-9-415" name="__codelineno-9-415" href="#__codelineno-9-415"></a>        <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-9-416"><a id="__codelineno-9-416" name="__codelineno-9-416" href="#__codelineno-9-416"></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="__span-9-417"><a id="__codelineno-9-417" name="__codelineno-9-417" href="#__codelineno-9-417"></a>            <span class="k">if</span> <span class="n">first</span><span class="p">:</span> <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-9-418"><a id="__codelineno-9-418" name="__codelineno-9-418" href="#__codelineno-9-418"></a>            <span class="k">elif</span> <span class="n">sep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-419"><a id="__codelineno-9-419" name="__codelineno-9-419" href="#__codelineno-9-419"></a>                <span class="n">StdIOProxy</span><span class="o">.</span><span class="n">_do_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">sep</span><span class="p">))</span>
</span><span id="__span-9-420"><a id="__codelineno-9-420" name="__codelineno-9-420" href="#__codelineno-9-420"></a>            <span class="n">StdIOProxy</span><span class="o">.</span><span class="n">_do_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">arg</span><span class="p">))</span>
</span><span id="__span-9-421"><a id="__codelineno-9-421" name="__codelineno-9-421" href="#__codelineno-9-421"></a>        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-422"><a id="__codelineno-9-422" name="__codelineno-9-422" href="#__codelineno-9-422"></a>            <span class="n">StdIOProxy</span><span class="o">.</span><span class="n">_do_write</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coerce</span><span class="p">(</span><span class="n">streaminfo</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
</span><span id="__span-9-423"><a id="__codelineno-9-423" name="__codelineno-9-423" href="#__codelineno-9-423"></a>        <span class="k">if</span> <span class="n">flush</span><span class="p">:</span> <span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="__span-9-424"><a id="__codelineno-9-424" name="__codelineno-9-424" href="#__codelineno-9-424"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">inputln</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readln</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
</span><span id="__span-9-425"><a id="__codelineno-9-425" name="__codelineno-9-425" href="#__codelineno-9-425"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeln</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-426"><a id="__codelineno-9-426" name="__codelineno-9-426" href="#__codelineno-9-426"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">outputln</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeln</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-427"><a id="__codelineno-9-427" name="__codelineno-9-427" href="#__codelineno-9-427"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeln</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-428"><a id="__codelineno-9-428" name="__codelineno-9-428" href="#__codelineno-9-428"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">errorln</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_writeln</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streaminfos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="__span-9-429"><a id="__codelineno-9-429" name="__codelineno-9-429" href="#__codelineno-9-429"></a>
</span><span id="__span-9-430"><a id="__codelineno-9-430" name="__codelineno-9-430" href="#__codelineno-9-430"></a><span class="k">class</span><span class="w"> </span><span class="nc">bytes_comparable_with_unicode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>  <span class="c1"># For Python 2/3 compatibility, to allow implicit conversion between strings and bytes when it is safe. (Used for strings like literals which we know be safe.)</span>
</span><span id="__span-9-431"><a id="__codelineno-9-431" name="__codelineno-9-431" href="#__codelineno-9-431"></a>    <span class="n">codec</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>  <span class="c1"># MUST be a safe encoding</span>
</span><span id="__span-9-432"><a id="__codelineno-9-432" name="__codelineno-9-432" href="#__codelineno-9-432"></a>    <span class="nd">@classmethod</span>
</span><span id="__span-9-433"><a id="__codelineno-9-433" name="__codelineno-9-433" href="#__codelineno-9-433"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">coerce</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">for_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-9-434"><a id="__codelineno-9-434" name="__codelineno-9-434" href="#__codelineno-9-434"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">codec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">other</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">bytes_comparable_with_unicode</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="k">if</span> <span class="n">for_output</span> <span class="k">else</span> <span class="n">other</span>
</span><span id="__span-9-435"><a id="__codelineno-9-435" name="__codelineno-9-435" href="#__codelineno-9-435"></a>    <span class="nd">@classmethod</span>
</span><span id="__span-9-436"><a id="__codelineno-9-436" name="__codelineno-9-436" href="#__codelineno-9-436"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">translate_if_bytes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="__span-9-437"><a id="__codelineno-9-437" name="__codelineno-9-437" href="#__codelineno-9-437"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-9-438"><a id="__codelineno-9-438" name="__codelineno-9-438" href="#__codelineno-9-438"></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-9-439"><a id="__codelineno-9-439" name="__codelineno-9-439" href="#__codelineno-9-439"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>  <span class="c1"># To avoid warning</span>
</span><span id="__span-9-440"><a id="__codelineno-9-440" name="__codelineno-9-440" href="#__codelineno-9-440"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-441"><a id="__codelineno-9-441" name="__codelineno-9-441" href="#__codelineno-9-441"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-442"><a id="__codelineno-9-442" name="__codelineno-9-442" href="#__codelineno-9-442"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-443"><a id="__codelineno-9-443" name="__codelineno-9-443" href="#__codelineno-9-443"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-444"><a id="__codelineno-9-444" name="__codelineno-9-444" href="#__codelineno-9-444"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-445"><a id="__codelineno-9-445" name="__codelineno-9-445" href="#__codelineno-9-445"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-446"><a id="__codelineno-9-446" name="__codelineno-9-446" href="#__codelineno-9-446"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-447"><a id="__codelineno-9-447" name="__codelineno-9-447" href="#__codelineno-9-447"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-448"><a id="__codelineno-9-448" name="__codelineno-9-448" href="#__codelineno-9-448"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-449"><a id="__codelineno-9-449" name="__codelineno-9-449" href="#__codelineno-9-449"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-450"><a id="__codelineno-9-450" name="__codelineno-9-450" href="#__codelineno-9-450"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-9-451"><a id="__codelineno-9-451" name="__codelineno-9-451" href="#__codelineno-9-451"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">others</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">,</span> <span class="n">others</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-452"><a id="__codelineno-9-452" name="__codelineno-9-452" href="#__codelineno-9-452"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">bytes_comparable_with_unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coerce</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="__span-9-453"><a id="__codelineno-9-453" name="__codelineno-9-453" href="#__codelineno-9-453"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-454"><a id="__codelineno-9-454" name="__codelineno-9-454" href="#__codelineno-9-454"></a>    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="__span-9-455"><a id="__codelineno-9-455" name="__codelineno-9-455" href="#__codelineno-9-455"></a>        <span class="n">__unicode__</span> <span class="o">=</span> <span class="fm">__str__</span>
</span><span id="__span-9-456"><a id="__codelineno-9-456" name="__codelineno-9-456" href="#__codelineno-9-456"></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span id="__span-9-457"><a id="__codelineno-9-457" name="__codelineno-9-457" href="#__codelineno-9-457"></a>
</span><span id="__span-9-458"><a id="__codelineno-9-458" name="__codelineno-9-458" href="#__codelineno-9-458"></a><span class="k">def</span><span class="w"> </span><span class="nf">wrap_bytes_comparable_with_unicode_readline</span><span class="p">(</span><span class="n">readline</span><span class="p">):</span>
</span><span id="__span-9-459"><a id="__codelineno-9-459" name="__codelineno-9-459" href="#__codelineno-9-459"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="__span-9-460"><a id="__codelineno-9-460" name="__codelineno-9-460" href="#__codelineno-9-460"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">readline</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-9-461"><a id="__codelineno-9-461" name="__codelineno-9-461" href="#__codelineno-9-461"></a>        <span class="n">line</span> <span class="o">=</span> <span class="n">bytes_comparable_with_unicode</span><span class="o">.</span><span class="n">translate_if_bytes</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-9-462"><a id="__codelineno-9-462" name="__codelineno-9-462" href="#__codelineno-9-462"></a>        <span class="k">return</span> <span class="n">line</span>
</span><span id="__span-9-463"><a id="__codelineno-9-463" name="__codelineno-9-463" href="#__codelineno-9-463"></a>    <span class="k">return</span> <span class="n">callback</span>
</span><span id="__span-9-464"><a id="__codelineno-9-464" name="__codelineno-9-464" href="#__codelineno-9-464"></a>
</span><span id="__span-9-465"><a id="__codelineno-9-465" name="__codelineno-9-465" href="#__codelineno-9-465"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># **kwargs = dict(stdin=file, stdout=file, stderr=file); useful for callers who import this module</span>
</span><span id="__span-9-466"><a id="__codelineno-9-466" name="__codelineno-9-466" href="#__codelineno-9-466"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>  <span class="c1"># slow import (compiles regexes etc.), so don&#39;t import it until needed</span>
</span><span id="__span-9-467"><a id="__codelineno-9-467" name="__codelineno-9-467" href="#__codelineno-9-467"></a>    <span class="n">argparser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
</span><span id="__span-9-468"><a id="__codelineno-9-468" name="__codelineno-9-468" href="#__codelineno-9-468"></a>        <span class="n">prog</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">program</span><span class="p">),</span>
</span><span id="__span-9-469"><a id="__codelineno-9-469" name="__codelineno-9-469" href="#__codelineno-9-469"></a>        <span class="n">usage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-470"><a id="__codelineno-9-470" name="__codelineno-9-470" href="#__codelineno-9-470"></a>        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-471"><a id="__codelineno-9-471" name="__codelineno-9-471" href="#__codelineno-9-471"></a>        <span class="n">epilog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-472"><a id="__codelineno-9-472" name="__codelineno-9-472" href="#__codelineno-9-472"></a>        <span class="n">parents</span><span class="o">=</span><span class="p">[],</span>
</span><span id="__span-9-473"><a id="__codelineno-9-473" name="__codelineno-9-473" href="#__codelineno-9-473"></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawTextHelpFormatter</span><span class="p">)</span>
</span><span id="__span-9-474"><a id="__codelineno-9-474" name="__codelineno-9-474" href="#__codelineno-9-474"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-version&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;show SQLite version&quot;</span><span class="p">)</span>
</span><span id="__span-9-475"><a id="__codelineno-9-475" name="__codelineno-9-475" href="#__codelineno-9-475"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-batch&#39;</span><span class="p">,</span> <span class="s1">&#39;--batch&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force batch I/O&quot;</span><span class="p">)</span>
</span><span id="__span-9-476"><a id="__codelineno-9-476" name="__codelineno-9-476" href="#__codelineno-9-476"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-init&#39;</span><span class="p">,</span> <span class="s1">&#39;--init&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILE&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;read/process named file&quot;</span><span class="p">)</span>
</span><span id="__span-9-477"><a id="__codelineno-9-477" name="__codelineno-9-477" href="#__codelineno-9-477"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;is the name of an SQLite database.</span><span class="se">\n</span><span class="s2">A new database is created if the file does not previously exist.&quot;</span><span class="p">)</span>
</span><span id="__span-9-478"><a id="__codelineno-9-478" name="__codelineno-9-478" href="#__codelineno-9-478"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SQL&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;SQL commnds to execute after opening database&quot;</span><span class="p">)</span>
</span><span id="__span-9-479"><a id="__codelineno-9-479" name="__codelineno-9-479" href="#__codelineno-9-479"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--readline&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;(true|false)&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to import readline if available (default: </span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="__span-9-480"><a id="__codelineno-9-480" name="__codelineno-9-480" href="#__codelineno-9-480"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--self-test&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform a basic self-test&quot;</span><span class="p">)</span>
</span><span id="__span-9-481"><a id="__codelineno-9-481" name="__codelineno-9-481" href="#__codelineno-9-481"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cross-test&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;perform a basic test against the official executable&quot;</span><span class="p">)</span>
</span><span id="__span-9-482"><a id="__codelineno-9-482" name="__codelineno-9-482" href="#__codelineno-9-482"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--unicode-stdio&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;(true|false)&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to enable Unicode wrapper for standard I/O (default: </span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="__span-9-483"><a id="__codelineno-9-483" name="__codelineno-9-483" href="#__codelineno-9-483"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--console&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;(true|false)&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to auto-detect and use console window APIs (default: </span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="__span-9-484"><a id="__codelineno-9-484" name="__codelineno-9-484" href="#__codelineno-9-484"></a>    <span class="n">argparser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--encoding&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">ENCODING</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the default encoding to use (default: </span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="__span-9-485"><a id="__codelineno-9-485" name="__codelineno-9-485" href="#__codelineno-9-485"></a>    <span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stdin&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stdout&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stderr&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">))</span>
</span><span id="__span-9-486"><a id="__codelineno-9-486" name="__codelineno-9-486" href="#__codelineno-9-486"></a>    <span class="n">parsed_args</span> <span class="o">=</span> <span class="n">argparser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-9-487"><a id="__codelineno-9-487" name="__codelineno-9-487" href="#__codelineno-9-487"></a>    <span class="n">codec</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">or</span> <span class="n">argparser</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s1">&#39;encoding&#39;</span><span class="p">))</span>
</span><span id="__span-9-488"><a id="__codelineno-9-488" name="__codelineno-9-488" href="#__codelineno-9-488"></a>    <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">self_test</span><span class="p">:</span> <span class="n">self_test</span><span class="p">(</span><span class="n">codec</span><span class="p">)</span>
</span><span id="__span-9-489"><a id="__codelineno-9-489" name="__codelineno-9-489" href="#__codelineno-9-489"></a>    <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">cross_test</span><span class="p">:</span> <span class="n">cross_test</span><span class="p">(</span><span class="s2">&quot;sqlite3&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="p">)</span>
</span><span id="__span-9-490"><a id="__codelineno-9-490" name="__codelineno-9-490" href="#__codelineno-9-490"></a>    <span class="n">parse_escaped_strings</span> <span class="o">=</span> <span class="n">StringEscapeParser</span><span class="p">()</span>
</span><span id="__span-9-491"><a id="__codelineno-9-491" name="__codelineno-9-491" href="#__codelineno-9-491"></a>    <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">unicode_stdio</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="__span-9-492"><a id="__codelineno-9-492" name="__codelineno-9-492" href="#__codelineno-9-492"></a>        <span class="n">stdin</span> <span class="o">=</span> <span class="n">wrap_unicode_stdio</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">codec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-9-493"><a id="__codelineno-9-493" name="__codelineno-9-493" href="#__codelineno-9-493"></a>        <span class="n">stdout</span> <span class="o">=</span> <span class="n">wrap_unicode_stdio</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">codec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-9-494"><a id="__codelineno-9-494" name="__codelineno-9-494" href="#__codelineno-9-494"></a>        <span class="n">stderr</span> <span class="o">=</span> <span class="n">wrap_unicode_stdio</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">codec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-9-495"><a id="__codelineno-9-495" name="__codelineno-9-495" href="#__codelineno-9-495"></a>    <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">console</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
</span><span id="__span-9-496"><a id="__codelineno-9-496" name="__codelineno-9-496" href="#__codelineno-9-496"></a>        <span class="n">stdin</span> <span class="o">=</span> <span class="n">wrap_windows_console_io</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-497"><a id="__codelineno-9-497" name="__codelineno-9-497" href="#__codelineno-9-497"></a>        <span class="n">stdout</span> <span class="o">=</span> <span class="n">wrap_windows_console_io</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-498"><a id="__codelineno-9-498" name="__codelineno-9-498" href="#__codelineno-9-498"></a>        <span class="n">stderr</span> <span class="o">=</span> <span class="n">wrap_windows_console_io</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-499"><a id="__codelineno-9-499" name="__codelineno-9-499" href="#__codelineno-9-499"></a>    <span class="n">allow_set_code_page</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="kc">False</span>  <span class="c1"># This is only necessary on Python 2 if we use the default I/O functions instead of bypassing to ReadConsole()/WriteConsole()</span>
</span><span id="__span-9-500"><a id="__codelineno-9-500" name="__codelineno-9-500" href="#__codelineno-9-500"></a>    <span class="n">stdio</span> <span class="o">=</span> <span class="n">StdIOProxy</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">allow_set_code_page</span><span class="p">)</span>
</span><span id="__span-9-501"><a id="__codelineno-9-501" name="__codelineno-9-501" href="#__codelineno-9-501"></a>    <span class="n">db</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-502"><a id="__codelineno-9-502" name="__codelineno-9-502" href="#__codelineno-9-502"></a>    <span class="n">no_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-9-503"><a id="__codelineno-9-503" name="__codelineno-9-503" href="#__codelineno-9-503"></a>    <span class="n">init_sql</span> <span class="o">=</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">sql</span>
</span><span id="__span-9-504"><a id="__codelineno-9-504" name="__codelineno-9-504" href="#__codelineno-9-504"></a>    <span class="n">is_nonpipe_input</span> <span class="o">=</span> <span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span>  <span class="c1"># NOT the same thing as TTY! (NUL and /dev/null are the difference)</span>
</span><span id="__span-9-505"><a id="__codelineno-9-505" name="__codelineno-9-505" href="#__codelineno-9-505"></a>    <span class="n">init_show_prompt</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">batch</span> <span class="ow">and</span> <span class="n">is_nonpipe_input</span>
</span><span id="__span-9-506"><a id="__codelineno-9-506" name="__codelineno-9-506" href="#__codelineno-9-506"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">batch</span> <span class="ow">and</span> <span class="n">isatty</span><span class="p">(</span><span class="n">stdin</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">readline</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="ow">or</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">readline</span> <span class="o">!=</span> <span class="s2">&quot;false&quot;</span><span class="p">:</span>
</span><span id="__span-9-507"><a id="__codelineno-9-507" name="__codelineno-9-507" href="#__codelineno-9-507"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-508"><a id="__codelineno-9-508" name="__codelineno-9-508" href="#__codelineno-9-508"></a>            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="__span-9-509"><a id="__codelineno-9-509" name="__codelineno-9-509" href="#__codelineno-9-509"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="__span-9-510"><a id="__codelineno-9-510" name="__codelineno-9-510" href="#__codelineno-9-510"></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">readline</span>
</span><span id="__span-9-511"><a id="__codelineno-9-511" name="__codelineno-9-511" href="#__codelineno-9-511"></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="__span-9-512"><a id="__codelineno-9-512" name="__codelineno-9-512" href="#__codelineno-9-512"></a>    <span class="k">if</span> <span class="n">parsed_args</span> <span class="ow">and</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
</span><span id="__span-9-513"><a id="__codelineno-9-513" name="__codelineno-9-513" href="#__codelineno-9-513"></a>        <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">sqlite_version</span><span class="p">);</span>
</span><span id="__span-9-514"><a id="__codelineno-9-514" name="__codelineno-9-514" href="#__codelineno-9-514"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-515"><a id="__codelineno-9-515" name="__codelineno-9-515" href="#__codelineno-9-515"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">filename</span>
</span><span id="__span-9-516"><a id="__codelineno-9-516" name="__codelineno-9-516" href="#__codelineno-9-516"></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;:memory:&quot;</span>
</span><span id="__span-9-517"><a id="__codelineno-9-517" name="__codelineno-9-517" href="#__codelineno-9-517"></a>        <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">isolation_level</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-9-518"><a id="__codelineno-9-518" name="__codelineno-9-518" href="#__codelineno-9-518"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exec_script</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ignore_io_errors</span><span class="p">):</span>
</span><span id="__span-9-519"><a id="__codelineno-9-519" name="__codelineno-9-519" href="#__codelineno-9-519"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-520"><a id="__codelineno-9-520" name="__codelineno-9-520" href="#__codelineno-9-520"></a>            <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">codec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Assume .sql files are text -- any binary data inside them should be X&#39;&#39; encoded, not embedded directly</span>
</span><span id="__span-9-521"><a id="__codelineno-9-521" name="__codelineno-9-521" href="#__codelineno-9-521"></a>                <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">sql_commands</span><span class="p">(</span><span class="n">wrap_bytes_comparable_with_unicode_readline</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()))):</span>
</span><span id="__span-9-522"><a id="__codelineno-9-522" name="__codelineno-9-522" href="#__codelineno-9-522"></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">exec_command</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">ignore_io_errors</span><span class="p">)</span>
</span><span id="__span-9-523"><a id="__codelineno-9-523" name="__codelineno-9-523" href="#__codelineno-9-523"></a>                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-524"><a id="__codelineno-9-524" name="__codelineno-9-524" href="#__codelineno-9-524"></a>                        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-525"><a id="__codelineno-9-525" name="__codelineno-9-525" href="#__codelineno-9-525"></a>        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="__span-9-526"><a id="__codelineno-9-526" name="__codelineno-9-526" href="#__codelineno-9-526"></a>            <span class="n">stdio</span><span class="o">.</span><span class="n">errorln</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-9-527"><a id="__codelineno-9-527" name="__codelineno-9-527" href="#__codelineno-9-527"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_io_errors</span><span class="p">:</span> <span class="k">return</span> <span class="n">ex</span><span class="o">.</span><span class="n">errno</span>
</span><span id="__span-9-528"><a id="__codelineno-9-528" name="__codelineno-9-528" href="#__codelineno-9-528"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
</span><span id="__span-9-529"><a id="__codelineno-9-529" name="__codelineno-9-529" href="#__codelineno-9-529"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span> <span class="n">command</span> <span class="o">=</span> <span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">command</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-530"><a id="__codelineno-9-530" name="__codelineno-9-530" href="#__codelineno-9-530"></a>        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span> <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-9-531"><a id="__codelineno-9-531" name="__codelineno-9-531" href="#__codelineno-9-531"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: unknown command or invalid arguments:  </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">. Enter </span><span class="se">\&quot;</span><span class="s2">.help</span><span class="se">\&quot;</span><span class="s2"> for help&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\&quot;</span><span class="s2">&quot;</span><span class="p">),))</span>
</span><span id="__span-9-532"><a id="__codelineno-9-532" name="__codelineno-9-532" href="#__codelineno-9-532"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">exec_command</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">ignore_io_errors</span><span class="p">):</span>
</span><span id="__span-9-533"><a id="__codelineno-9-533" name="__codelineno-9-533" href="#__codelineno-9-533"></a>        <span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-534"><a id="__codelineno-9-534" name="__codelineno-9-534" href="#__codelineno-9-534"></a>        <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-535"><a id="__codelineno-9-535" name="__codelineno-9-535" href="#__codelineno-9-535"></a>        <span class="n">query_parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-9-536"><a id="__codelineno-9-536" name="__codelineno-9-536" href="#__codelineno-9-536"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-537"><a id="__codelineno-9-537" name="__codelineno-9-537" href="#__codelineno-9-537"></a>            <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="__span-9-538"><a id="__codelineno-9-538" name="__codelineno-9-538" href="#__codelineno-9-538"></a>                <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_escaped_strings</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
</span><span id="__span-9-539"><a id="__codelineno-9-539" name="__codelineno-9-539" href="#__codelineno-9-539"></a>                <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.quit&quot;</span><span class="p">,</span> <span class="s2">&quot;.exit&quot;</span><span class="p">):</span>
</span><span id="__span-9-540"><a id="__codelineno-9-540" name="__codelineno-9-540" href="#__codelineno-9-540"></a>                    <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-9-541"><a id="__codelineno-9-541" name="__codelineno-9-541" href="#__codelineno-9-541"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.help&quot;</span><span class="p">:</span>
</span><span id="__span-9-542"><a id="__codelineno-9-542" name="__codelineno-9-542" href="#__codelineno-9-542"></a>                    <span class="n">stdio</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-9-543"><a id="__codelineno-9-543" name="__codelineno-9-543" href="#__codelineno-9-543"></a><span class="s2">.cd DIRECTORY          Change the working directory to DIRECTORY</span>
</span><span id="__span-9-544"><a id="__codelineno-9-544" name="__codelineno-9-544" href="#__codelineno-9-544"></a><span class="s2">.dump                  Dump the database in an SQL text format</span>
</span><span id="__span-9-545"><a id="__codelineno-9-545" name="__codelineno-9-545" href="#__codelineno-9-545"></a><span class="s2">.exit                  Exit this program</span>
</span><span id="__span-9-546"><a id="__codelineno-9-546" name="__codelineno-9-546" href="#__codelineno-9-546"></a><span class="s2">.help                  Show this message</span>
</span><span id="__span-9-547"><a id="__codelineno-9-547" name="__codelineno-9-547" href="#__codelineno-9-547"></a><span class="s2">.open FILE             Close existing database and reopen FILE</span>
</span><span id="__span-9-548"><a id="__codelineno-9-548" name="__codelineno-9-548" href="#__codelineno-9-548"></a><span class="s2">.print STRING...       Print literal STRING</span>
</span><span id="__span-9-549"><a id="__codelineno-9-549" name="__codelineno-9-549" href="#__codelineno-9-549"></a><span class="s2">.quit                  Exit this program</span>
</span><span id="__span-9-550"><a id="__codelineno-9-550" name="__codelineno-9-550" href="#__codelineno-9-550"></a><span class="s2">.read FILENAME         Execute SQL in FILENAME</span>
</span><span id="__span-9-551"><a id="__codelineno-9-551" name="__codelineno-9-551" href="#__codelineno-9-551"></a><span class="s2">.schema ?PATTERN?      Show the CREATE statements matching PATTERN</span>
</span><span id="__span-9-552"><a id="__codelineno-9-552" name="__codelineno-9-552" href="#__codelineno-9-552"></a><span class="s2">.show                  Show the current values for various settings</span>
</span><span id="__span-9-553"><a id="__codelineno-9-553" name="__codelineno-9-553" href="#__codelineno-9-553"></a><span class="s2">.tables ?TABLE?        List names of tables</span>
</span><span id="__span-9-554"><a id="__codelineno-9-554" name="__codelineno-9-554" href="#__codelineno-9-554"></a><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
</span><span id="__span-9-555"><a id="__codelineno-9-555" name="__codelineno-9-555" href="#__codelineno-9-555"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.cd&quot;</span><span class="p">:</span>
</span><span id="__span-9-556"><a id="__codelineno-9-556" name="__codelineno-9-556" href="#__codelineno-9-556"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-557"><a id="__codelineno-9-557" name="__codelineno-9-557" href="#__codelineno-9-557"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-9-558"><a id="__codelineno-9-558" name="__codelineno-9-558" href="#__codelineno-9-558"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.dump&quot;</span><span class="p">:</span>
</span><span id="__span-9-559"><a id="__codelineno-9-559" name="__codelineno-9-559" href="#__codelineno-9-559"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-560"><a id="__codelineno-9-560" name="__codelineno-9-560" href="#__codelineno-9-560"></a>                    <span class="n">foreign_keys</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-9-561"><a id="__codelineno-9-561" name="__codelineno-9-561" href="#__codelineno-9-561"></a>                    <span class="k">if</span> <span class="n">foreign_keys</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;OFF&quot;</span><span class="p">):</span>
</span><span id="__span-9-562"><a id="__codelineno-9-562" name="__codelineno-9-562" href="#__codelineno-9-562"></a>                        <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys=OFF;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-563"><a id="__codelineno-9-563" name="__codelineno-9-563" href="#__codelineno-9-563"></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">iterdump</span><span class="p">():</span>
</span><span id="__span-9-564"><a id="__codelineno-9-564" name="__codelineno-9-564" href="#__codelineno-9-564"></a>                        <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-565"><a id="__codelineno-9-565" name="__codelineno-9-565" href="#__codelineno-9-565"></a>                    <span class="n">stdio</span><span class="o">.</span><span class="n">output</span><span class="p">()</span>
</span><span id="__span-9-566"><a id="__codelineno-9-566" name="__codelineno-9-566" href="#__codelineno-9-566"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.open&quot;</span><span class="p">:</span>
</span><span id="__span-9-567"><a id="__codelineno-9-567" name="__codelineno-9-567" href="#__codelineno-9-567"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-568"><a id="__codelineno-9-568" name="__codelineno-9-568" href="#__codelineno-9-568"></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-9-569"><a id="__codelineno-9-569" name="__codelineno-9-569" href="#__codelineno-9-569"></a>                    <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="__span-9-570"><a id="__codelineno-9-570" name="__codelineno-9-570" href="#__codelineno-9-570"></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;option </span><span class="si">%s</span><span class="s2"> not supported&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">option</span><span class="p">),))</span>
</span><span id="__span-9-571"><a id="__codelineno-9-571" name="__codelineno-9-571" href="#__codelineno-9-571"></a>                    <span class="k">try</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-9-572"><a id="__codelineno-9-572" name="__codelineno-9-572" href="#__codelineno-9-572"></a>                    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="__span-9-573"><a id="__codelineno-9-573" name="__codelineno-9-573" href="#__codelineno-9-573"></a>                        <span class="n">ex</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;Error: unable to open database </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),)</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-9-574"><a id="__codelineno-9-574" name="__codelineno-9-574" href="#__codelineno-9-574"></a>                        <span class="k">raise</span>
</span><span id="__span-9-575"><a id="__codelineno-9-575" name="__codelineno-9-575" href="#__codelineno-9-575"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.print&quot;</span><span class="p">:</span>
</span><span id="__span-9-576"><a id="__codelineno-9-576" name="__codelineno-9-576" href="#__codelineno-9-576"></a>                    <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="__span-9-577"><a id="__codelineno-9-577" name="__codelineno-9-577" href="#__codelineno-9-577"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.read&quot;</span><span class="p">:</span>
</span><span id="__span-9-578"><a id="__codelineno-9-578" name="__codelineno-9-578" href="#__codelineno-9-578"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-579"><a id="__codelineno-9-579" name="__codelineno-9-579" href="#__codelineno-9-579"></a>                    <span class="n">exec_script</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ignore_io_errors</span><span class="p">)</span>
</span><span id="__span-9-580"><a id="__codelineno-9-580" name="__codelineno-9-580" href="#__codelineno-9-580"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.schema&quot;</span><span class="p">:</span>
</span><span id="__span-9-581"><a id="__codelineno-9-581" name="__codelineno-9-581" href="#__codelineno-9-581"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-582"><a id="__codelineno-9-582" name="__codelineno-9-582" href="#__codelineno-9-582"></a>                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-9-583"><a id="__codelineno-9-583" name="__codelineno-9-583" href="#__codelineno-9-583"></a>                    <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;table&#39;</span>
</span><span id="__span-9-584"><a id="__codelineno-9-584" name="__codelineno-9-584" href="#__codelineno-9-584"></a>                    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-585"><a id="__codelineno-9-585" name="__codelineno-9-585" href="#__codelineno-9-585"></a>                        <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span>
</span><span id="__span-9-586"><a id="__codelineno-9-586" name="__codelineno-9-586" href="#__codelineno-9-586"></a>                    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT sql || &#39;;&#39; FROM sqlite_master WHERE type = :type&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; AND name LIKE :pattern&quot;</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
</span><span id="__span-9-587"><a id="__codelineno-9-587" name="__codelineno-9-587" href="#__codelineno-9-587"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.show&quot;</span><span class="p">:</span>
</span><span id="__span-9-588"><a id="__codelineno-9-588" name="__codelineno-9-588" href="#__codelineno-9-588"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-589"><a id="__codelineno-9-589" name="__codelineno-9-589" href="#__codelineno-9-589"></a>                    <span class="n">stdio</span><span class="o">.</span><span class="n">errorln</span><span class="p">(</span><span class="s2">&quot;    filename:&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-9-590"><a id="__codelineno-9-590" name="__codelineno-9-590" href="#__codelineno-9-590"></a>                <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.tables&quot;</span><span class="p">:</span>
</span><span id="__span-9-591"><a id="__codelineno-9-591" name="__codelineno-9-591" href="#__codelineno-9-591"></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span> <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-9-592"><a id="__codelineno-9-592" name="__codelineno-9-592" href="#__codelineno-9-592"></a>                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="__span-9-593"><a id="__codelineno-9-593" name="__codelineno-9-593" href="#__codelineno-9-593"></a>                    <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;table&#39;</span>
</span><span id="__span-9-594"><a id="__codelineno-9-594" name="__codelineno-9-594" href="#__codelineno-9-594"></a>                    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-595"><a id="__codelineno-9-595" name="__codelineno-9-595" href="#__codelineno-9-595"></a>                        <span class="n">query_parameters</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span>
</span><span id="__span-9-596"><a id="__codelineno-9-596" name="__codelineno-9-596" href="#__codelineno-9-596"></a>                    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT name FROM sqlite_master WHERE type = :type&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot; AND name LIKE :pattern&quot;</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
</span><span id="__span-9-597"><a id="__codelineno-9-597" name="__codelineno-9-597" href="#__codelineno-9-597"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-598"><a id="__codelineno-9-598" name="__codelineno-9-598" href="#__codelineno-9-598"></a>                    <span class="n">raise_invalid_command_error</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-9-599"><a id="__codelineno-9-599" name="__codelineno-9-599" href="#__codelineno-9-599"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-600"><a id="__codelineno-9-600" name="__codelineno-9-600" href="#__codelineno-9-600"></a>                <span class="n">query</span> <span class="o">=</span> <span class="n">command</span>
</span><span id="__span-9-601"><a id="__codelineno-9-601" name="__codelineno-9-601" href="#__codelineno-9-601"></a>            <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-602"><a id="__codelineno-9-602" name="__codelineno-9-602" href="#__codelineno-9-602"></a>                <span class="n">results</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s1">&#39;surrogatereplace&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">query_parameters</span><span class="p">)</span>
</span><span id="__span-9-603"><a id="__codelineno-9-603" name="__codelineno-9-603" href="#__codelineno-9-603"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="__span-9-604"><a id="__codelineno-9-604" name="__codelineno-9-604" href="#__codelineno-9-604"></a>            <span class="n">stdio</span><span class="o">.</span><span class="n">errorln</span><span class="p">(</span><span class="n">exception_encode</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">codec</span><span class="p">))</span>
</span><span id="__span-9-605"><a id="__codelineno-9-605" name="__codelineno-9-605" href="#__codelineno-9-605"></a>        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-606"><a id="__codelineno-9-606" name="__codelineno-9-606" href="#__codelineno-9-606"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="__span-9-607"><a id="__codelineno-9-607" name="__codelineno-9-607" href="#__codelineno-9-607"></a>                <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">)),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-608"><a id="__codelineno-9-608" name="__codelineno-9-608" href="#__codelineno-9-608"></a>            <span class="n">stdio</span><span class="o">.</span><span class="n">output</span><span class="p">()</span>
</span><span id="__span-9-609"><a id="__codelineno-9-609" name="__codelineno-9-609" href="#__codelineno-9-609"></a>    <span class="k">if</span> <span class="n">db</span><span class="p">:</span>
</span><span id="__span-9-610"><a id="__codelineno-9-610" name="__codelineno-9-610" href="#__codelineno-9-610"></a>        <span class="k">if</span> <span class="n">parsed_args</span> <span class="ow">and</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">init</span><span class="p">:</span>
</span><span id="__span-9-611"><a id="__codelineno-9-611" name="__codelineno-9-611" href="#__codelineno-9-611"></a>            <span class="k">if</span> <span class="n">is_nonpipe_input</span><span class="p">:</span> <span class="n">stdio</span><span class="o">.</span><span class="n">errorln</span><span class="p">(</span><span class="s2">&quot;-- Loading resources from&quot;</span><span class="p">,</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
</span><span id="__span-9-612"><a id="__codelineno-9-612" name="__codelineno-9-612" href="#__codelineno-9-612"></a>            <span class="n">exec_script</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-9-613"><a id="__codelineno-9-613" name="__codelineno-9-613" href="#__codelineno-9-613"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read_stdin</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">not_in_the_middle_of_any_input</span><span class="p">,</span> <span class="n">prev_line</span><span class="p">):</span>
</span><span id="__span-9-614"><a id="__codelineno-9-614" name="__codelineno-9-614" href="#__codelineno-9-614"></a>            <span class="n">show_prompt</span> <span class="o">=</span> <span class="n">init_show_prompt</span>
</span><span id="__span-9-615"><a id="__codelineno-9-615" name="__codelineno-9-615" href="#__codelineno-9-615"></a>            <span class="n">to_write</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-616"><a id="__codelineno-9-616" name="__codelineno-9-616" href="#__codelineno-9-616"></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_sql</span><span class="p">):</span>
</span><span id="__span-9-617"><a id="__codelineno-9-617" name="__codelineno-9-617" href="#__codelineno-9-617"></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">init_sql</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="__span-9-618"><a id="__codelineno-9-618" name="__codelineno-9-618" href="#__codelineno-9-618"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
</span><span id="__span-9-619"><a id="__codelineno-9-619" name="__codelineno-9-619" href="#__codelineno-9-619"></a>                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
</span><span id="__span-9-620"><a id="__codelineno-9-620" name="__codelineno-9-620" href="#__codelineno-9-620"></a>            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_sql</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_sql</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-9-621"><a id="__codelineno-9-621" name="__codelineno-9-621" href="#__codelineno-9-621"></a>                <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-9-622"><a id="__codelineno-9-622" name="__codelineno-9-622" href="#__codelineno-9-622"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-623"><a id="__codelineno-9-623" name="__codelineno-9-623" href="#__codelineno-9-623"></a>                <span class="k">if</span> <span class="n">show_prompt</span><span class="p">:</span>
</span><span id="__span-9-624"><a id="__codelineno-9-624" name="__codelineno-9-624" href="#__codelineno-9-624"></a>                    <span class="k">if</span> <span class="n">not_in_the_middle_of_any_input</span><span class="p">:</span>
</span><span id="__span-9-625"><a id="__codelineno-9-625" name="__codelineno-9-625" href="#__codelineno-9-625"></a>                        <span class="n">show_prompt</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-9-626"><a id="__codelineno-9-626" name="__codelineno-9-626" href="#__codelineno-9-626"></a>                        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-9-627"><a id="__codelineno-9-627" name="__codelineno-9-627" href="#__codelineno-9-627"></a>                            <span class="n">to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SQLite version </span><span class="si">%s</span><span class="s2"> (adapter version </span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">Enter </span><span class="se">\&quot;</span><span class="s2">.help</span><span class="se">\&quot;</span><span class="s2"> for usage hints.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">sqlite_version</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
</span><span id="__span-9-628"><a id="__codelineno-9-628" name="__codelineno-9-628" href="#__codelineno-9-628"></a>                            <span class="k">if</span> <span class="n">no_args</span><span class="p">:</span>
</span><span id="__span-9-629"><a id="__codelineno-9-629" name="__codelineno-9-629" href="#__codelineno-9-629"></a>                                <span class="n">to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Connected to a transient in-memory database.</span><span class="se">\n</span><span class="s2">Use </span><span class="se">\&quot;</span><span class="s2">.open FILENAME</span><span class="se">\&quot;</span><span class="s2"> to reopen on a persistent database.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-630"><a id="__codelineno-9-630" name="__codelineno-9-630" href="#__codelineno-9-630"></a>                    <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">prev_line</span><span class="p">:</span>
</span><span id="__span-9-631"><a id="__codelineno-9-631" name="__codelineno-9-631" href="#__codelineno-9-631"></a>                        <span class="n">to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-632"><a id="__codelineno-9-632" name="__codelineno-9-632" href="#__codelineno-9-632"></a>                    <span class="n">to_write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%7s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;sqlite</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,)</span> <span class="k">if</span> <span class="n">not_in_the_middle_of_any_input</span> <span class="k">else</span> <span class="s2">&quot;...&gt;&quot;</span><span class="p">,))</span>
</span><span id="__span-9-633"><a id="__codelineno-9-633" name="__codelineno-9-633" href="#__codelineno-9-633"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-9-634"><a id="__codelineno-9-634" name="__codelineno-9-634" href="#__codelineno-9-634"></a>                    <span class="n">line</span> <span class="o">=</span> <span class="n">stdio</span><span class="o">.</span><span class="n">inputln</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_write</span><span class="p">))</span>
</span><span id="__span-9-635"><a id="__codelineno-9-635" name="__codelineno-9-635" href="#__codelineno-9-635"></a>                <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="__span-9-636"><a id="__codelineno-9-636" name="__codelineno-9-636" href="#__codelineno-9-636"></a>                    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-9-637"><a id="__codelineno-9-637" name="__codelineno-9-637" href="#__codelineno-9-637"></a>                    <span class="k">raise</span>  <span class="c1"># just kidding, don&#39;t handle it for now...</span>
</span><span id="__span-9-638"><a id="__codelineno-9-638" name="__codelineno-9-638" href="#__codelineno-9-638"></a>            <span class="k">return</span> <span class="n">line</span>
</span><span id="__span-9-639"><a id="__codelineno-9-639" name="__codelineno-9-639" href="#__codelineno-9-639"></a>        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">sql_commands</span><span class="p">(</span><span class="n">wrap_bytes_comparable_with_unicode_readline</span><span class="p">(</span><span class="n">read_stdin</span><span class="p">)):</span>
</span><span id="__span-9-640"><a id="__codelineno-9-640" name="__codelineno-9-640" href="#__codelineno-9-640"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">exec_command</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-9-641"><a id="__codelineno-9-641" name="__codelineno-9-641" href="#__codelineno-9-641"></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-642"><a id="__codelineno-9-642" name="__codelineno-9-642" href="#__codelineno-9-642"></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-9-643"><a id="__codelineno-9-643" name="__codelineno-9-643" href="#__codelineno-9-643"></a>        <span class="k">if</span> <span class="n">init_show_prompt</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_sql</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-9-644"><a id="__codelineno-9-644" name="__codelineno-9-644" href="#__codelineno-9-644"></a>            <span class="n">stdio</span><span class="o">.</span><span class="n">outputln</span><span class="p">()</span>
</span><span id="__span-9-645"><a id="__codelineno-9-645" name="__codelineno-9-645" href="#__codelineno-9-645"></a>
</span><span id="__span-9-646"><a id="__codelineno-9-646" name="__codelineno-9-646" href="#__codelineno-9-646"></a><span class="k">def</span><span class="w"> </span><span class="nf">call_program</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="n">input_text</span><span class="p">):</span>
</span><span id="__span-9-647"><a id="__codelineno-9-647" name="__codelineno-9-647" href="#__codelineno-9-647"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-9-648"><a id="__codelineno-9-648" name="__codelineno-9-648" href="#__codelineno-9-648"></a>    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
</span><span id="__span-9-649"><a id="__codelineno-9-649" name="__codelineno-9-649" href="#__codelineno-9-649"></a>
</span><span id="__span-9-650"><a id="__codelineno-9-650" name="__codelineno-9-650" href="#__codelineno-9-650"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_query</span><span class="p">():</span>
</span><span id="__span-9-651"><a id="__codelineno-9-651" name="__codelineno-9-651" href="#__codelineno-9-651"></a>    <span class="n">hexcodec</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">&#39;hex_codec&#39;</span><span class="p">)</span>
</span><span id="__span-9-652"><a id="__codelineno-9-652" name="__codelineno-9-652" href="#__codelineno-9-652"></a>    <span class="n">ascii</span> <span class="o">=</span> <span class="s1">&#39;ascii&#39;</span>
</span><span id="__span-9-653"><a id="__codelineno-9-653" name="__codelineno-9-653" href="#__codelineno-9-653"></a>    <span class="n">data1</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xD8\xA2</span><span class="s2">&quot;</span>
</span><span id="__span-9-654"><a id="__codelineno-9-654" name="__codelineno-9-654" href="#__codelineno-9-654"></a>    <span class="n">data2</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01\x02\xFF\x01\xFF\xFE\xFD</span><span class="s2">&quot;</span>
</span><span id="__span-9-655"><a id="__codelineno-9-655" name="__codelineno-9-655" href="#__codelineno-9-655"></a>    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">]</span>
</span><span id="__span-9-656"><a id="__codelineno-9-656" name="__codelineno-9-656" href="#__codelineno-9-656"></a>    <span class="n">query_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;SELECT </span><span class="si">%s</span><span class="s1">;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="sa">b</span><span class="s2">&quot;X&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hexcodec</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),),</span> <span class="n">values</span><span class="p">)),)</span>
</span><span id="__span-9-657"><a id="__codelineno-9-657" name="__codelineno-9-657" href="#__codelineno-9-657"></a>    <span class="n">expected_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">),)</span>
</span><span id="__span-9-658"><a id="__codelineno-9-658" name="__codelineno-9-658" href="#__codelineno-9-658"></a>    <span class="k">return</span> <span class="n">query_bytes</span><span class="p">,</span> <span class="n">expected_bytes</span>
</span><span id="__span-9-659"><a id="__codelineno-9-659" name="__codelineno-9-659" href="#__codelineno-9-659"></a>
</span><span id="__span-9-660"><a id="__codelineno-9-660" name="__codelineno-9-660" href="#__codelineno-9-660"></a><span class="k">def</span><span class="w"> </span><span class="nf">cross_test</span><span class="p">(</span><span class="n">sqlite_cmdline</span><span class="p">,</span> <span class="n">codec</span><span class="p">):</span>
</span><span id="__span-9-661"><a id="__codelineno-9-661" name="__codelineno-9-661" href="#__codelineno-9-661"></a>    <span class="p">(</span><span class="n">query_bytes</span><span class="p">,</span> <span class="n">expected_bytes</span><span class="p">)</span> <span class="o">=</span> <span class="n">test_query</span><span class="p">()</span>
</span><span id="__span-9-662"><a id="__codelineno-9-662" name="__codelineno-9-662" href="#__codelineno-9-662"></a>    <span class="p">(</span><span class="n">official_output</span><span class="p">,</span> <span class="n">official_error</span><span class="p">)</span> <span class="o">=</span> <span class="n">call_program</span><span class="p">(</span><span class="n">sqlite_cmdline</span><span class="p">,</span> <span class="n">query_bytes</span><span class="p">)</span>
</span><span id="__span-9-663"><a id="__codelineno-9-663" name="__codelineno-9-663" href="#__codelineno-9-663"></a>    <span class="c1"># We can&#39;t use os.linesep here since binaries may belong to different platforms (Win32/MinGW vs. MSYS/Cygwin vs. WSL...)</span>
</span><span id="__span-9-664"><a id="__codelineno-9-664" name="__codelineno-9-664" href="#__codelineno-9-664"></a>    <span class="n">official_output</span> <span class="o">=</span> <span class="n">official_output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-665"><a id="__codelineno-9-665" name="__codelineno-9-665" href="#__codelineno-9-665"></a>    <span class="n">official_error</span> <span class="o">=</span> <span class="n">official_error</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-9-666"><a id="__codelineno-9-666" name="__codelineno-9-666" href="#__codelineno-9-666"></a>    <span class="k">if</span> <span class="n">official_output</span> <span class="o">!=</span> <span class="n">expected_bytes</span><span class="p">:</span>
</span><span id="__span-9-667"><a id="__codelineno-9-667" name="__codelineno-9-667" href="#__codelineno-9-667"></a>        <span class="k">raise</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;expected bytes are wrong: official </span><span class="si">%s</span><span class="s2"> != expected </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">official_output</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">expected_bytes</span><span class="p">)))</span>
</span><span id="__span-9-668"><a id="__codelineno-9-668" name="__codelineno-9-668" href="#__codelineno-9-668"></a>    <span class="k">if</span> <span class="n">official_error</span><span class="p">:</span>
</span><span id="__span-9-669"><a id="__codelineno-9-669" name="__codelineno-9-669" href="#__codelineno-9-669"></a>        <span class="k">raise</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;did not expect errors from official binary&quot;</span><span class="p">)</span>
</span><span id="__span-9-670"><a id="__codelineno-9-670" name="__codelineno-9-670" href="#__codelineno-9-670"></a>
</span><span id="__span-9-671"><a id="__codelineno-9-671" name="__codelineno-9-671" href="#__codelineno-9-671"></a><span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="n">codec</span><span class="p">):</span>
</span><span id="__span-9-672"><a id="__codelineno-9-672" name="__codelineno-9-672" href="#__codelineno-9-672"></a>    <span class="p">(</span><span class="n">query_bytes</span><span class="p">,</span> <span class="n">expected_bytes</span><span class="p">)</span> <span class="o">=</span> <span class="n">test_query</span><span class="p">()</span>
</span><span id="__span-9-673"><a id="__codelineno-9-673" name="__codelineno-9-673" href="#__codelineno-9-673"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">:</span> <span class="ow">not</span> <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stdout</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">expected_bytes</span><span class="p">)(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">query_bytes</span><span class="p">),</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()):</span>
</span><span id="__span-9-674"><a id="__codelineno-9-674" name="__codelineno-9-674" href="#__codelineno-9-674"></a>        <span class="k">raise</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;byte I/O is broken&quot;</span><span class="p">)</span>
</span><span id="__span-9-675"><a id="__codelineno-9-675" name="__codelineno-9-675" href="#__codelineno-9-675"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">:</span> <span class="ow">not</span> <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stdout</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">codec</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">expected_bytes</span><span class="p">,</span> <span class="s1">&#39;surrogateescape&#39;</span><span class="p">))(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">query_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">ascii</span><span class="p">)),</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(),</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()):</span>
</span><span id="__span-9-676"><a id="__codelineno-9-676" name="__codelineno-9-676" href="#__codelineno-9-676"></a>        <span class="k">raise</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">ProgrammingError</span><span class="p">(</span><span class="s2">&quot;string I/O is broken&quot;</span><span class="p">)</span>
</span><span id="__span-9-677"><a id="__codelineno-9-677" name="__codelineno-9-677" href="#__codelineno-9-677"></a>
</span><span id="__span-9-678"><a id="__codelineno-9-678" name="__codelineno-9-678" href="#__codelineno-9-678"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-9-679"><a id="__codelineno-9-679" name="__codelineno-9-679" href="#__codelineno-9-679"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-9-680"><a id="__codelineno-9-680" name="__codelineno-9-680" href="#__codelineno-9-680"></a>    <span class="n">exit_code</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</span><span id="__span-9-681"><a id="__codelineno-9-681" name="__codelineno-9-681" href="#__codelineno-9-681"></a>    <span class="k">if</span> <span class="n">exit_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="n">exit_code</span><span class="p">)</span>
</span></code></pre></div>
</details>
<h3 id="2_3">2<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h3>
<p>Q4中，我本来写的是</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">matchmaker</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">pet</span><span class="p">,</span><span class="w"> </span><span class="n">song</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">pet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">pet</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">song</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">song</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">time</span><span class="p">;</span>
</span></code></pre></div>
<p>但是显示了这样的报错</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ambiguous<span class="w"> </span>column<span class="w"> </span>name:<span class="w"> </span>pet
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>no<span class="w"> </span>such<span class="w"> </span>table:<span class="w"> </span>matchmaker
</span></code></pre></div>
<p>分析应该是用表<em>联接</em>自身并加上了<em>别名</em>时，列的名称也需要加上<em>别名</em>，修改后最后通过</p>
<details class="note">
<summary>code</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">matchmaker</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">pet</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">song</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">pet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">pet</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">song</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">song</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">time</span><span class="p">;</span>
</span></code></pre></div>
</details>
<h3 id="3_2">3<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h3>
<p>在做Q5时发现，<strong>如果<em>联接</em>了多个表，每个表的列名需要使用 <code>.</code> 来使用</strong>，即使这个列名在其他表中不存在，例如</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="s1">&#39;7&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;True&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>这行语句运行后没有结果，或者说没有匹配的行，</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">students</span><span class="p">.</span><span class="s1">&#39;7&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;True&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>但这一行语句就会有结果</p>
<details class="note">
<summary>code</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sevens</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">seven</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">time</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="s1">&#39;7&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;True&#39;</span><span class="p">;</span>
</span></code></pre></div>
</details>
<h2 id="lecture-33-aggregation">Lecture 33 Aggregation<a class="headerlink" href="#lecture-33-aggregation" title="Permanent link">&para;</a></h2>
<h3 id="1_4">1<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_184.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_184" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_184.png" /></a></p>
<p>sql中的<em>聚合函数 Aggregation function</em> ，可以使用多行的数据进行处理，比如</p>
<ul>
<li><code>max</code> <code>min</code> 取最大/最小</li>
<li><code>sum</code> 取所有数据的和</li>
<li><code>avg</code> 取所有数据的平均值</li>
<li><code>count</code> 获取数据的个数</li>
</ul>
<p>在传入参数(列名)时，还可以在参数前添加 <code>distinct</code> ，表示这一列中重复的元素只取用一个，可以参考下图</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_185.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_185" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_185.png" /></a></p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_186.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_186" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_186.png" /></a></p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_187.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_187" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_187.png" /></a></p>
<p><em>聚合函数</em>也可以和其他普通的表达式一起混合使用，来获取其他有用的信息(同一行数据的其他信息)，如上图中John的演示，</p>
<p>但有些<em>聚合函数</em>结果不会是某行数据中的数值，</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...So, you have to be careful about selecting single values in conjunction with aggregations. Some aggregations give you a meaningful value, like <code>min</code> and <code>max</code> ; others don't, like <code>avg</code> .</p>
<hr />
<p>John:</p>
<p>...当你与聚合函数一起选择单一值时，你必须小心。有些聚合函数会给你一个有意义的值，比如 <code>min</code> 和 <code>max</code> ，而其他一些却不会，比如 <code>avg</code> 。</p>
</div>
<p>并且，从John的demo演示中可以看到，在使用 <code>min</code> 或 <code>max</code> 时，即使有多行数据都是最小/大值，但是却只是返回了一个结果</p>
<blockquote>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">legs</span><span class="p">),</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">animals</span><span class="p">;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="mi">4</span><span class="o">|</span><span class="n">cat</span>
</span></code></pre></div>
</blockquote>
<h3 id="2_4">2<a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_188.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_188" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_188.png" /></a></p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_189.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_189" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_189.png" /></a></p>
<p><em>分组 group</em></p>
<p>可以使用 <code>group by</code> 进行分组，在 <code>group by</code> 后写<strong>(单个或多个)列名或表达式</strong>，就会把每个相同的值对应的那一行分到同一个组，而如果使用<em>聚合函数</em>就会分别作用于每个组(而不是作用于整个表所有行的数据)，可以参考上图中John的demo演示</p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_190.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_190" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_190.png" /></a></p>
<p>在<em>分组</em>时，还可以使用 <code>having</code> 来<strong>对组进行筛选</strong>(区别于 <code>where</code> 是对单行数据进行筛选)</p>
<h2 id="lecture-33-qa">Lecture 33 Q&amp;A<a class="headerlink" href="#lecture-33-qa" title="Permanent link">&para;</a></h2>
<h3 id="1_5">1<a class="headerlink" href="#1_5" title="Permanent link">&para;</a></h3>
<p>有人向John提问的mentor13(在网站上没找到)的一题，</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Fill in <code>skip-list</code> , which takes in a potentially nested list <code>lst</code> and a single-argument filter function <code>filter-fn</code> that returns a boolean when called, and goes through each element in order. It returns a new list that contains all elements that return true when passed into <code>filter-fn</code> . The returned list is <em>not nested</em>.</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">;Doctests</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="nb">even?</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="p">()</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="nb">odd?</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">filter-fn</span><span class="p">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">        </span><span class="p">(</span><span class="k">cond</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">            </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">                </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">                    </span><span class="nv">______</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">                    </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">            </span><span class="p">((</span><span class="nb">pair?</span><span class="w"> </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">                </span><span class="p">(</span><span class="nf">______</span><span class="p">))</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">            </span><span class="p">((</span><span class="nf">filter-fn</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">                </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">            </span><span class="p">(</span><span class="k">else</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">                </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="p">)</span>
</span></code></pre></div>
</div>
<p>于是自己写了一下，</p>
<p>由于不清楚 <code>null?</code> 和 <code>pair?</code> 的作用，于是先试了一下，发现 <code>null?</code> 只在传入空列表 <code>nil</code> 或者 <code>()</code> 时才返回 <code>true</code> ，而 <code>pair?</code> 只在传入东西为列表，且列表不为空时返回 <code>true</code> (传入 <code>(())</code> 时也返回 <code>true</code> )。</p>
<p>最后写了好一会才写出来，这题有点复杂，因为需要把嵌套的列表给展开，</p>
<p>所以为了处理这样的情况，在进入更深层的列表时，就需要通过 <code>next</code> 参数来标记之前的位置(一开始还以为 <code>next</code> 指的是列表的之后的部分，但是想到这样的情况一般使用 <code>rest</code> 来命名)，</p>
<p>最好想的就是 <code>(filter-fn (car lst)</code> 和 <code>else</code> 两行，因为这两行就对应普通的情况，即列表不是嵌套的，那么就大概可以得到</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">((</span><span class="nf">filter-fn</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">(</span><span class="k">else</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span></code></pre></div>
<blockquote>
<p>这里我使用了scheme中的 <code>append</code> 函数，因为需要将符合筛选条件的元素拼接到 <code>lst-so-far</code> 的尾部，</p>
<p><code>append</code> 函数的用法是传入<strong>多个列表</strong>，将他们按顺序拼到一起，所以这里的代码就写成了 <code>(list (car lst))</code> </p>
<blockquote>
<p>一开始写的是</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span></code></pre></div>
<p>然后运行测试时就报错了😅</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="nb">even?</span><span class="p">)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">()</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="nb">odd?</span><span class="p">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nv">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nf">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="nb">last</span><span class="p">)</span><span class="nv">:</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="mi">1</span><span class="w">     </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="nv">Error:</span><span class="w"> </span><span class="nv">argument</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nb">append</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">wrong</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="p">(</span><span class="nf">int</span><span class="p">)</span>
</span></code></pre></div>
</blockquote>
</blockquote>
<p>接着来处理 <code>pair?</code> 这个情况，根据刚才的两种情况大概就能猜到这里应该就是判断第一个元素是不是列表，所以 <code>(pair? (car lst))</code> ，</p>
<p>于是如果是第一个元素是列表，那么肯定需要向内继续走，可以猜到这种情况下递归调用的 <code>helper</code> 的第一个参数会是 <code>(car lst)</code> ，</p>
<p>然后最关键的地方在于，需要记住 <code>lst</code> 之后的元素，一开始我以为 <code>helper</code> 第三个参数就是 <code>(cdr lst)</code> ，但想到如果再有一层嵌套的列表，原本的 <code>next</code> 就会被覆盖丢失，</p>
<p>最后想了好久终于想到应该是把两者合并到一起(这样两者的信息都包含了)，所以</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="p">((</span><span class="nb">pair?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">next</span><span class="p">)))</span>
</span></code></pre></div>
<p>于是base case的情况就不难想了，结束递归时返回 <code>lst-so-far</code> 即可，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">        </span><span class="nv">lst-so-far</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">        </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">next</span><span class="p">)))</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">)</span>
</span></code></pre></div>
<p>所以 <code>skip-list</code> 中的那一行就是</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="nv">nil</span><span class="p">)</span>
</span></code></pre></div>
<p>完整的答案为</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">filter-fn</span><span class="p">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">        </span><span class="p">(</span><span class="k">cond</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">            </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">                </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">                    </span><span class="nv">lst-so-far</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">                    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">next</span><span class="p">)))</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">            </span><span class="p">((</span><span class="nb">pair?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">next</span><span class="p">)))</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">            </span><span class="p">((</span><span class="nf">filter-fn</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">            </span><span class="p">(</span><span class="k">else</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="nv">nil</span><span class="p">)</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="p">)</span>
</span></code></pre></div>
<hr />
<p>John最后的答案和我的有些区别，他是使用了 <code>append</code> 来连接 <code>(cdr lst)</code> 和 <code>next</code> ，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span></code></pre></div>
<p>而base case中就是</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="nv">lst-so-far</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">nil</span><span class="p">))</span>
</span></code></pre></div>
<details class="note">
<summary>code</summary>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">filter-fn</span><span class="p">)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">        </span><span class="p">(</span><span class="k">cond</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">            </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">                </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">next</span><span class="p">)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">                    </span><span class="nv">lst-so-far</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">                    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">next</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">nil</span><span class="p">))</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">            </span><span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">            </span><span class="p">((</span><span class="nb">pair?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">            </span><span class="p">((</span><span class="nf">filter-fn</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">))</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)))</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">            </span><span class="p">(</span><span class="k">else</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">                </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="nv">lst-so-far</span><span class="w"> </span><span class="nv">next</span><span class="p">))</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">    </span><span class="p">(</span><span class="nf">helper</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="nv">nil</span><span class="p">)</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="p">)</span>
</span></code></pre></div>
</details>
<hr />
<p>而John又说到这题提供的代码框架中的 <code>helper</code> 函数，其实让这题变得复杂了， <code>lst-so-far</code> 对应着从头(左边)加载结果，而如果按照以往的思路，从末尾(右边)加载结果，会更简单，代码是</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="nv">nil</span><span class="p">)</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">        </span><span class="p">((</span><span class="nb">list?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">)))</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">        </span><span class="p">((</span><span class="nf">f</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">)))</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nf">skip-list</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">))))</span>
</span></code></pre></div>
<h3 id="2_5">2<a class="headerlink" href="#2_5" title="Permanent link">&para;</a></h3>
<p>有人提问的17年秋季的期末考试第6题</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p><strong>Simplify! Simplify!</strong> For this problem, consider a very small subset of Scheme containing only <strong>if</strong> expression, <code>(if pred then=part else part)</code> , and atoms including symbols, <code>#t</code> for true, and <code>#f</code> for false. Such expressions can be simplified according to the following transformation rules. Here, <code>P</code> , <code>E1</code> , and <code>E2</code> are Scheme expressions in the subset, and <code>P'</code> , <code>E1'</code> , and <code>E2'</code> are their simplified versions.</p>
<ul>
<li>The expression <code>(if P E1 E2)</code> simplified to<ul>
<li><code>E1'</code> if <code>P'</code> is <code>#t</code> .</li>
<li><code>E2'</code> if <code>P'</code> is <code>#f</code> .</li>
<li><code>E1'</code> if <code>E1'</code> equals <code>E2</code>‘ .</li>
<li>Otherwise, an <code>if</code> expression with <code>P'</code> , <code>E1'</code> , and <code>E2'</code> as the predicate, then-part, and else-part.</li>
</ul>
</li>
<li>Any expression, <code>E</code> , simplies to <code>#t</code> if <code>E</code> is <em>known to be true</em> (see below); or to <code>#f</code> if it is <em>known to be false</em>.</li>
<li>Finally, in the expression <code>(if P E1 E2)</code> , <code>P'</code> is known to be true while simplifying <code>E1</code> and is known to be false while simplifying <code>E2</code> . Initially, only <code>#t</code> is known to be true and only <code>#f</code> is known to be false.</li>
</ul>
<p>Fill in the blanks on the next page so that <code>(simp E)</code> returns the simplied version of <code>E</code> according to these rules, and the helper function <code>(simp-ontext E known-t known-f)</code> returns the simpliation of <code>E</code> given that <code>known-t</code> is a list of expressions known to be true, and <code>known-f</code> is a list of expressions known to be false.</p>
<p>For convenience, assume that <code>(nth k L)</code> is defined to return element <em>k</em> of list <code>L</code> (where 0 is the first), and that <code>(in? E L)</code> is defined to return true if and only if <em>E</em> is <code>equal?</code> to a member of the list <em>L</em>.</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">))</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">b</span><span class="p">))</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="nv">b</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="no">#t</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="no">#f</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="nv">c</span><span class="p">))</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="nv">b</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">e</span><span class="p">)))</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">e</span><span class="p">)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="no">#t</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">e</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">))</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">d</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nv">f</span><span class="p">)))</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">z</span><span class="p">)))</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">z</span><span class="p">)</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">e</span><span class="p">)</span><span class="w"> </span><span class="nv">f</span><span class="p">))</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">expr</span><span class="w"> </span><span class="nv">______</span><span class="w"> </span><span class="nv">______</span><span class="p">))</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">expr</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">  </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">pair?</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">                        </span><span class="p">(</span><span class="nf">simp-if</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">                        </span><span class="nv">expr</span><span class="p">))</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">(</span><span class="nf">______</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">        </span><span class="p">(</span><span class="nf">______</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="nv">______</span><span class="p">)))</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-if</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">then-part</span><span class="w"> </span><span class="nv">else-part</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">simp-pred</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">______</span><span class="p">)))</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-then</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">      </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-else</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">      </span><span class="nv">______</span><span class="p">)</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">    </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">          </span><span class="p">(</span><span class="nf">______</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">          </span><span class="p">(</span><span class="nf">______</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="w">          </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="nv">______</span><span class="p">))))</span>
</span></code></pre></div>
</div>
<p>于是自己写了一下</p>
<blockquote>
<p>题目中提到但解释器中并没有的两个函数 <code>nth</code> 和 <code>in?</code> ，于是我自己用代码实现</p>
<p><div class="language-scheme highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">L</span><span class="p">)</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">     </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">L</span><span class="p">)</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">     </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">L</span><span class="p">))))</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">in?</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="nv">L</span><span class="p">)</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w"> </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="nv">L</span><span class="p">)</span><span class="w"> </span><span class="nv">false</span><span class="p">)</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">       </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">L</span><span class="p">))</span><span class="w"> </span><span class="nv">true</span><span class="p">)</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">       </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nf">in?</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">L</span><span class="p">)))))</span>
</span></code></pre></div>
</p>
</blockquote>
<p>看完了题目感觉没明白需要干什么😅，但看到提供的例子就明白了。</p>
<p>题目是要实现化简 <code>if</code> 表达式的函数，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">b</span><span class="p">))</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nv">b</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="no">#t</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="no">#f</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="nv">c</span><span class="p">))</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nv">b</span>
</span></code></pre></div>
<p>这两个例子展示了最简单的能化简的情况，</p>
<ul>
<li>如果满足和不满足条件，返回的两种结果是一样的，那么直接表达式可以化简成这个结果</li>
<li>如果条件<strong>可以确定为真</strong>，那么就返回 满足时的表达式的<strong>简化版</strong> ，而如果<strong>可以确定为假</strong>，就返回 不满足时的表达式的<strong>简化版</strong></li>
</ul>
<p>而更复杂的情况可以参考第4个例子</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="nv">e</span><span class="p">)))</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">e</span><span class="p">)</span>
</span></code></pre></div>
<blockquote>
<p>一开始看到这个例子没想明白要如何实现这样的操作，但之后看到了代码就明白了</p>
</blockquote>
<p>在这个例子中，需要理解一个<strong>关键之处</strong>， <code>(if a b c)</code> 能转变成 <code>b</code> ，是因为如果已经进入到需要运算 <code>(if a b c)</code> 表达式时，<strong>说明 <code>a</code> 已经确定为真了</strong>(因为联系到题目中说到 <code>known-t</code> 和 <code>known-f</code> 是 确定为真/假的表达式的列表)</p>
<p>然后看代码，核心的部分是 <code>simp-if</code> 再是 <code>simp-context</code> ，看到 <code>simp-if</code> 中的这一行，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">simp-pred</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">______</span><span class="p">)))</span><span class="w"> </span><span class="o">...</span><span class="p">)</span>
</span></code></pre></div>
<p>我就明白了，<code>simp-context</code> 是用来<strong>化简单个表达式</strong>，继而明白 <code>simp-if</code> 是用来化简 <code>if</code> 表达式的，</p>
<p>因此大概可以猜出，这一行的空应该就是最简单的 <code>known-t known-f</code> ，继而又很容易可以想到 <code>simp-then</code> 和 <code>simp-else</code> 也需要调用 <code>simp-context</code> 并各自把 <code>pred</code> 加上</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-then</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">  </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">then-part</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">known-t</span><span class="p">)</span><span class="w"> </span><span class="nv">known-f</span><span class="p">))</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-else</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">  </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">else-part</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)))</span>
</span></code></pre></div>
<p>于是最后的 <code>cond</code> 中，就对应题目中的四个情况，不难写出代码，但需要注意均要使用化简之后的表达式，其中最后一种情况对应不能化简的情况，则需要把各个部分重新(用 <code>list</code> )拼成 <code>if</code> 表达式，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">      </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">      </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-then</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">      </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="ss">&#39;if</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">simp-then</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)))))</span>
</span></code></pre></div>
<p>然后 <code>simp-context</code> 中，就是需要判断化简后的表达式 <code>simp-expr</code> (给了肯定有用肯定是要用上的😅)是不是在 <code>known-t</code> 或者 <code>known-f</code> 中，</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nf">in?</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="nv">known-t</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">      </span><span class="p">((</span><span class="nf">in?</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">      </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="nv">simp-expr</span><span class="p">)))</span>
</span></code></pre></div>
<p>最后的 <code>simp</code> 中就很容易了，</p>
<p>所以完整的代码是这样</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">  </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">expr</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="no">#t</span><span class="p">)</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="no">#f</span><span class="p">)))</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">expr</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">  </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">pair?</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">                        </span><span class="p">(</span><span class="nf">simp-if</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">nth</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">                        </span><span class="nv">expr</span><span class="p">))</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nf">in?</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="nv">known-t</span><span class="p">)</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">        </span><span class="p">((</span><span class="nf">in?</span><span class="w"> </span><span class="nv">simp-expr</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="nv">simp-expr</span><span class="p">)))</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-if</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">then-part</span><span class="w"> </span><span class="nv">else-part</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">simp-pred</span><span class="w"> </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">pred</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)))</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-then</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">      </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">then-part</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">known-t</span><span class="p">)</span><span class="w"> </span><span class="nv">known-f</span><span class="p">))</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">    </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">simp-else</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">      </span><span class="p">(</span><span class="nf">simp-context</span><span class="w"> </span><span class="nv">else-part</span><span class="w"> </span><span class="nv">known-t</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">known-f</span><span class="p">)))</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">    </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="no">#t</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">          </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="no">#f</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">          </span><span class="p">((</span><span class="nb">equal?</span><span class="w"> </span><span class="nv">simp-then</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)</span><span class="w"> </span><span class="nv">simp-then</span><span class="p">)</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">          </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="ss">&#39;if</span><span class="w"> </span><span class="nv">simp-pred</span><span class="w"> </span><span class="nv">simp-then</span><span class="w"> </span><span class="nv">simp-else</span><span class="p">)))))</span>
</span></code></pre></div>
<p>感觉这题还是挺有意思的</p>
<h3 id="3_3">3<a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h3>
<p>在测试scheme代码时发现，课程(之前hw和lab中)提供的scheme解释器中内置了加载 <code>.scm</code> 文件的函数 <code>load</code> ，</p>
<p>发现了几种加载的方式，</p>
<ul>
<li>
<p>1</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="s">&quot;文件名&quot;</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>2</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="ss">&#39;文件名</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
<p>以及，如果不添加文件后缀名，会默认认为是scm文件，即会自动添加 <code>.scm</code></p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="nv">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nf">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="nb">last</span><span class="p">)</span><span class="nv">:</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">  </span><span class="mi">0</span><span class="w">     </span><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="nv">Error:</span><span class="w"> </span><span class="p">[</span><span class="nv">Errno</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">such</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nv">directory:</span><span class="w"> </span><span class="ss">&#39;a</span><span class="o">.</span><span class="nv">scm</span><span class="o">&#39;</span><span class="w"> </span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="o">&#39;..</span><span class="nv">/a</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="nv">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nf">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="nb">last</span><span class="p">)</span><span class="nv">:</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">  </span><span class="mi">0</span><span class="w">     </span><span class="p">(</span><span class="k">load</span><span class="w"> </span><span class="p">(</span><span class="k">quote</span><span class="w"> </span><span class="o">..</span><span class="nv">/a</span><span class="p">))</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="nv">Error:</span><span class="w"> </span><span class="p">[</span><span class="nv">Errno</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="nv">No</span><span class="w"> </span><span class="nv">such</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nv">directory:</span><span class="w"> </span><span class="o">&#39;..</span><span class="nv">/a</span><span class="o">.</span><span class="nv">scm</span><span class="o">&#39;</span><span class="w"> </span>
</span></code></pre></div>
<h2 id="lecture-34-database">Lecture 34 Database<a class="headerlink" href="#lecture-34-database" title="Permanent link">&para;</a></h2>
<h3 id="1_6">1<a class="headerlink" href="#1_6" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_191.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_191" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_191.png" /></a></p>
<p>sql中创建数据表的操作，</p>
<p>John说到，只需要掌握部分即可(图中黑色的部分)</p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_192.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_192" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_192.png" /></a></p>
<p>删除表的操作</p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_193.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_193" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_193.png" /></a></p>
<p>在表上的插入的操作</p>
<hr />
<p>John的demo演示</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">primes</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="p">);</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">table</span><span class="p">:</span><span class="w"> </span><span class="n">primes</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">primes</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span><span class="w"> </span><span class="n">prime</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">primes</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">primes</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="mi">4</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="mi">6</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">primes</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">6</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="mi">4</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="mi">6</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="mi">8</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="mi">9</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="mi">10</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="mi">11</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="mi">12</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="mi">13</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">primes</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">12</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-37"><a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="mi">4</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-38"><a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-39"><a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a><span class="mi">6</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-40"><a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-41"><a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="mi">8</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-42"><a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="mi">9</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-43"><a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a><span class="mi">10</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-44"><a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a><span class="mi">11</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-45"><a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a><span class="mi">12</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-46"><a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a><span class="mi">13</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-47"><a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a><span class="mi">14</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-48"><a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a><span class="mi">15</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-49"><a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a><span class="mi">16</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-50"><a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a><span class="mi">17</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-51"><a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a><span class="mi">18</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-52"><a id="__codelineno-43-52" name="__codelineno-43-52" href="#__codelineno-43-52"></a><span class="mi">19</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-53"><a id="__codelineno-43-53" name="__codelineno-43-53" href="#__codelineno-43-53"></a><span class="mi">20</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-54"><a id="__codelineno-43-54" name="__codelineno-43-54" href="#__codelineno-43-54"></a><span class="mi">21</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-55"><a id="__codelineno-43-55" name="__codelineno-43-55" href="#__codelineno-43-55"></a><span class="mi">22</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-56"><a id="__codelineno-43-56" name="__codelineno-43-56" href="#__codelineno-43-56"></a><span class="mi">23</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-57"><a id="__codelineno-43-57" name="__codelineno-43-57" href="#__codelineno-43-57"></a><span class="mi">24</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-43-58"><a id="__codelineno-43-58" name="__codelineno-43-58" href="#__codelineno-43-58"></a><span class="mi">25</span><span class="o">|</span><span class="mi">1</span>
</span></code></pre></div>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_194.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_194" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_194.png" /></a></p>
<p>更新表中列的数据的操作 <code>update</code></p>
<p>John的demo演示</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">primes</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">prime</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;</span><span class="mi">2</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">n</span><span class="o">%</span><span class="mi">2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="mi">4</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="mi">6</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="mi">8</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="mi">9</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="mi">10</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="mi">11</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="mi">12</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="mi">13</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="mi">14</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="mi">15</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="mi">16</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="mi">17</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="mi">18</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="mi">19</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="mi">20</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="mi">21</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="mi">22</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="mi">23</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="mi">24</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="mi">25</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">primes</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">prime</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;</span><span class="mi">3</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">n</span><span class="o">%</span><span class="mi">3</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">primes</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">prime</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">n</span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">n</span><span class="o">%</span><span class="mi">5</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="mi">4</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-34"><a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a><span class="mi">6</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-35"><a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-36"><a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a><span class="mi">8</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-37"><a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a><span class="mi">9</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-38"><a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a><span class="mi">10</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-39"><a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a><span class="mi">11</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-40"><a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="mi">12</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-41"><a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a><span class="mi">13</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-42"><a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a><span class="mi">14</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-43"><a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a><span class="mi">15</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-44"><a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a><span class="mi">16</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-45"><a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a><span class="mi">17</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-46"><a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a><span class="mi">18</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-47"><a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a><span class="mi">19</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-48"><a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a><span class="mi">20</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-49"><a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a><span class="mi">21</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-50"><a id="__codelineno-44-50" name="__codelineno-44-50" href="#__codelineno-44-50"></a><span class="mi">22</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-51"><a id="__codelineno-44-51" name="__codelineno-44-51" href="#__codelineno-44-51"></a><span class="mi">23</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-44-52"><a id="__codelineno-44-52" name="__codelineno-44-52" href="#__codelineno-44-52"></a><span class="mi">24</span><span class="o">|</span><span class="mi">0</span>
</span><span id="__span-44-53"><a id="__codelineno-44-53" name="__codelineno-44-53" href="#__codelineno-44-53"></a><span class="mi">25</span><span class="o">|</span><span class="mi">0</span>
</span></code></pre></div>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_195.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_195" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_195.png" /></a></p>
<p>表中删除的操作</p>
<p>John的demo演示</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">primes</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">prime</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">primes</span><span class="p">;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="mi">2</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="mi">3</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="mi">5</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="mi">7</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="mi">11</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="mi">13</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="mi">17</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="mi">19</span><span class="o">|</span><span class="mi">1</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="mi">23</span><span class="o">|</span><span class="mi">1</span>
</span></code></pre></div>
<h3 id="2_6">2<a class="headerlink" href="#2_6" title="Permanent link">&para;</a></h3>
<p>John demo演示了如何在python中使用sql</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_196.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_196" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_196.png" /></a></p>
<ul>
<li>
<p>使用 <code>sqlite3.Connection("xxx.db")</code> 来加载db文件，然后会返回一个 <code>Connection</code> 类的实例</p>
<blockquote>
<p>db文件是<em>数据库 database</em>文件</p>
</blockquote>
</li>
<li>
<p>使用 <code>execute</code> 方法可以执行sql的命令/语句</p>
<p>并且，可以有如上图中的这样的操作</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO nums VALUES (?), (?), (?);&quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span></code></pre></div>
</li>
<li>
<p>调用 <code>execute</code> 方法，方法的返回值有 <code>fetchall</code> 方法，可以将本来应该显示的数据转换成元组，如上图中的</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM nums;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>~/lec$<span class="w"> </span>python3<span class="w"> </span>ex.py
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="o">[(</span><span class="m">2</span>,<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">3</span>,<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">4</span>,<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">5</span>,<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">6</span>,<span class="o">)]</span>
</span></code></pre></div>
</li>
<li>
<p>使用 <code>commit</code> 方法可以将数据储存到对应的db文件中，如果没有这个文件会新建一个文件，上图John的demo演示中，运行 <code>python3 ex.py</code> 前已经运行 <code>rm n.db</code> 命令</p>
</li>
</ul>
<h3 id="3_4">3<a class="headerlink" href="#3_4" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_197.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_197" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_197.png" /></a></p>
<p>John说道，为了避免在python中使用sql，插入某些特殊的名字而引发的一些错误，要(如上图)使用 <code>execute</code> 方法来插入名字，</p>
<p>而不是使用python的字符串拼接和 <code>executescript</code> 方法( <code>executescript</code> 方法会执行多行sql语句)</p>
<h2 id="lecture-34-qa">Lecture 34 Q&amp;A<a class="headerlink" href="#lecture-34-qa" title="Permanent link">&para;</a></h2>
<h3 id="1_7">1<a class="headerlink" href="#1_7" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_198.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_198" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_198.png" /></a></p>
<p>John解释之前课上用python和sql模拟<em>赌场21点 Casino Blackjack</em>游戏的代码中的 <code>sqlite3.Connection</code> 类的具体作用</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>The question is, here are some demos from today's lecture. There's this line that's like "build a connection" to some database,</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s1">&#39;number.db&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>and then, you know, we give it a name – give it any name you want, "db" or "n" or something like that. What would happen if you evaluated this same expression a second time? Would that give you a new database or the same database, or would it erase the old one? Like, what's the story?</p>
<p>And the story is that this name, which describes the name of a file on your file system, is a database that won't ever just get erased. Instead, it's persistent. Even if you quit Python and start Python again, it will retain whatever information was in it before. If you evaluate this expression multiple times, then you just get multiple connections to the same database with the same data in it, and that's okay. Actually, databases are designed to have multiple connections.</p>
<p>And what do these connections mean? That means different programs might all be changing the database or querying the database at the same time. But that doesn't mean that the database is going to get refreshed or changed or something like that. It basically just stays there and accumulates information over time. If one program changes it and then another program queries it, that second program is going to see the changes from the first program.</p>
<p>So, I think within a particular Python program, there really isn't a good reason to have multiple connections. Usually, those multiple connections come from multiple Python programs, or maybe they're not all Python, but you certainly could do it, and I don't think anything would break.</p>
<hr />
<p>John:</p>
<p>问题是，这里有今天讲座中的一些演示。有这样一行代码，类似于“建立一个连接”到某个数据库，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s1">&#39;number.db&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>然后，你知道，我们给它一个名字 - 随便取个名字，比如“db”或“n”之类的。如果你多次评估相同的表达式会发生什么？这会给你一个新的数据库还是相同的数据库，或者会擦除旧的数据库？这是什么情况？</p>
<p>故事是，这个描述你文件系统上文件名的名称是一个数据库，它不会被轻易擦除。相反，它是持久的。即使你退出 Python 并重新启动 Python，它将保留之前的所有信息。如果你多次评估这个表达式，那么你只是得到对同一个数据库的多个连接，其中包含相同的数据，这是可以的。实际上，数据库被设计为具有多个连接。</p>
<p>那么这些连接意味着什么？这意味着不同的程序可能会同时更改数据库或查询数据库。但这并不意味着数据库会被刷新、更改或类似的事情。它基本上就在那里，并随着时间累积信息。如果一个程序更改了它，然后另一个程序查询它，那么第二个程序将看到第一个程序的更改。</p>
<p>因此，我认为在一个特定的 Python 程序中，没有真正需要有多个连接的好理由。通常，这些多个连接来自多个 Python 程序，或者它们并非全部都是 Python，但你当然可以这样做，我认为不会有什么问题。</p>
</div>
<h3 id="2_7">2<a class="headerlink" href="#2_7" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_199.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_199" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_199.png" /></a></p>
<p>有人提问scheme中在 <code>let</code> 中的 <code>define</code> 是否会影响到全局框架，</p>
<p>John进行演示，发现 <strong><code>let</code> 语句中嵌套的 <code>define</code> 语句并不会修改上一层框架，而只会修改 <code>let</code> 的框架</strong></p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">x</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="mi">2</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="nv">a</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="nv">Traceback</span><span class="w"> </span><span class="p">(</span><span class="nf">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="nv">call</span><span class="w"> </span><span class="nb">last</span><span class="p">)</span><span class="nv">:</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="mi">0</span><span class="w">     </span><span class="nv">a</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="nv">Error:</span><span class="w"> </span><span class="nv">unknown</span><span class="w"> </span><span class="nv">identifier:</span><span class="w"> </span><span class="nv">a</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">x</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">a</span><span class="p">))</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="mi">2</span>
</span></code></pre></div>
<h3 id="3_5">3<a class="headerlink" href="#3_5" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_200.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_200" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_200.png" /></a></p>
<p>有人提问sql中 <code>select</code> 能不能嵌套在 <code>where</code> 中，于是John演示了一种用法</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="p">;</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="mi">1</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="mi">2</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="mi">3</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="mi">5</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="n">sqlite</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">NUMBERS</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="mi">1</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="mi">2</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="mi">3</span>
</span></code></pre></div>
<p>一开始还没理解这是什么意思😅，看了一会之后才明白，括号内的 <code>select</code> 语句大概是从原来的表创建了一行新的数据，然后用这行新的数据在 <code>where</code> 中进行筛选，所以这里 <code>MAX(n)</code> 最后获得的是5，而小于5的只有1 2 3</p>
<p>但是觉得这种用法确实如同John说的一样没什么太大的作用😅</p>
<h2 id="hw-09">HW 09<a class="headerlink" href="#hw-09" title="Permanent link">&para;</a></h2>
<h3 id="1_8">1<a class="headerlink" href="#1_8" title="Permanent link">&para;</a></h3>
<p>Q2中，一开始想的是判断父母在不在 <code>parents</code> 中，但最后发现排序需要按照父母的身高来排序，所以发现只能判断子女在不在 <code>parents</code> 中，</p>
<p>并且需要注意的是，是从高到矮排序，所以需要乘一个 <code>-1</code> (一开始没注意结果刚好反过来了😅)</p>
<details class="note">
<summary>code</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">by_parent_height</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">child</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">parents</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">dogs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">height</span><span class="o">*-</span><span class="mi">1</span><span class="p">;</span>
</span></code></pre></div>
</details>
<h3 id="2_8">2<a class="headerlink" href="#2_8" title="Permanent link">&para;</a></h3>
<p>Q3题目的提示中提到sql中连接字符串要使用 <code>||</code></p>
<blockquote>
<p><strong>Hint</strong>: In order to concatenate two strings into one, use the <code>||</code> operator.</p>
</blockquote>
<details class="note">
<summary>code</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">siblings</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">child</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">first_child</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">child</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">second_child</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">parents</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">parents</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">child</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">child</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">parent</span><span class="p">;</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sentences</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="ss">&quot;The two siblings, &quot;</span><span class="o">||</span><span class="n">a</span><span class="p">.</span><span class="n">first_child</span><span class="o">||</span><span class="ss">&quot; plus &quot;</span><span class="o">||</span><span class="n">a</span><span class="p">.</span><span class="n">second_child</span><span class="o">||</span><span class="ss">&quot; have the same size: &quot;</span><span class="o">||</span><span class="n">b</span><span class="p">.</span><span class="k">size</span><span class="w"> </span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">siblings</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">size_of_dogs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">size_of_dogs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">c</span><span class="w"> </span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">first_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">second_child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="k">size</span><span class="p">;</span>
</span></code></pre></div>
</details>
<h2 id="lecture-35-tail-calls">Lecture 35 Tail Calls<a class="headerlink" href="#lecture-35-tail-calls" title="Permanent link">&para;</a></h2>
<h3 id="1_9">1<a class="headerlink" href="#1_9" title="Permanent link">&para;</a></h3>
<p>John介绍了一下 <em>函数式编程 Functional Programming</em></p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_201.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_201" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_201.png" /></a></p>
<blockquote>
<p>所有的函数都是纯函数。</p>
<p>没有重新赋值，也没有可变的数据类型。</p>
<p>名称-值的绑定是永久的。</p>
<p>函数式编程的优势：</p>
<ul>
<li>表达式的值与子表达式求值的顺序无关。</li>
<li>子表达式可以安全地并行或按需(惰性地)进行求值。</li>
<li><strong>引用透明性</strong>：当我们用子表达式的值替换该子表达式的值时，表达式的值不会改变。</li>
</ul>
</blockquote>
<h3 id="2_9">2<a class="headerlink" href="#2_9" title="Permanent link">&para;</a></h3>
<p>John提到了区分出尾调用的一种方法，</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...It's a distinction that figures out whether, when one procedure is calling another procedure, is there more work to do when that called procedure is finished or not. If there isn't anything else to do, besides just return the value of the expression you call, well then that's a tail call.</p>
<hr />
<p>John:</p>
<p>...这是一种区分的方法，用于确定当一个过程调用另一个过程时，调用的过程完成后是否还有其他工作要做。如果除了返回你调用的表达式的值之外没有其他事情要做，那么这就是一个尾调用。</p>
</div>
<p>然后又介绍了尾调用的一些特征</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_202.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_202" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_202.png" /></a></p>
<h3 id="3_6">3<a class="headerlink" href="#3_6" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_203.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_203" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_203.png" /></a></p>
<p>John说道 是<em>线性递归 linear recursion</em>但不是/不满足尾调用格式的函数，可以被改写成尾递归/尾调用的形式，并用求链表长度的函数来说明</p>
<h3 id="4_1">4<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<p>John举了几个例子说明<strong>是尾递归</strong>的函数是什么样的</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_204.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_204" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_204.png" /></a></p>
<h3 id="5_1">5<a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_205.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_205" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_205.png" /></a></p>
<p>John在用 <code>reduce</code> 函数讲解尾调用，说在 <code>reduce</code> 的实现中，除了 <code>(procedure start (car s))</code> 都是尾调用，而最终 <code>reduce</code> 是否只需使用固定大小的空间 取决于 <code>procedure</code> 是否使用固定大小的空间</p>
<h3 id="6_1">6<a class="headerlink" href="#6_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_206.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_206" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_206.png" /></a></p>
<p>John讲解如何将 <code>map</code> 函数改写成尾递归的形式，</p>
<p>大致的思路是，先将应用函数到目标链表上，得到一个倒序的链表(因为要尾递归的话就只能从尾部开始)，然后再将倒序的链表的顺序转换回来( <code>reverse</code> 函数)，而这个过程也是尾递归的，所以整个 <code>map</code> 就实现了尾递归的形式</p>
<h2 id="lab-13">Lab 13<a class="headerlink" href="#lab-13" title="Permanent link">&para;</a></h2>
<h3 id="1_10">1<a class="headerlink" href="#1_10" title="Permanent link">&para;</a></h3>
<p>发现这个lab的zip中的 <code>sqlite_shell.py</code> 文件和lab12中一样是<strong>空的</strong></p>
<h3 id="2_10">2<a class="headerlink" href="#2_10" title="Permanent link">&para;</a></h3>
<p>在写Q3时，发现 <code>where</code> 放在 <code>group by</code> 之后会报错，</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">near</span><span class="w"> </span><span class="ss">&quot;where&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">syntax</span><span class="w"> </span><span class="n">error</span>
</span></code></pre></div>
<p>然后调整了一下顺序之后就好了</p>
<details class="note">
<summary>code</summary>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">helper</span><span class="w"> </span><span class="k">as</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">MSRP</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">rating</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">store</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">store</span><span class="w"> </span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lowest_prices</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">item</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">category</span><span class="p">;</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shopping_list</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">  </span><span class="c1">-- SELECT &quot;REPLACE THIS LINE WITH YOUR SOLUTION&quot;;</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">helper</span><span class="p">;</span>
</span></code></pre></div>
</details>
<h2 id="lecture-36-macros">Lecture 36 Macros<a class="headerlink" href="#lecture-36-macros" title="Permanent link">&para;</a></h2>
<h3 id="1_11">1<a class="headerlink" href="#1_11" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_207.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_207" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_207.png" /></a></p>
<p>关于 <em>宏 Macro</em> 的一些说明</p>
<blockquote>
<p>宏调用表达式的求值过程:</p>
<ul>
<li>计算操作符子表达式，其结果为一个宏</li>
<li>对操作数表达式进行调用，<u><em>而不先对它们进行求值</em></u></li>
<li>计算从宏过程返回的表达式</li>
</ul>
</blockquote>
<h3 id="2_11">2<a class="headerlink" href="#2_11" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_208.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_208" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_208.png" /></a></p>
<p>John演示了如果不使用<em>宏</em>，就无法实现 <code>twice</code> 函数，</p>
<h3 id="3_7">3<a class="headerlink" href="#3_7" title="Permanent link">&para;</a></h3>
<p>John演示了使用 <code>define-macro</code> 和 <code>define</code> 应用于同样的代码的不同效果</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_209.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_209" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_209.png" /></a></p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_210.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_210" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_210.png" /></a></p>
<h2 id="lab-14">Lab 14<a class="headerlink" href="#lab-14" title="Permanent link">&para;</a></h2>
<h3 id="1_12">1<a class="headerlink" href="#1_12" title="Permanent link">&para;</a></h3>
<p>Q1，需要注意没有返回值(从测试文档中可以得知)</p>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">prune_min</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>        <span class="k">return</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>    <span class="n">min_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">branches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>    <span class="n">prune_min</span><span class="p">(</span><span class="n">min_b</span><span class="p">)</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>    <span class="n">t</span><span class="o">.</span><span class="n">branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_b</span><span class="p">]</span>
</span></code></pre></div>
</details>
<h3 id="2_12">2<a class="headerlink" href="#2_12" title="Permanent link">&para;</a></h3>
<p>Q2这题没有给例子，所以导致我一开始没理解准确题目的意思😅，理解准确了就不是很难了，</p>
<p>这是两个测试的例子</p>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="p">(</span><span class="nb">split-at</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="nv">scm&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="p">(</span><span class="nb">split-at</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</span></code></pre></div>
<details class="note">
<summary>code</summary>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">split-at</span><span class="w"> </span><span class="nv">lst</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">  </span><span class="ss">&#39;YOUR-CODE-HERE</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">or</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">      </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nf">rest</span><span class="w"> </span><span class="p">(</span><span class="nb">split-at</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">           </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">lst</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">rest</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">rest</span><span class="p">))))</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="p">)</span>
</span></code></pre></div>
</details>
<h3 id="3_8">3<a class="headerlink" href="#3_8" title="Permanent link">&para;</a></h3>
<p>Q3这题有点难想，我想了一会才想出代码</p>
<details class="note">
<summary>code</summary>
<div class="language-scheme highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nf">compose-all</span><span class="w"> </span><span class="nv">funcs</span><span class="p">)</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">  </span><span class="ss">&#39;YOUR-CODE-HERE</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="nv">funcs</span><span class="p">)</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">      </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">      </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="nf">compose-all</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">funcs</span><span class="p">))</span><span class="w"> </span><span class="p">((</span><span class="nb">car</span><span class="w"> </span><span class="nv">funcs</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">))))</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="p">)</span>
</span></code></pre></div>
</details>
<h3 id="4_2">4<a class="headerlink" href="#4_2" title="Permanent link">&para;</a></h3>
<p>Q4这题挺难的，想了好久才想出来</p>
<p>一开始以为，需要将列表中的元素一个一个递归地去除来判断(可能是scheme写多了的原因😅)，然后尝试了很久都没有思路，</p>
<p>在重新理解这个例子时，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">num_splits</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># splits to [1, 4] and [5]</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="mi">1</span>
</span></code></pre></div>
<p>突然想到 <code>1 - 5 + 4 = 0</code> ，然后就想到了可以<strong>通过给数字加上正负号来判断分到哪一边</strong>，于是写了一个辅助函数</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span><span class="p">):</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">current_diff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current_diff</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>        <span class="k">return</span> <span class="n">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></code></pre></div>
<p>判断 <code>current_diff &gt;= 0</code> 本来是想通过这样来去掉相反顺序/边的一半(顺序相反的话最后的差值应该刚好是相反数)，但是就在 <code>num_splits([1, 5, 4], 0)</code> 这个例子中，重复的另一半<strong>差值也刚好是0</strong>，于是最后得到了2</p>
<p>然后思考了一会后，修改成了直接算出包含重复的所有的情况，再除2就好了</p>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">num_splits</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span><span class="p">):</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_diff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>            <span class="k">return</span> <span class="n">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">d</span><span class="p">,</span> <span class="n">current_diff</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>    <span class="k">return</span> <span class="n">spliter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></code></pre></div>
</details>
<h3 id="4_3">4<a class="headerlink" href="#4_3" title="Permanent link">&para;</a></h3>
<p>Q6，这题题目看着比较复杂，但其实大概的代码框架基本上都已经写好了，需要填充的部分思路和之前的一题大致上是类似的，所以最后写起来还是比较好写的</p>
<p>写的过程中发现，<strong>python中字符串不能用 切片赋值</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">align_skeleton</span><span class="p">(</span><span class="n">skeleton</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Courses\cs61a\lab\lab14\lab14.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">189</span><span class="p">,</span> <span class="ow">in</span> <span class="n">align_skeleton</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>    <span class="n">result</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Courses\cs61a\lab\lab14\lab14.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">178</span><span class="p">,</span> <span class="ow">in</span> <span class="n">helper_align</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>    <span class="n">match_match</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">skel_char</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;str&#39;</span> <span class="nb">object</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">item</span> <span class="n">assignment</span>
</span></code></pre></div>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">align_skeleton</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="sd">    Aligns the given skeleton with the given code, minimizing the edit distance between</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="sd">    the two. Both skeleton and code are assumed to be valid one-line strings of code. </span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;&quot;, code=&quot;&quot;)</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="sd">    &#39;&#39;</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;&quot;, code=&quot;i&quot;)</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="sd">    &#39;+[i]&#39;</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;i&quot;, code=&quot;&quot;)</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="sd">    &#39;-[i]&#39;</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;i&quot;, code=&quot;i&quot;)</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="sd">    &#39;i&#39;</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;i&quot;, code=&quot;j&quot;)</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="sd">    &#39;+[j]-[i]&#39;</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;x=5&quot;, code=&quot;x=6&quot;)</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="sd">    &#39;x=+[6]-[5]&#39;</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;return x&quot;, code=&quot;return x+1&quot;)</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="sd">    &#39;returnx+[+]+[1]&#39;</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;while x&lt;y&quot;, code=&quot;for x&lt;y&quot;)</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="sd">    &#39;+[f]+[o]+[r]-[w]-[h]-[i]-[l]-[e]x&lt;y&#39;</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="sd">    &gt;&gt;&gt; align_skeleton(skeleton=&quot;def f(x):&quot;, code=&quot;def g(x):&quot;)</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="sd">    &#39;def+[g]-[f](x):&#39;</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>    <span class="n">skeleton</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">skeleton</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span><span class="p">,</span> <span class="n">code_idx</span><span class="p">):</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="sd">        Aligns the given skeletal segment with the code.</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="sd">        Returns (match, cost)</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a><span class="sd">            match: the sequence of corrections as a string</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a><span class="sd">            cost: the cost of the corrections, in edits</span>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a>        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a>            <span class="n">edits</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;-[&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">skeleton</span><span class="p">[</span><span class="n">skeleton_idx</span><span class="p">:]])</span>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a>            <span class="k">return</span> <span class="n">edits</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="o">-</span> <span class="n">skeleton_idx</span>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a>        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>            <span class="n">edits</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;+[&quot;</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">code</span><span class="p">[</span><span class="n">code_idx</span><span class="p">:]])</span>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a>            <span class="k">return</span> <span class="n">edits</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">-</span> <span class="n">code_idx</span>
</span><span id="__span-65-42"><a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a>
</span><span id="__span-65-43"><a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a>        <span class="n">possibilities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-65-44"><a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a>        <span class="n">skel_char</span><span class="p">,</span> <span class="n">code_char</span> <span class="o">=</span> <span class="n">skeleton</span><span class="p">[</span><span class="n">skeleton_idx</span><span class="p">],</span> <span class="n">code</span><span class="p">[</span><span class="n">code_idx</span><span class="p">]</span>
</span><span id="__span-65-45"><a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a>        <span class="c1"># Match</span>
</span><span id="__span-65-46"><a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a>        <span class="k">if</span> <span class="n">skel_char</span> <span class="o">==</span> <span class="n">code_char</span><span class="p">:</span>
</span><span id="__span-65-47"><a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a>            <span class="n">match_match</span><span class="p">,</span> <span class="n">cost_match</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">code_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-65-48"><a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a>            <span class="n">match_match</span> <span class="o">=</span> <span class="n">skel_char</span> <span class="o">+</span> <span class="n">match_match</span>
</span><span id="__span-65-49"><a id="__codelineno-65-49" name="__codelineno-65-49" href="#__codelineno-65-49"></a>            <span class="n">possibilities</span> <span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_match</span><span class="p">,</span> <span class="n">cost_match</span><span class="p">))</span>
</span><span id="__span-65-50"><a id="__codelineno-65-50" name="__codelineno-65-50" href="#__codelineno-65-50"></a>        <span class="c1"># Insert</span>
</span><span id="__span-65-51"><a id="__codelineno-65-51" name="__codelineno-65-51" href="#__codelineno-65-51"></a>        <span class="n">match_insert</span><span class="p">,</span> <span class="n">cost_insert</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span><span class="p">,</span> <span class="n">code_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-65-52"><a id="__codelineno-65-52" name="__codelineno-65-52" href="#__codelineno-65-52"></a>        <span class="c1"># match_insert[0:0] = &quot;+[&quot; + code_char + &quot;]&quot;</span>
</span><span id="__span-65-53"><a id="__codelineno-65-53" name="__codelineno-65-53" href="#__codelineno-65-53"></a>        <span class="n">match_insert</span> <span class="o">=</span> <span class="s2">&quot;+[&quot;</span> <span class="o">+</span> <span class="n">code_char</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span> <span class="o">+</span> <span class="n">match_insert</span>
</span><span id="__span-65-54"><a id="__codelineno-65-54" name="__codelineno-65-54" href="#__codelineno-65-54"></a>        <span class="n">possibilities</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_insert</span><span class="p">,</span> <span class="n">cost_insert</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-65-55"><a id="__codelineno-65-55" name="__codelineno-65-55" href="#__codelineno-65-55"></a>        <span class="c1"># Delete</span>
</span><span id="__span-65-56"><a id="__codelineno-65-56" name="__codelineno-65-56" href="#__codelineno-65-56"></a>        <span class="n">match_delete</span><span class="p">,</span> <span class="n">cost_delete</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">code_idx</span><span class="p">)</span>
</span><span id="__span-65-57"><a id="__codelineno-65-57" name="__codelineno-65-57" href="#__codelineno-65-57"></a>        <span class="c1"># match_delete[0:0] = &quot;-[&quot; + skel_char + &quot;]&quot;</span>
</span><span id="__span-65-58"><a id="__codelineno-65-58" name="__codelineno-65-58" href="#__codelineno-65-58"></a>        <span class="n">match_delete</span> <span class="o">=</span> <span class="s2">&quot;-[&quot;</span> <span class="o">+</span> <span class="n">skel_char</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span> <span class="o">+</span> <span class="n">match_delete</span>
</span><span id="__span-65-59"><a id="__codelineno-65-59" name="__codelineno-65-59" href="#__codelineno-65-59"></a>        <span class="n">possibilities</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_delete</span><span class="p">,</span> <span class="n">cost_delete</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-65-60"><a id="__codelineno-65-60" name="__codelineno-65-60" href="#__codelineno-65-60"></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">possibilities</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-65-61"><a id="__codelineno-65-61" name="__codelineno-65-61" href="#__codelineno-65-61"></a>    <span class="n">result</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-65-62"><a id="__codelineno-65-62" name="__codelineno-65-62" href="#__codelineno-65-62"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
</details>
<h3 id="5_2">5<a class="headerlink" href="#5_2" title="Permanent link">&para;</a></h3>
<p>Q8，这题一开始没看见需要用 <code>foldl</code> 或者 <code>foldr</code> 来实现，所以直接写出来了</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">filterl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>    <span class="k">if</span> <span class="n">lst</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>        <span class="k">return</span> <span class="n">lst</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>    <span class="k">elif</span> <span class="n">pred</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">):</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>        <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">filterl</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>        <span class="k">return</span> <span class="n">filterl</span><span class="p">(</span><span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
</span></code></pre></div>
<p>之后用 <code>foldl</code> 实现了，但是感觉用了 <code>foldl</code> 的我的代码并没有比之前简单😅</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">filterl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fn_pred</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pred</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>            <span class="k">return</span> <span class="n">r</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>        <span class="k">elif</span> <span class="n">r</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>            <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>            <span class="n">r</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>            <span class="k">return</span> <span class="n">r</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">fn_pred</span><span class="p">,</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
<p>然后想了想，按照题目的意思，使用 <code>foldl</code> 或者 <code>foldr</code> 应该是能简化代码，又想到 <code>foldl</code> 中是将链表中的元素<strong>从左到右</strong>应用到 <code>fn</code> 中，所以 <code>foldr</code> 函数就应该(刚好相反)是<strong>从右到左</strong>应用链表中的元素，于是用代码实现了 <code>foldr</code> </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Right fold &quot;&quot;&quot;</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>    <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>        <span class="k">return</span> <span class="n">z</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>    <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="n">foldr</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">link</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</span></code></pre></div>
<p>然后用 <code>foldr</code> 实现了这题(这样就简单多了😊)</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">filterl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>    <span class="k">return</span> <span class="n">foldr</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">pred</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">r</span><span class="p">,</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<p>之后去<a href="https://inst.eecs.berkeley.edu/~cs61a/fa21/lab/lab14/">21年秋季学期的lab14</a>中，看到了实现 <code>foldr</code> 函数的题目<a href="https://inst.eecs.berkeley.edu/~cs61a/fa21/lab/lab14/#q12-fold-right">Fold Right</a></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Right fold</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="sd">    &gt;&gt;&gt; lst = Link(3, Link(2, Link(1)))</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="sd">    &gt;&gt;&gt; foldr(lst, sub, 0) # (3 - (2 - (1 - 0)))</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="sd">    2</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="sd">    &gt;&gt;&gt; foldr(lst, add, 0) # (3 + (2 + (1 + 0)))</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="sd">    6</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="sd">    &gt;&gt;&gt; foldr(lst, mul, 1) # (3 * (2 * (1 * 1)))</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="sd">    6</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span></code></pre></div>
<p>发现就跟我刚才想的一样，</p>
<p>不过需要注意的是， <strong><code>fn</code> 的两个参数的位置和我之前的实现是反过来的</strong>，因此最后 <code>foldr</code> 和 <code>filterl</code> <strong>正确的实现代码</strong>应该是</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Right fold &quot;&quot;&quot;</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>    <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>        <span class="k">return</span> <span class="n">z</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>    <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">foldr</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">filterl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>    <span class="k">return</span> <span class="n">foldr</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">pred</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">else</span> <span class="n">r</span><span class="p">,</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="6_2">6<a class="headerlink" href="#6_2" title="Permanent link">&para;</a></h3>
<p>Q9，这题有点意思，题目中说需要用到之前实现的 <code>foldl</code> 函数，并且只需要一行代码就可以实现了，</p>
<p>一开始我写的是</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
<p>然后发生了报错</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>  <span class="o">...</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>  <span class="n">File</span> <span class="s2">&quot;C:\Courses\cs61a\lab\lab14\lab14.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">237</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;tuple&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;first&#39;</span>
</span></code></pre></div>
<p>然后意识到传入的 <code>fn</code> 应该原始的值在第一个参数位，于是修改了一下顺序</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
<p>但是还是报错了</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;first&#39;</span>
</span></code></pre></div>
<p>然后我意识到 <code>foldl</code> 函数中拿到的应该是 <code>lst</code> 的元素，于是最后就改好了</p>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
</details>
<hr />
<p>写完Q10之后尝试了一下 Extra for experience，即不适用 <code>Link</code> 构造函数来实现 <code>reverse</code> (可以不使用 <code>foldl</code> 和 <code>foldr</code> )，感觉还行，写了一个辅助函数就能实现了</p>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">reverse</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>    <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reverse_helper</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>        <span class="k">if</span> <span class="n">lst</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>            <span class="k">return</span> <span class="n">rest</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>            <span class="n">old_rest</span><span class="p">,</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">rest</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>            <span class="k">return</span> <span class="n">reverse_helper</span><span class="p">(</span><span class="n">old_rest</span><span class="p">,</span> <span class="n">lst</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>    <span class="k">return</span> <span class="n">reverse_helper</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
</span></code></pre></div>
</details>
<h3 id="7_1">7<a class="headerlink" href="#7_1" title="Permanent link">&para;</a></h3>
<p>Q10，这题题目不难理解，但是代码的实现思路有点绕，我想了好一会才捋清楚(因为要把顺序反过来😅)</p>
<p>我最后是借助第一个测试用例来理解的，</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">foldr</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># (3 - (2 - (1 - 0)))</span>
</span></code></pre></div>
<blockquote>
<p>把这个测试用例中的 <code>-</code> 看成是 <code>fn</code></p>
</blockquote>
<p>和</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">foldl2</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># (((0 - 3) - 2) - 1)</span>
</span></code></pre></div>
<p>在 <code>foldr</code> 中，到达链表的末尾时，就会直接返回初始值 <code>z</code> ，即 <code>identity</code> 函数，然后 <code>step</code> 就会接收到 <code>1</code> 和 <code>identity</code> (分别对应 <code>x</code> 和 <code>g</code> )，而在 <code>foldl2</code> 中，是需要把 <code>1</code> <strong><mark>套在最外面</mark></strong>，所以这里的 <code>step</code> 是需要返回一个 <code>f(?) = (? - 1)</code> 函数的函数，</p>
<p>而最后返回到了最开始时， <code>x</code> 对应 <code>3</code> ， <code>g</code> 就应该对应的是一个 <code>f(?) = ((? - 2) - 1)</code> 的函数，而这时会被传入 <code>foldl2</code> 的 <code>z</code> 和 <code>3</code> ，所以 <code>?</code> 对应的就是 <code>fn(z, x)</code> ，即 <code>step</code> 中应该是 <code>g(fn(z, x))</code> ，最后差不多就做出来了</p>
<details class="note">
<summary>code</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">foldl2</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>        <span class="s2">&quot;*** YOUR CODE HERE ***&quot;</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>        <span class="k">return</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">g</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>    <span class="k">return</span> <span class="n">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">identity</span><span class="p">)(</span><span class="n">z</span><span class="p">)</span>
</span></code></pre></div>
</details>
<h2 id="lecture-36-qa">Lecture 36 Q&amp;A<a class="headerlink" href="#lecture-36-qa" title="Permanent link">&para;</a></h2>
<h3 id="1_13">1<a class="headerlink" href="#1_13" title="Permanent link">&para;</a></h3>
<p>有人提问19年秋季期末考试第6题c题，</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p><strong>(20 points) Palindromes</strong></p>
<p><strong>Definition.</strong> A palindrome is a sequence that has the same elements in normal and reverse order.</p>
<p><strong>(a) (3 pt)</strong> Implement <code>pal</code> , which takes a positive integer <code>n</code> and returns a positive integer with the digits of <code>n</code> followed by the digits of <code>n</code> in reverse order.</p>
<p><strong>Important:</strong> You may not write <code>str</code> , <code>repr</code> , <code>list</code> , <code>tuple</code> , <code>[</code> , or <code>]</code> .</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">pal</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a palindrome starting with n.</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="sd">    &gt;&gt;&gt; pal(12430)</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="sd">    1243003421</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>    <span class="k">while</span> <span class="n">m</span><span class="p">:</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>        <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">____________________________________</span> <span class="p">,</span> <span class="n">____________________________________</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a>    <span class="k">return</span> <span class="n">n</span>
</span></code></pre></div>
<p><strong>(b) (4 pt)</strong> Implement <code>contains</code> , which takes non-negative integers <code>a</code> and <code>b</code> . It returns whether all of the digits of a also appear in order among the digits of <code>b</code> .</p>
<p><strong>Important:</strong> You may not write <code>str</code> , <code>repr</code> , <code>list</code> , <code>tuple</code> , <code>[</code> , or <code>]</code> .</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether the digits of a are contained in the digits of b.</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="sd">    &gt;&gt;&gt; contains(357, 12345678)</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="sd">    True</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="sd">    &gt;&gt;&gt; contains(753, 12345678)</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="sd">    False</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="sd">    &gt;&gt;&gt; contains(357, 37)</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="sd">    False</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a>    <span class="k">if</span> <span class="n">________________________________________</span> <span class="o">&gt;</span> <span class="n">_________________________________________</span><span class="p">:</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a>    <span class="k">if</span> <span class="n">________________________________________</span> <span class="o">==</span> <span class="n">________________________________________</span><span class="p">:</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a>        <span class="k">return</span> <span class="n">contains</span><span class="p">(</span> <span class="n">_______________________________</span> <span class="p">,</span> <span class="n">_______________________________</span> <span class="p">)</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>        <span class="k">return</span> <span class="n">contains</span><span class="p">(</span> <span class="n">_______________________________</span> <span class="p">,</span> <span class="n">_______________________________</span> <span class="p">)</span>
</span></code></pre></div>
<p><strong>(c) (6 pt)</strong> Implement <code>big</code> , a helper function for <code>biggest_palindrome</code> . The <code>biggest_palindrome</code> function takes a non-negative integer <code>n</code> and returns the largest palindrome integer with an even number of digits that appear among the digits of <code>n</code> in order. If there is no even-length palindrome among the digits of <code>n</code> , then <code>biggest_palindrome(n)</code> returns 0. You may call <code>pal</code> and <code>contains</code> . </p>
<p><strong>Important:</strong> You may not write <code>str</code> , <code>repr</code> , <code>list</code> , <code>tuple</code> , <code>[</code> , or <code>]</code> .</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">biggest_palindrome</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the largest even-length palindrome in n.</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(3425534)</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="sd">    4554</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(126130450234125)</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="sd">    21300312</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>    <span class="k">return</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A helper function for biggest_palindrome.&quot;&quot;&quot;</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a>    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">big</span><span class="p">(</span> <span class="n">_________________</span> <span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="p">,</span> <span class="n">big</span><span class="p">(</span> <span class="n">_________________</span> <span class="p">,</span> <span class="n">_________________</span> <span class="p">)]</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>    <span class="k">if</span> <span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">______________________________________________________________________</span><span class="p">):</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a>        <span class="n">__________________________________________________________________________________</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>(d) (1 pt)</strong> Circle the term that fills in the blank: the <code>is_palindrome</code> function defined below runs in ____ time in the length of its input.</p>
<ul>
<li>Constant</li>
<li>Logarithmic</li>
<li>Linear</li>
<li>Quadratic</li>
<li>Exponential</li>
<li>None of these</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_palindrome</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether a list of numbers s is a palindrome.&quot;&quot;&quot;</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))])</span>
</span></code></pre></div>
<p>Assume that <code>len</code> runs in constant time and <code>all</code> runs in linear time in the length of its input. Selecting an element of a list by its index requires constant time. Constructing a <code>range</code> requires constant time.</p>
<p><strong>(e) (6 pt)</strong> Implement <code>outer</code> , a helper function for <code>palinkdrome</code> . The <code>palinkdrome</code> function takes a positive integer <code>n</code> and returns a one-argument function that, when called repeatedly <code>n</code> times, returns a <code>Link</code> containing the sequence of arguments to the repeated calls followed by that sequence in reverse order. The <code>Link</code> class appears on Page 2 (left column) of the Midterm 2 study guide.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">palinkdrome</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a function that returns a palindrome starting with the args of n repeated calls.</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="sd">    &gt;&gt;&gt; print(palinkdrome(3)(5)(6)(7))</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="sd">    &lt;5 6 7 7 6 5&gt;</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="sd">    &gt;&gt;&gt; print(palinkdrome(1)(4))</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="sd">    &lt;4 4&gt;</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>    <span class="k">return</span> <span class="n">outer</span><span class="p">(</span><span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">outer</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">inner</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">______________________________________________________________</span><span class="p">)</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">__________________________________________________________________</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a>            <span class="k">while</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a>                <span class="n">t</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">________________</span><span class="p">,</span> <span class="n">________________</span><span class="p">)</span> <span class="p">,</span> <span class="n">________________</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a>            <span class="k">return</span> <span class="n">t</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a>            <span class="k">return</span> <span class="n">____________________________________________________________</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a>    <span class="k">return</span> <span class="n">________________________________________________________________________</span>
</span></code></pre></div>
</div>
<blockquote>
<div class="language-python highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Link</span><span class="p">:</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A linked list.</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="sd">    &gt;&gt;&gt; s = Link(1)</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="sd">    &gt;&gt;&gt; s.first</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="sd">    1</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="sd">    &gt;&gt;&gt; s.rest is Link.empty</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="sd">    True</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="sd">    &gt;&gt;&gt; s = Link(2, Link(3, Link(4)))</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="sd">    &gt;&gt;&gt; s.first = 5</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="sd">    &gt;&gt;&gt; s.rest.first = 6</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="sd">    &gt;&gt;&gt; s.rest.rest = Link.empty</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="sd">    &gt;&gt;&gt; s                                    # Displays the contents of repr(s)</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="sd">    Link(5, Link(6))</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="sd">    &gt;&gt;&gt; s.rest = Link(7, Link(Link(8, Link(9))))</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="sd">    &gt;&gt;&gt; s</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="sd">    Link(5, Link(7, Link(Link(8, Link(9)))))</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="sd">    &gt;&gt;&gt; print(s)                             # Prints str(s)</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="sd">    &lt;5 7 &lt;8 9&gt;&gt;</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a>    <span class="n">empty</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">empty</span><span class="p">):</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a>        <span class="k">assert</span> <span class="n">rest</span> <span class="ow">is</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">Link</span><span class="p">)</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">rest</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a>            <span class="n">rest_repr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rest</span><span class="p">)</span>
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a>            <span class="n">rest_repr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a>        <span class="k">return</span> <span class="s1">&#39;Link(&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_repr</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="__span-87-34"><a id="__codelineno-87-34" name="__codelineno-87-34" href="#__codelineno-87-34"></a>
</span><span id="__span-87-35"><a id="__codelineno-87-35" name="__codelineno-87-35" href="#__codelineno-87-35"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-87-36"><a id="__codelineno-87-36" name="__codelineno-87-36" href="#__codelineno-87-36"></a>        <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span>
</span><span id="__span-87-37"><a id="__codelineno-87-37" name="__codelineno-87-37" href="#__codelineno-87-37"></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-87-38"><a id="__codelineno-87-38" name="__codelineno-87-38" href="#__codelineno-87-38"></a>            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
</span><span id="__span-87-39"><a id="__codelineno-87-39" name="__codelineno-87-39" href="#__codelineno-87-39"></a>            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest</span>
</span><span id="__span-87-40"><a id="__codelineno-87-40" name="__codelineno-87-40" href="#__codelineno-87-40"></a>        <span class="k">return</span> <span class="n">string</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span></code></pre></div>
</blockquote>
<p>于是尝试自己写一下，发现确实c题难想😅，</p>
<p>我看到代码的时候，大概能想到他的大致想法/思路，但是不知到要如何用代码实现(跟他给的代码框架对不上)。</p>
<p>一开始看完了代码之后，我最先猜到的是 <code>choices</code> 这行的作用</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">big</span><span class="p">(</span><span class="n">_________________</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">big</span><span class="p">(</span><span class="n">_________________</span><span class="p">,</span> <span class="n">_________________</span> <span class="p">)]</span>
</span></code></pre></div>
<p>我想到应该是<strong>考虑最后一位是否算入回文数中/是否取用最后一位</strong>，</p>
<blockquote>
<p>比如 213123 这个数字，如果取用3，那么结果只能是33，如果不取用3的话，结果应是2112</p>
</blockquote>
<p>并且将两种情况的结果都放到 <code>choices</code> 中，最后再选其中的最大值(对应 <code>return max(choices)</code> 这行代码)，</p>
<p>然后又注意到这是个递归的结构，所以应该是要将 <code>n // 10</code> 传入，所以大概猜测这行代码是这样</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)]</span>
</span></code></pre></div>
<p>而在 <code>if</code> 中，感觉应该是满足一个什么条件，会把一个结果加到 <code>choices</code> 中，然后又根据之前写的代码中 <code>k</code> 只是回文的一半，所以感觉这行可能是</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="n">choices</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pal</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</span></code></pre></div>
<p>而由于我忽略了 <code>k * 10 + n % 10</code> 这里刚好<strong>会 <mark>以倒过来的顺序</mark> 把原始数字的数位放到 <code>k</code> 上</strong>，所以一开始在 <code>if</code> 的判断条件中，我写的是</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">if</span> <span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">pal</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
</span></code></pre></div>
<p>但是测试时与正确结果不对</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="n">Failed</span> <span class="n">example</span><span class="p">:</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>    <span class="n">biggest_palindrome</span><span class="p">(</span><span class="mi">126130450234125</span><span class="p">)</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="n">Expected</span><span class="p">:</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>    <span class="mi">21300312</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="n">Got</span><span class="p">:</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>    <span class="mi">2143223412</span>
</span></code></pre></div>
<p>本来已经想不出要如何修改了，但随便尝试修改了一下</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="k">if</span> <span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></code></pre></div>
<p>然后惊奇地发现通过测试了😮，于是之后就想明白了原因</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">biggest_palindrome</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the largest even-length palindrome in n.</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(3425534)</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="sd">    4554</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(126130450234125)</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="sd">    21300312</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>    <span class="k">return</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A helper function for biggest_palindrome.&quot;&quot;&quot;</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)]</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>    <span class="k">if</span> <span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>        <span class="n">choices</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pal</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
</span></code></pre></div>
<p>所有的题目的代码</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">(a)</label><label for="__tabbed_1_2">(b)</label><label for="__tabbed_1_3">(c)</label><label for="__tabbed_1_4">(e)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">pal</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a palindrome starting with n.</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="sd">    &gt;&gt;&gt; pal(12430)</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="sd">    1243003421</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>    <span class="k">while</span> <span class="n">m</span><span class="p">:</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>        <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">m</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">10</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>    <span class="k">return</span> <span class="n">n</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return whether the digits of a are contained in the digits of b.</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="sd">    &gt;&gt;&gt; contains(357, 12345678)</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="sd">    True</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="sd">    &gt;&gt;&gt; contains(753, 12345678)</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="sd">    False</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="sd">    &gt;&gt;&gt; contains(357, 37)</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="sd">    False</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-96-15"><a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a>    <span class="k">if</span> <span class="n">a</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">b</span> <span class="o">%</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-96-16"><a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a>        <span class="k">return</span> <span class="n">contains</span><span class="p">(</span><span class="n">a</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">b</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-96-17"><a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-96-18"><a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a>        <span class="k">return</span> <span class="n">contains</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">biggest_palindrome</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the largest even-length palindrome in n.</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(3425534)</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="sd">    4554</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="sd">    &gt;&gt;&gt; biggest_palindrome(126130450234125)</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="sd">    21300312</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>    <span class="k">return</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">big</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A helper function for biggest_palindrome.&quot;&quot;&quot;</span>
</span><span id="__span-97-13"><a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-97-14"><a id="__codelineno-97-14" name="__codelineno-97-14" href="#__codelineno-97-14"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-97-15"><a id="__codelineno-97-15" name="__codelineno-97-15" href="#__codelineno-97-15"></a>    <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">big</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)]</span>
</span><span id="__span-97-16"><a id="__codelineno-97-16" name="__codelineno-97-16" href="#__codelineno-97-16"></a>    <span class="k">if</span> <span class="n">contains</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-97-17"><a id="__codelineno-97-17" name="__codelineno-97-17" href="#__codelineno-97-17"></a>        <span class="n">choices</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pal</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
</span><span id="__span-97-18"><a id="__codelineno-97-18" name="__codelineno-97-18" href="#__codelineno-97-18"></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">palinkdrome</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a function that returns a palindrome starting with the args of n repeated calls.</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="sd">    &gt;&gt;&gt; print(palinkdrome(3)(5)(6)(7))</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="sd">    &lt;5 6 7 7 6 5&gt;</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="sd">    &gt;&gt;&gt; print(palinkdrome(1)(4))</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="sd">    &lt;4 4&gt;</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a>    <span class="k">return</span> <span class="n">outer</span><span class="p">(</span><span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">outer</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">inner</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a>            <span class="k">while</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a>                <span class="n">t</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">rest</span>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a>            <span class="k">return</span> <span class="n">t</span>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a>            <span class="k">return</span> <span class="n">outer</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a>    <span class="k">return</span> <span class="n">inner</span>
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<p>有人问道John是如何处理这个问题的，下面是John的解释</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>Yeah, great question. So how do you approach this problem? What are the steps? Um, one is to recognize that there's a tree recursion problem. You could do that from the syntax because there are two calls to <code>big</code> , or you could do that from the kind of nature of the problem, which is they were doing some search among all the possible subsets of digits in here. Which one's the biggest looks like a tree recursion problem. Um, so you have to look for a way to distill that into a sequence of choices.</p>
<p>And, uh, a common sequence of choices that you have is to keep the last digit or you don't. I mean, we've seen that in a few different examples. Um, but and so it happens to apply here. Sometimes it's not clear what kind of sequence of choices you need to make, but that is a big part of solving a tree recursion problem. So, um, yeah, how you figure out what that choice is is to think about all the different possibilities that you need to consider. So, all the different palindromes within here, and how would I enumerate that set? Well, all the ones that have a four at the end and all the ones that don't is a way of partitioning that set using an operation that I could repeat over and over again. So, that's how you kind of figure out what choice you're going to be making.</p>
<p>I guess that got us as far as thinking probably what we're going to do is call <code>big</code> where we keep the last digit and <code>big</code> where we don't. Now is the hard part, which is how are we going to represent this notion of keeping the last digit? It's not like we have a list called digits where we're appending the last digit to. Instead, what we're doing is we're effectively reassigning k. Here, k either stays the same or k includes one more digit than it was before. So, whenever you make a recursive call, a good way to think about what you're doing is that you're assigning these formal parameters to new values.</p>
<p>So, I guess that starts to explain what's going on here. The last piece is very problem-specific. How would you know that you've found a palindrome and therefore you want to consider that as one of the choices? You know, these two lines wouldn't show up in any other tree recursion problems. They're really just about palindromes because it happens to be that one way of describing a palindrome is that you find some digits within half the number, and then you make sure those digits also appear in the other half of the number in reverse order. How would you discover this? I guess, um, hopefully, the definition of the palindrome would get you there. Like, how do you describe a palindrome? It's like some digits, and then those digits also have to be contained in the other half of the number in reverse order.</p>
<hr />
<p>John:</p>
<p>是的，这是一个很好的问题。那么你如何解决这个问题？有哪些步骤？嗯，首先要认识到这是一个树递归问题。你可以从语法上看出来，因为有两次对 <code>big</code> 的调用，或者你可以从问题的性质上看出来，他们在这里进行了一些搜索，搜索所有可能的数字子集，找出其中最大的一个，看起来像一个树递归问题。那么，你必须寻找一种将其归纳为一系列选择的方法。</p>
<p>而且，你通常会有一系列共同的选择，比如保留最后一位数字或者不保留。我的意思是，我们在几个不同的例子中都看到过。但是在某些情况下，不清楚需要做出什么样的选择，但这是解决树递归问题的一个重要部分。所以，嗯，你如何确定这个选择是什么，就是考虑你需要考虑的所有不同可能性。</p>
<p>所以，在这里面的所有不同回文数，我该如何枚举这个集合呢？嗯，所有以四结尾的回文数和所有不以四结尾的回文数是一种划分这个集合的方法，使用一个可以一遍又一遍重复的操作。所以，这就是你如何想出你将要做出的选择的方式。</p>
<p>我想，这让我们想到，我们可能要做的事情是调用保留最后一位数字的 <code>big</code> ，和不保留的 <code>big</code> 。现在，困难的部分来了，就是我们如何表示保留最后一位数字的这个概念呢？这不像我们有一个名为digits的列表，我们在其中添加最后一位数字。相反，我们正在有效地重新分配k。在这里，k要么保持不变，要么比以前多包含一位数字。所以，每当你进行递归调用时，思考你正在做的事情的一个好方法是，你正在将这些形式参数赋予新的值。</p>
<p>所以，我想这开始解释这里发生了什么。最后一块是非常特定于问题的。你如何知道找到了一个回文数，因此你想把它视为选择之一？你知道，这两行不会出现在任何其他树递归问题中。它们实际上只涉及回文数，因为碰巧描述回文数的一种方式是，在数字的一半中找到一些数字，然后确保这些数字也以相反的顺序出现在数字的另一半中。你如何发现这一点呢？我想，希望回文数的定义会让你明白。就像，你如何描述一个回文数，就是一些数字，然后这些数字也必须包含在数字的另一半中，并且是相反的顺序。</p>
</div>
<h3 id="2_13">2<a class="headerlink" href="#2_13" title="Permanent link">&para;</a></h3>
<p>有人提问19年夏季期末考试的第8题</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p><strong>(10 points) The Big SQL</strong></p>
<p>The <code>ingredients</code> table describes the <code>dish</code> and <code>part</code> for each part of each dish at a restaurant. The <code>shops</code> table describes the <code>food</code> , <code>shop</code> , and <code>price</code> for each part of a dish sold at each of two shops. All ingredients (parts) are sold by both shops, and each ingredient will only appear once for each shop. Write your SQL statements so that they would still be correct if table contents changed. You can assume the shops table will only ever contain two shops ( <code>A</code> and <code>B</code> ).</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ingredients</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;chili&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dish</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;beans&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">UNION</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;chili&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;onions&quot;</span><span class="w">        </span><span class="k">UNION</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;soup&quot;</span><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;broth&quot;</span><span class="w">         </span><span class="k">UNION</span>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;soup&quot;</span><span class="w">         </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;onions&quot;</span><span class="w">        </span><span class="k">UNION</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;beans&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;beans&quot;</span><span class="p">;</span>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>
</span><span id="__span-99-8"><a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-99-9"><a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;beans&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;A&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shop</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">UNION</span>
</span><span id="__span-99-10"><a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;beans&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;B&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">UNION</span>
</span><span id="__span-99-11"><a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;onions&quot;</span><span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;A&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w">          </span><span class="k">UNION</span>
</span><span id="__span-99-12"><a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;onions&quot;</span><span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;B&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">          </span><span class="k">UNION</span>
</span><span id="__span-99-13"><a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;broth&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;A&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w">          </span><span class="k">UNION</span>
</span><span id="__span-99-14"><a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="ss">&quot;broth&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;B&quot;</span><span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>(a) (2 pt)</strong>  Select a two-column table with one row per food that describes the lowest price for each food.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="n">_________________</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="n">________________________</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="n">beans</span><span class="o">|</span><span class="mi">2</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="n">broth</span><span class="o">|</span><span class="mi">3</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="n">onions</span><span class="o">|</span><span class="mi">2</span>
</span></code></pre></div>
<p><strong>(b) (4 pt)</strong> Select a two-column table with one row per dish that describes the total cost of each dish if all parts are purchased from shop A.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">________________________</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">_____________________________</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">__________________________________________________________</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="n">beans</span><span class="o">|</span><span class="mi">2</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="n">chili</span><span class="o">|</span><span class="mi">5</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="n">soup</span><span class="o">|</span><span class="mi">6</span>
</span></code></pre></div>
<p><strong>(c) (4 pt)</strong> In two different ways, select a one-column table of all foods that have a different price at each store.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">_________</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">__________________________________</span><span class="p">,</span><span class="w"> </span><span class="n">__________________________________</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">____________________________________________________________________________________</span><span class="p">;</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">_________</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">_______________________________________________________</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="n">onions</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="n">broth</span>
</span></code></pre></div>
</div>
<p>自己做了一下这题，最后感觉除了c题中要实现的第二种方法，其他都不是很难</p>
<blockquote>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>python<span class="w"> </span>sqlite_shell.py<span class="w"> </span>-i<span class="w"> </span>test.sql
</span></code></pre></div>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">(a)</label><label for="__tabbed_2_2">(b)</label><label for="__tabbed_2_3">(c)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">food</span><span class="p">;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">dish</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ingredients</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">food</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">shop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;A&quot;</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">dish</span><span class="p">;</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">food</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">food</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">food</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">shop</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">shop</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">price</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">price</span><span class="p">;</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">price</span><span class="p">);</span>
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<p>看了John的解答，发现他c题的第二种写法比我更简洁一些</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shops</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">food</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="lecture-37-final-examples">Lecture 37 Final Examples<a class="headerlink" href="#lecture-37-final-examples" title="Permanent link">&para;</a></h2>
<h3 id="1_14">1<a class="headerlink" href="#1_14" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_211.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_211" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_211.png" /></a></p>
<p>尝试实现课上的这题</p>
<blockquote>
<div class="language-python highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Tree</span><span class="p">:</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="sd">    &gt;&gt;&gt; t = Tree(3, [Tree(2, [Tree(5)]), Tree(4)])</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="sd">    &gt;&gt;&gt; t.label</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="sd">    3</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="sd">    &gt;&gt;&gt; t.branches[0].label</span>
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="sd">    2</span>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="sd">    &gt;&gt;&gt; t.branches[1].is_leaf()</span>
</span><span id="__span-111-9"><a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="sd">    True</span>
</span><span id="__span-111-10"><a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-111-11"><a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">branches</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="__span-111-12"><a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
</span><span id="__span-111-13"><a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">Tree</span><span class="p">)</span>
</span><span id="__span-111-14"><a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="__span-111-15"><a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">branches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">branches</span><span class="p">)</span>
</span><span id="__span-111-16"><a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a>
</span><span id="__span-111-17"><a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-111-18"><a id="__codelineno-111-18" name="__codelineno-111-18" href="#__codelineno-111-18"></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">branches</span>
</span><span id="__span-111-19"><a id="__codelineno-111-19" name="__codelineno-111-19" href="#__codelineno-111-19"></a>
</span><span id="__span-111-20"><a id="__codelineno-111-20" name="__codelineno-111-20" href="#__codelineno-111-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
</span><span id="__span-111-21"><a id="__codelineno-111-21" name="__codelineno-111-21" href="#__codelineno-111-21"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-111-22"><a id="__codelineno-111-22" name="__codelineno-111-22" href="#__codelineno-111-22"></a><span class="sd">        Apply a function `fn` to each node in the tree and mutate the tree.</span>
</span><span id="__span-111-23"><a id="__codelineno-111-23" name="__codelineno-111-23" href="#__codelineno-111-23"></a>
</span><span id="__span-111-24"><a id="__codelineno-111-24" name="__codelineno-111-24" href="#__codelineno-111-24"></a><span class="sd">        &gt;&gt;&gt; t1 = Tree(1)</span>
</span><span id="__span-111-25"><a id="__codelineno-111-25" name="__codelineno-111-25" href="#__codelineno-111-25"></a><span class="sd">        &gt;&gt;&gt; t1.map(lambda x: x + 2)</span>
</span><span id="__span-111-26"><a id="__codelineno-111-26" name="__codelineno-111-26" href="#__codelineno-111-26"></a><span class="sd">        &gt;&gt;&gt; t1.map(lambda x : x * 4)</span>
</span><span id="__span-111-27"><a id="__codelineno-111-27" name="__codelineno-111-27" href="#__codelineno-111-27"></a><span class="sd">        &gt;&gt;&gt; t1.label</span>
</span><span id="__span-111-28"><a id="__codelineno-111-28" name="__codelineno-111-28" href="#__codelineno-111-28"></a><span class="sd">        12</span>
</span><span id="__span-111-29"><a id="__codelineno-111-29" name="__codelineno-111-29" href="#__codelineno-111-29"></a><span class="sd">        &gt;&gt;&gt; t2 = Tree(3, [Tree(2, [Tree(5)]), Tree(4)])</span>
</span><span id="__span-111-30"><a id="__codelineno-111-30" name="__codelineno-111-30" href="#__codelineno-111-30"></a><span class="sd">        &gt;&gt;&gt; t2.map(lambda x: x * x)</span>
</span><span id="__span-111-31"><a id="__codelineno-111-31" name="__codelineno-111-31" href="#__codelineno-111-31"></a><span class="sd">        &gt;&gt;&gt; t2</span>
</span><span id="__span-111-32"><a id="__codelineno-111-32" name="__codelineno-111-32" href="#__codelineno-111-32"></a><span class="sd">        Tree(9, [Tree(4, [Tree(25)]), Tree(16)])</span>
</span><span id="__span-111-33"><a id="__codelineno-111-33" name="__codelineno-111-33" href="#__codelineno-111-33"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-111-34"><a id="__codelineno-111-34" name="__codelineno-111-34" href="#__codelineno-111-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="__span-111-35"><a id="__codelineno-111-35" name="__codelineno-111-35" href="#__codelineno-111-35"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branches</span><span class="p">:</span>
</span><span id="__span-111-36"><a id="__codelineno-111-36" name="__codelineno-111-36" href="#__codelineno-111-36"></a>            <span class="n">b</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="__span-111-37"><a id="__codelineno-111-37" name="__codelineno-111-37" href="#__codelineno-111-37"></a>
</span><span id="__span-111-38"><a id="__codelineno-111-38" name="__codelineno-111-38" href="#__codelineno-111-38"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</span><span id="__span-111-39"><a id="__codelineno-111-39" name="__codelineno-111-39" href="#__codelineno-111-39"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-111-40"><a id="__codelineno-111-40" name="__codelineno-111-40" href="#__codelineno-111-40"></a><span class="sd">        Determine whether an element exists in the tree.</span>
</span><span id="__span-111-41"><a id="__codelineno-111-41" name="__codelineno-111-41" href="#__codelineno-111-41"></a>
</span><span id="__span-111-42"><a id="__codelineno-111-42" name="__codelineno-111-42" href="#__codelineno-111-42"></a><span class="sd">        &gt;&gt;&gt; t1 = Tree(1)</span>
</span><span id="__span-111-43"><a id="__codelineno-111-43" name="__codelineno-111-43" href="#__codelineno-111-43"></a><span class="sd">        &gt;&gt;&gt; 1 in t1</span>
</span><span id="__span-111-44"><a id="__codelineno-111-44" name="__codelineno-111-44" href="#__codelineno-111-44"></a><span class="sd">        True</span>
</span><span id="__span-111-45"><a id="__codelineno-111-45" name="__codelineno-111-45" href="#__codelineno-111-45"></a><span class="sd">        &gt;&gt;&gt; 8 in t1</span>
</span><span id="__span-111-46"><a id="__codelineno-111-46" name="__codelineno-111-46" href="#__codelineno-111-46"></a><span class="sd">        False</span>
</span><span id="__span-111-47"><a id="__codelineno-111-47" name="__codelineno-111-47" href="#__codelineno-111-47"></a><span class="sd">        &gt;&gt;&gt; t2 = Tree(3, [Tree(2, [Tree(5)]), Tree(4)])</span>
</span><span id="__span-111-48"><a id="__codelineno-111-48" name="__codelineno-111-48" href="#__codelineno-111-48"></a><span class="sd">        &gt;&gt;&gt; 6 in t2</span>
</span><span id="__span-111-49"><a id="__codelineno-111-49" name="__codelineno-111-49" href="#__codelineno-111-49"></a><span class="sd">        False</span>
</span><span id="__span-111-50"><a id="__codelineno-111-50" name="__codelineno-111-50" href="#__codelineno-111-50"></a><span class="sd">        &gt;&gt;&gt; 5 in t2</span>
</span><span id="__span-111-51"><a id="__codelineno-111-51" name="__codelineno-111-51" href="#__codelineno-111-51"></a><span class="sd">        True</span>
</span><span id="__span-111-52"><a id="__codelineno-111-52" name="__codelineno-111-52" href="#__codelineno-111-52"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-111-53"><a id="__codelineno-111-53" name="__codelineno-111-53" href="#__codelineno-111-53"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-111-54"><a id="__codelineno-111-54" name="__codelineno-111-54" href="#__codelineno-111-54"></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-111-55"><a id="__codelineno-111-55" name="__codelineno-111-55" href="#__codelineno-111-55"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">branches</span><span class="p">:</span>
</span><span id="__span-111-56"><a id="__codelineno-111-56" name="__codelineno-111-56" href="#__codelineno-111-56"></a>            <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
</span><span id="__span-111-57"><a id="__codelineno-111-57" name="__codelineno-111-57" href="#__codelineno-111-57"></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-111-58"><a id="__codelineno-111-58" name="__codelineno-111-58" href="#__codelineno-111-58"></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-111-59"><a id="__codelineno-111-59" name="__codelineno-111-59" href="#__codelineno-111-59"></a>
</span><span id="__span-111-60"><a id="__codelineno-111-60" name="__codelineno-111-60" href="#__codelineno-111-60"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-111-61"><a id="__codelineno-111-61" name="__codelineno-111-61" href="#__codelineno-111-61"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">branches</span><span class="p">:</span>
</span><span id="__span-111-62"><a id="__codelineno-111-62" name="__codelineno-111-62" href="#__codelineno-111-62"></a>            <span class="n">branch_str</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branches</span><span class="p">)</span>
</span><span id="__span-111-63"><a id="__codelineno-111-63" name="__codelineno-111-63" href="#__codelineno-111-63"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-111-64"><a id="__codelineno-111-64" name="__codelineno-111-64" href="#__codelineno-111-64"></a>            <span class="n">branch_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-111-65"><a id="__codelineno-111-65" name="__codelineno-111-65" href="#__codelineno-111-65"></a>        <span class="k">return</span> <span class="s1">&#39;Tree(</span><span class="si">{0}{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">branch_str</span><span class="p">)</span>
</span><span id="__span-111-66"><a id="__codelineno-111-66" name="__codelineno-111-66" href="#__codelineno-111-66"></a>
</span><span id="__span-111-67"><a id="__codelineno-111-67" name="__codelineno-111-67" href="#__codelineno-111-67"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-111-68"><a id="__codelineno-111-68" name="__codelineno-111-68" href="#__codelineno-111-68"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">print_tree</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-111-69"><a id="__codelineno-111-69" name="__codelineno-111-69" href="#__codelineno-111-69"></a>            <span class="n">tree_str</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="o">*</span> <span class="n">indent</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-111-70"><a id="__codelineno-111-70" name="__codelineno-111-70" href="#__codelineno-111-70"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">branches</span><span class="p">:</span>
</span><span id="__span-111-71"><a id="__codelineno-111-71" name="__codelineno-111-71" href="#__codelineno-111-71"></a>                <span class="n">tree_str</span> <span class="o">+=</span> <span class="n">print_tree</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-111-72"><a id="__codelineno-111-72" name="__codelineno-111-72" href="#__codelineno-111-72"></a>            <span class="k">return</span> <span class="n">tree_str</span>
</span><span id="__span-111-73"><a id="__codelineno-111-73" name="__codelineno-111-73" href="#__codelineno-111-73"></a>        <span class="k">return</span> <span class="n">print_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span></code></pre></div>
</blockquote>
<div class="language-python highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">bigs</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of nodes in t that are larger than all their ancestor nodes.</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="sd">    &gt;&gt;&gt; a = Tree(1, [Tree(4, [Tree(4), Tree(5)], Tree(3, [Tree(0, [Tree(2)])])])</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="sd">    &gt;&gt;&gt; bigs(a)</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="sd">    4</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a>        <span class="k">if</span> <span class="n">____________________________________________________</span><span class="p">:</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a>            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">________________________________________</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>            <span class="k">return</span> <span class="n">____________________________________________</span>
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a>    <span class="k">return</span> <span class="n">____________________________________________________</span>
</span></code></pre></div>
<p>感觉不算难</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">bigs</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a>            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">branches</span><span class="p">])</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>            <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">branches</span><span class="p">])</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">branches</span><span class="p">])</span>
</span></code></pre></div>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_212.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_212" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_212.png" /></a></p>
<p>John最后展示了如何一步步得到最后的答案/代码</p>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_213.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_213" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_213.png" /></a></p>
<p>John展示了另一种使用 <code>nonlocal</code> 语句来实现的递归的方法</p>
<h3 id="2_14">2<a class="headerlink" href="#2_14" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_214.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_214" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_214.png" /></a></p>
<p>John展示了一种编写程序解决问题的步骤，他认为这虽然不是一个完美的方法，但是是一个比较有用和考虑周到的方法，可以在第一眼不知道问题如何解决时想想这样的方法</p>
<blockquote>
<p><strong>从问题分析到数据定义</strong></p>
<p>确定必须表示的信息以及在选择的编程语言中如何表示这些信息。制定数据定义并用<u>例子</u>加以说明。</p>
<p><strong>签名、目的语句、头部</strong></p>
<p>说明所需函数消耗和产生的数据类型。对问题“函数计算<em>什么</em>”提出简明的回答。定义一个符合签名的存根。</p>
<p><strong>功能示例</strong></p>
<p>通过<u>例子</u>演示函数的目的。</p>
<p><strong>函数模板</strong></p>
<p>将数据定义转化为函数的大纲。</p>
<p><strong>测试</strong></p>
<p>将<u>例子</u>表达为测试，并确保函数通过所有测试。这样做有助于发现错误。测试也可以作为例子的补充，帮助他人在需要时阅读和理解定义-而对于任何严肃的程序，这是必要的。
</p>
</blockquote>
<h3 id="3_9">3<a class="headerlink" href="#3_9" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_215.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_215" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_215.png" /></a></p>
<p>尝试实现这一题</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">smalls</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the non-leaf nodes in t that are smaller than all their descendants.</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="sd">    &gt;&gt;&gt; a = Tree(1, [Tree(2, [Tree(4), Tree(5)]), Tree(3, [Tree(0, [Tree(6)])])])</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="sd">    &gt;&gt;&gt; sorted([t.label for t in smalls(a)])</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="sd">    [0, 2]</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a>        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a>            <span class="k">return</span> <span class="n">__________________________________________</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a>            <span class="n">smallest</span> <span class="o">=</span> <span class="n">______________________________________</span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a>            <span class="k">if</span> <span class="n">______________________________________________</span><span class="p">:</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a>                <span class="n">_____________________________________________</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">smallest</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a>    <span class="n">process</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
<p>我的实现</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">smalls</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a>        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">():</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a>            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a>            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">process</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">branches</span><span class="p">])</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a>            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span> <span class="o">&lt;</span> <span class="n">smallest</span><span class="p">:</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">smallest</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a>    <span class="n">process</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
<hr />
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_216.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_216" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_216.png" /></a></p>
<h2 id="lecture-37-qa">Lecture 37 Q&amp;A<a class="headerlink" href="#lecture-37-qa" title="Permanent link">&para;</a></h2>
<h3 id="1_15">1<a class="headerlink" href="#1_15" title="Permanent link">&para;</a></h3>
<p>课上提到的18年春季期末考试的第5题</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p><strong>(12 points) Function As Expected</strong></p>
<p><strong>Definition</strong>. For <span class="arithmatex">\(n &gt; 1\)</span> , an <em>order n function</em> takes one argument and returns an onder <span class="arithmatex">\(n - 1\)</span> function.</p>
<p>An order 1 function is any function that takes one argument.</p>
<p><strong>(a) (6 pt)</strong> Implement <code>scurry</code> , which takes a function <code>f</code> and a positive integers <code>n</code> . <code>f</code> must be a function that takes a list as its argument. <code>scurry</code> returns an order <em>n</em> function that, when called successively <em>n</em> times on a sequence of values <span class="arithmatex">\(x_1, x_2, ... x_n\)</span> , returns the result of calling <code>f</code> on a list containing <span class="arithmatex">\(x_1, x_2, ... x_n\)</span> .</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">scurry</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a function that calls f on a list of arguments after being called n times.</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="sd">    &gt;&gt;&gt; scurry(sum, 4)(1)(1)(3)(2)  # equivalent to sum([1, 1, 3, 2])</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="sd">    7</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="sd">    &gt;&gt;&gt; scurry(len, 3)(7)([8])(-9)  # equivalent to len([7, [8], -9])</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="sd">    3</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">h</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">args_so_far</span><span class="p">):</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a>            <span class="k">return</span> <span class="n">________________________________________________________________________</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a>        <span class="k">return</span> <span class="n">____________________________________________________________________________</span>
</span><span id="__span-116-13"><a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a>    <span class="k">return</span> <span class="n">________________________________________________________________________________</span>
</span></code></pre></div>
<p><strong>(b) (6 pt)</strong> Implement <code>factorize</code> , which takes two integers <code>n</code> and <code>k</code> , both larger than 1. It returns the number of ways that <code>n</code> can be expressed as a product of non-decreasing integers greater than or equal to <code>k</code> .</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of ways to factorize positive integer n.</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="sd">    &gt;&gt;&gt; factorize(7)  # 7</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="sd">    1</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="sd">    &gt;&gt;&gt; factorize(12) # 2*2*3, 2*6, 3*4, 12</span>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="sd">    4</span>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="sd">    &gt;&gt;&gt; factorize(36) # 2*2*3*3, 2*2*9, 2*3*6, 2*18, 3*3*4, 3*12, 4*9, 6*6, 36</span>
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a><span class="sd">    9</span>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a>    <span class="k">if</span> <span class="n">_____________________________________________________________________________________</span><span class="p">:</span>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a>    <span class="k">elif</span> <span class="n">___________________________________________________________________________________</span><span class="p">:</span>
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-117-15"><a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a>    <span class="k">elif</span> <span class="n">___________________________________________________________________________________</span><span class="p">:</span>
</span><span id="__span-117-16"><a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a>        <span class="k">return</span> <span class="n">factorize</span><span class="p">(</span><span class="n">_________________________________</span><span class="p">,</span> <span class="n">________________________________</span><span class="p">)</span>
</span><span id="__span-117-17"><a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a>    <span class="k">return</span> <span class="n">_________________________________________________________________________________</span>
</span></code></pre></div>
</div>
<p>自己尝试做了一下，感觉还蛮有意思，</p>
<p>感觉是因为已经做过很多类似的题目，所以做b题时，很快就想到了 <code>if</code> 的几种情况，分别是 刚好相等整除得1，无法除，能整除，不能整除</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">(a)</label><label for="__tabbed_3_2">(b)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">scurry</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">h</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">args_so_far</span><span class="p">):</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a>            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">args_so_far</span><span class="p">)</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a>        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">h</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">args_so_far</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a>    <span class="k">return</span> <span class="n">h</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">[])</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a>    <span class="k">elif</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a>    <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a>        <span class="k">return</span> <span class="n">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a>    <span class="k">return</span> <span class="n">factorize</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<p>John解答这题时说到b题第一种情况中 <code>n == k</code> 和 <code>n == 1</code> 两个判断条件都可以，然后试了一下发现真的能通过</p>
<h3 id="2_15">2<a class="headerlink" href="#2_15" title="Permanent link">&para;</a></h3>
<p>John提到scheme中也有类似python中 <code>*args</code> 的传入不定个数参数的方法，在定义函数时，可以使用 <code>. args</code> 的形式来获取所有的参数(可见于下图)，然后 <code>args</code> 就会是一个链表</p>
<p><a class="glightbox" href="../../../../Notes%20of%20Courses/CS61A/images/cs61a_217.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="cs61a_217" loading="lazy" src="../../../../Notes%20of%20Courses/CS61A/images/cs61a_217.png" /></a></p>
<h2 id="lecture-38-conclusion">Lecture 38 Conclusion<a class="headerlink" href="#lecture-38-conclusion" title="Permanent link">&para;</a></h2>
<h3 id="1_16">1<a class="headerlink" href="#1_16" title="Permanent link">&para;</a></h3>
<p>John和Hany提到的一些关于技术的思考(的其中一部分)</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>...Yeah, and so the one thing I'd love to leave you all with is the idea that you don't just decide, "I'm gonna become a software engineer for life" or, "Oh, I'm gonna become a regulator for life." That's just not how it is. I mean, so many people take meandering paths in their lives where they do some of both. They understand the technology well enough that they realize, "Oh, their impact should be figuring out how to collaborate with government to regulate it in a way that has the right sorts of trade-offs."</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>Yeah, let me add one more thing too, John, and this is something you need to practice from a very young age, like right now, which is how do you talk to people who are not technical about technical things? There's always this language barrier between us computer scientists and our regulators and our lawyers. It's really good to get in the habit of thinking about how do you take these, in some cases, very complex things and explain them in honest and clear ways so that people can understand them, process them, and then reason about them properly.</p>
<hr />
<p>John:</p>
<p>...是的，所以我想留给大家的一个想法是，你不只是决定“我要成为一名终身软件工程师”或“哦，我要终身成为监管者”。情况并非如此。我意味着很多人在他们的生活中走过曲折的道路，既涉足技术，又理解得足够深刻，以至于意识到他们的影响应该是弄清楚如何与政府合作，以一种具有正确权衡的方式进行监管。</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>是的，约翰，再补充一点，这是你需要从很小的时候就开始练习的事情，就像现在这样，那就是如何与不懂技术的人谈论技术问题？我们计算机科学家、监管者和律师之间总是存在这种语言障碍。养成一个习惯，思考如何以真实而清晰的方式解释这些，有时是非常复杂的事情，以便人们能够理解、处理，并正确地进行推理。</p>
</div>
<h3 id="2_16">2<a class="headerlink" href="#2_16" title="Permanent link">&para;</a></h3>
<p>John和Hany谈到人生/生活(life)</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>Here's my spiel about life. You know, I'm not going to tell you how to live your life, but I wanted to remind you of a few things.</p>
<p>One is about freedom, which is that when you learn how to write software, then your skills are going to be in demand. There's no question about that. Lots of people are going to work with you. In fact, there are so many different problems to solve that we can't solve them all with the people that we've trained to do this kind of thing. So, that means that what you decide to work on actually influences what gets built in the world.</p>
<p>What you decide to work on will also influence your own experience. I think I've known a lot of people now in the tech industry, and the ones who make the most money are not the ones that seem most fulfilled or most happy to me. The ones that seem like they're very comfortable with their life usually have found something that they're good at, something that they enjoy, and it also happens to be something that matters to the world in some way. You know, if you find that combination, then great. So, when I say freedom, I mean you can choose what you work on. You don't have to just take the internship from the company that's got the flashiest website or the best reputation. There are lots of cool things to do out there, and you should be selective and search for something that is a good fit for you.</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>Yeah, I think that's exactly right, John. I think one of the greatest gifts in life is being able to wake up every day and do the things that you find fulfilling, that you're good at, that you're excited about. And, by the way, to boot, somebody's willing to pay you to do them. It's an incredible gift.</p>
<p>Thinking about what are you prioritizing? For some people, the priority is they want to make a lot of money. That's fine, that's a different choice. But think about what's going to be important to you. And here's the rub, by the way: What's important to you when you're 20, and when you're 30, 40, 50, and 60, it's going to be different. And I will tell you, I have a lot of friends who left grad school, made a lot of money on Wall Street, but when they turned 40 and started looking down the line at what's their legacy, it wasn't quite as good.</p>
<p>Whereas I can look at my legacy as an academic and interact with smart young people, trying to inspire and motivate them. You can feel really good about that. So try to think not just about what's today but also, you know, 10, 20, 30 years from now.</p>
<p>&nbsp;</p>
<p>John:</p>
<p>Yeah, exactly. And you might change course. You know, I didn't discover that I liked teaching until I tried it, which was when I went to grad school. I didn't do any of that in undergrad. So, if you haven't figured out the perfect thing for you yet, don't worry. But, make sure that you think about the kind of long-term implications of whatever you do commit to.</p>
<hr />
<p>John:</p>
<p>关于人生，我想说的一些话。我不会告诉你如何过你的人生，但我想提醒你一些事情。</p>
<p>首先是关于自由的问题，学会写软件后，你的技能将会受到需求，毫无疑问。很多人会和你一起工作。事实上，有很多不同的问题需要解决，而我们无法仅凭我们培训出来的人来解决所有问题。所以，这意味着你决定工作的实际上会影响在世界上构建什么。</p>
<p>你决定从事什么工作也将影响你自己的经验。我认识了很多科技行业的人，最赚钱的人并不是我认为最充实或最幸福的人。那些看起来非常舒适的人通常找到了自己擅长的事情，喜欢做的事情，而且这事情恰好对世界有意义。你知道，如果你找到了这种组合，那就太好了。所以，当我说自由时，我是指你可以选择你要从事的工作。你不必只是选择那家网站最炫或声誉最好的公司的实习机会。有很多有趣的事情等着你去做，你应该有选择地寻找适合你的东西。</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>是的，我认为约翰说得对。我认为人生中最伟大的礼物之一是每天醒来，做你觉得充实、擅长并且感到兴奋的事情。而且，顺便说一下，还有人愿意为你付钱来做这些事情。这是一份难以置信的礼物。</p>
<p>考虑一下你正在优先考虑什么？对于一些人来说，优先考虑的是他们想赚很多钱。那没问题，这是一个不同的选择。但要考虑对你来说什么才重要。而且顺便说一下，现在是关键：当你20岁、30岁、40岁、50岁和60岁时，对你重要的东西会有所不同。我告诉你，我有很多朋友离开研究生学校，在华尔街赚了很多钱，但当他们40岁时开始思考自己的遗产时，情况就不那么理想了。</p>
<p>而我作为一名学者，可以看待我的遗产，与聪明的年轻人互动，试图激发和激励他们。你可以因此感到非常自豪。因此，试着不只考虑今天，还要考虑，你知道，未来10、20、30年。</p>
<p>&nbsp;</p>
<p>John:</p>
<p>是的，确实。而且你可能会改变方向。你知道，我直到尝试才发现我喜欢教学，那是我上研究生学校时。在本科时我没有尝试过这些。所以，如果你还没找到完全适合你的事情，不用担心。但是，请确保你考虑你所承诺的事情的长远影响。</p>
</div>
<h3 id="3_10">3<a class="headerlink" href="#3_10" title="Permanent link">&para;</a></h3>
<p>John和Hany提到不只要专精于计算机专业的技术，学习其他领域的知识会更好</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Hany:</p>
<p>Ah, what would be a good career path if someone were to want to go into law and policy regarding tech? Since, as John mentioned, they need someone who understands the law and tech side of things.</p>
<p>Yeah, that's a good question. A lot of the big companies these days are hiring people to work on policy. For example, there are people who are responsible for global policy, domestic policy. They often are lawyers, which is good in some ways, but I would like to see some more technologists there.</p>
<p>For me, I like people who, maybe instead of a CS major, they're a CS minor or, in addition to a CS major, they've also studied politics or economics or something in the social sciences where they can think about the implications of policies. I find historians really fascinating in this regard, political scientists who think about laws, for example, understanding that. But typically, it's that kind of dual career that is very useful.</p>
<p>&nbsp;</p>
<p>John:</p>
<p>Yeah, a lot of people I know who are really interesting and really effective, they know something really well, and then they know something else quite well. And by quite well, I mean not just like they've read a lot of New York Times articles about it, but like, you know, they've gone pretty deep.</p>
<p>So yeah, whether it's, you know, the software really well and the policy issues pretty well, or vice versa, you can be extraordinarily effective in either way, much more so than being like, "Yeah, just even more deep into policy but you don't understand the technology."</p>
<hr />
<p>Hany:</p>
<p>啊，如果有人想要从事与科技相关的法律和政策工作，什么样的职业道路会是一个不错的选择呢？正如John所提到的，他们需要了解法律和技术方面的人才。</p>
<p>是的，这是一个很好的问题。如今，很多大公司都在招聘负责政策方面工作的人员。例如，有人负责全球政策、国内政策。他们通常是律师，从某些方面来说是好的，但我希望能看到更多的技术人才加入。</p>
<p>对我来说，我喜欢那些可能不是计算机科学专业主修的人，而是计算机科学专业辅修或者同时学习政治、经济或社会科学等方面的人，他们能够思考政策的影响。在这方面，我觉得历史学家在这方面非常迷人，政治科学家也在思考法律等方面的问题，理解这些是很有帮助的。但通常来说，这种双重职业背景是非常有用的。</p>
<p>&nbsp;</p>
<p>John:</p>
<p>是的，我认识的许多非常有趣且非常有效的人，他们擅长某个领域，然后又对另一个领域了解得相当透彻。当我说相当透彻时，我指的不仅仅是读了很多《纽约时报》的文章，而是深入了解了许多。</p>
<p>所以，是的，无论是对软件了解得很透彻，对政策问题也了解得相当透彻，还是相反，你都可以在任一方面取得非凡的成就，远比只是深入了解政策而对技术一无所知更为有效。</p>
</div>
<h3 id="4_4">4<a class="headerlink" href="#4_4" title="Permanent link">&para;</a></h3>
<p>有人提问居家上学感到与学校脱离，Hany进行回答，并提到处于低谷中的建议</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Hany:</p>
<p>What, um, yeah, god, this is a tough question. I don't know that I have an answer, but I want to answer the question anyway. Um, what advice would you have for someone living at home for this year and feeling kind of detached from the university and academia?</p>
<p>Oh man, I gotta tell you, that question just breaks my heart because I know a lot of people are going through that. So I don't know if I have a good answer for you, but let me try a few things. Um, this will end. We will come out at the other end of this. And the one thing that I've learned, having been around for a few decades now, is when you're in the middle of a hard time like this, whether it's something like this global pandemic or it's family or it's work or it's a relationship or it's personal or it's health, when you're in the middle of it, it feels really bad. And it is, but you always come out the other end.</p>
<p>And in all of these cases, I will look back at it and will say to myself, you know what, I've come back from this, better, stronger, more mature. Um, and there will be positives that come from this. So for me, what I do is I try to think down the line, six months, nine months from now, we're going to be back, and will we be better for this? We will be, hopefully, better human beings, better societies, and we will learn how to work through hardships. It's a shitty answer, by the way, for what to do right now, but it's a more hopeful answer for what's downstream for you.</p>
<hr />
<p>Hany:</p>
<p>嗯，嗯，天哪，这是一个棘手的问题。我不知道我是否有一个答案，但我还是想回答这个问题。嗯，对于那些今年留在家里并感到有点脱离大学和学术界的人，你有什么建议？</p>
<p>哦，天啊，我得告诉你，这个问题真的让我心碎，因为我知道很多人都经历了这种情况。所以我不知道我是否有一个好的答案给你，但让我试试几个方法。嗯，这会结束的。我们会度过难关的。而我学到的一件事是，经历了几十年，当你处于这样的艰难时刻，无论是像这样的全球大流行，还是家庭、工作、人际关系、个人问题或健康问题，当你正处于其中时，感觉真的很糟糕。确实如此，但你总会走出困境。</p>
<p>在所有这些情况下，我会回顾一下，对自己说，你知道吗，我从中走了出来，变得更好、更强大、更成熟。嗯，会有一些积极的方面。所以对我来说，我做的是尽量往前看，六个月、九个月后，我们会回来的，我们会因此变得更好吗？我们会，希望成为更好的人类，更好的社会，我们会学会如何克服困境。这对于现在该怎么办来说是一个糟糕的答案，但对于你未来的情况而言，这是一个更有希望的答案。</p>
</div>
<h3 id="5_3">5<a class="headerlink" href="#5_3" title="Permanent link">&para;</a></h3>
<p>John提到不要与他人比较，而是注重自我的提升</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>John:</p>
<p>Yeah, we've got two minutes left. Maybe, um, since I started by talking about the final exam, I'll end with something related, which is a piece of advice that I got when I was getting married. So, I was a Ph.D. student at the time, and my mom pulled me aside on my wedding day and said, "John, I want to give you some advice." And I was like, "Oh, great. She's going to tell me to listen to my wife or whatever." But she didn't. She said only two words that have stuck with me for a long time. She said, "Don't compare." And then she was like, "Okay, you can go back to doing whatever you're doing."</p>
<p>At the time, this was very hard for me to process because I was in a university, which is all about comparing people based on, like, what their exam score was. And, you know, it turns out that out there in the world, there are no exams that everybody takes that are standardized anymore. All that matters is what you go and get done on your own particular path. So, comparing yourselves to other people becomes meaningless rapidly, as what really matters is what you can do yourself, like what you're capable of and what you bother to do and how you choose to spend your time.</p>
<p>But it took years of this two-word phrase, "Don't compare," to marinate inside of me, and for me to realize that my self-worth really has nothing to do with what other people can do and whether I can do it better than them or worse than them, and it has everything to do with what I've done and what I'm gonna do next, and how I spend my time to better myself. So, I should just focus on improving myself and forget about what everybody else is doing.</p>
<p>So, um, you're gonna go take a final, and a bunch of other people are gonna take this final exam too. But who cares? This course is not graded on a curve; it's just you doing your best work. So, I do hope you prepare, I do hope you get some good sleep and all of that, but at the same time, I don't think you need to worry about the histogram and how your friends are doing. Just help each other out and focus on yourself in the end.</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>That's incredibly beautiful, John. I want to say two things. First of all, I'm gonna go talk to my mother because I didn't get nearly such good advice growing up, so I'm gonna have a word with her. I want to re-emphasize this because this is something that took me a long time in life to understand - not to compare. There's a trap too that we fall into, which is that we compare, for example, how big our house is to that one friend, how much money we make to another friend, the kind of clothes we have to this friend, and how smart we are to that friend. We pick and choose these things, and that's, first of all, even doing that individually is meaningless. But also, it's a trap, and this is the problem with social media - you see these curated worlds of other people, and it's a trap. One of the great things about getting older (and you will get there, I promise you) is that you will realize it's a trap and it means absolutely nothing. It really is a very internal thing. What are you doing? Who do you want to be? How do you want to go through this world? How do you want to treat other people? At the end of the day, that, and almost nothing else, is going to matter. And you've got to just trust that it's going to be there.</p>
<hr />
<p>John:</p>
<p>是的，我们还有两分钟左右，也许，由于我一开始谈到期末考试，我会以与之相关的事情结束。这与我结婚时获得的一些建议有关。那时，我还是一名博士生，我妈妈在我婚礼那天拉着我一边说：“John，我想给你一些建议。”我当时觉得：“哦，太好了，她会告诉我听从妻子的话或其他什么的。”但她没有。她只说了两个词，这两个词一直在我心中。她说：“不要比较。”然后她说：“好吧，你可以回去做你正在做的事情了。”</p>
<p>当时，这对我来说很难理解，因为我身处一个大学，那里一切都是关于根据考试成绩比较人们的地方。你知道，事实证明，在这个世界上，没有人再接受标准化的考试了。真正重要的是你按照自己的特定路径所做的事情。因此，与其他人比较变得迅速变得毫无意义，因为真正重要的是你自己能做什么，你有什么本领，以及你选择如何度过时间。</p>
<p>但是，“不要比较”这两个词在我内心发酵了好多年，我才意识到我的自我价值实际上与其他人能做什么无关，我是否能做得比他们好或差，而与我已经做了什么以及我将来会做什么，以及我如何花时间来提升自己有关。所以，我应该专注于改善自己，忘记其他人在做什么。</p>
<p>所以，你要去参加期末考试，其他很多人也会参加这个期末考试。但谁在乎呢？这门课不是按照曲线评分的，这只是你尽力而为。所以，我希望你做好准备，也希望你有充足的睡眠等等，但与此同时，我认为你无需担心直方图和你的朋友们的情况。互相帮助，最终专注于自己。</p>
<p>&nbsp;</p>
<p>Hany:</p>
<p>这真的非常美好，约翰。我想说两件事。首先，我要去找我妈妈聊聊，因为我在成长过程中没有得到这么好的建议，所以我要和她谈谈。我想重申一下，因为这是我很长时间才明白的事情——不要比较。我们也会陷入一个陷阱，比如我们会比较我们的房子有多大，与朋友相比我们挣多少钱，与另一个朋友相比我们有什么样的衣服，甚至与那位朋友相比我们有多聪明。我们选择这些事情，首先，单独做这些是毫无意义的。但同样，这是一个陷阱，这就是社交媒体的问题——你看到其他人经过精心策划的世界，这是一个陷阱。变老的一个好处（你会到达那里的，我向你保证）是你会意识到这是一个陷阱，它毫无意义。这确实是一种非常内在的东西。你在做什么？你想成为谁？你想如何度过这个世界？你想如何对待其他人？在一天结束时，那几乎是唯一重要的事情。你只需相信它会在那里。</p>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-03-12T14:15:08+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-03-12</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-03-12T13:02:19+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-03-12</span>
      
    
  </small>
</div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../CS61A_part2/" class="md-footer__link md-footer__link--prev" aria-label="上一页: CS61A Part 2">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                CS61A Part 2
              </div>
            </div>
          </a>
        
        
          
          <a href="../../CS61B/CS61B/" class="md-footer__link md-footer__link--next" aria-label="下一页: CS61B">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                CS61B
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2025 Ronald Luo
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.expand", "toc.follow", "navigation.top", "search.suggest", "navigation.footer", "navigation.tracking", "navigation.instant", "navigation.instant.progress", "content.code.copy", "search.suggest", "search.highlight", "search.share"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../../../js/timeago.min.js"></script>
      
        <script src="../../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../../js/timeago.min.js"></script>
      
        <script src="../../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>